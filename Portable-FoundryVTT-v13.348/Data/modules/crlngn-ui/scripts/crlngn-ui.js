var Ca=Object.defineProperty;var An=l=>{throw TypeError(l)};var Ta=(l,e,t)=>e in l?Ca(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var y=(l,e,t)=>Ta(l,typeof e!="symbol"?e+"":e,t),Qo=(l,e,t)=>e.has(l)||An("Cannot "+t);var m=(l,e,t)=>(Qo(l,e,"read from private field"),t?t.call(l):e.get(l)),R=(l,e,t)=>e.has(l)?An("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,t),I=(l,e,t,o)=>(Qo(l,e,"write to private field"),o?o.call(l,t):e.set(l,t),t),B=(l,e,t)=>(Qo(l,e,"access private method"),t);var Dn=(l,e,t,o)=>({set _(n){I(l,e,n,t)},get _(){return m(l,e,o)}});const D={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessageHTML",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayers",ACTIVATE_SCENE_CONTROLS:"activateSceneControls",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",EXPAND_SIDE_BAR:"expandSidebar",RENDER_SIDE_BAR:"renderSidebar",ACTIVATE_CHAT_LOG:"activateChatLog",ACTIVATE_CHAT_LOG_5E:"activateChatLog5e",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",WEBRTC_USER_STATE_CHANGED:"webrtcUserStateChanged",WEBRTC_SETTINGS_CHANGED:"webrtcSettingsChanged",RTC_SETTINGS_CHANGED:"rtcSettingsChanged",RTC_MODE_CHANGED:"rtcModeChanged",RTC_VOICE_SETTINGS_CHANGED:"rtcVoiceSettingsChanged",RTC_LOCAL_STREAM_ESTABLISHED:"rtcLocalStreamEstablished",RTC_LOCAL_STREAM_ERROR:"rtcLocalStreamError",RTC_PEER_CONNECTED:"rtcPeerConnected",RTC_PEER_DISCONNECTED:"rtcPeerDisconnected",RTC_PEER_ERROR:"rtcPeerError",RTC_SIGNALING_EVENT:"rtcSignalingEvent",RENDER_AV_CONFIG:"renderAVConfig",RENDER_AV_MASTER:"renderAVMaster",RENDER_AV_CLIENT:"renderAVClient",USER_CONNECTED:"userConnected",USER_DISCONNECTED:"userDisconnected",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument",UPDATE_SETTING:"updateSetting",CLIENT_SETTING_CHANGED:"clientSettingChanged",RENDER_SETTINGS_CONFIG:"renderSettingsConfig",RENDER_MODULE_MANAGEMENT:"renderModuleManagement",RENDER_CONFIG_PANEL:"renderConfigPanel",RENDER_APPLICATION_V2:"renderApplicationV2",RENDER_TOKEN_HUD:"renderTokenHUD",RENDER_ACTOR_SHEET:"renderActorSheetV2",RENDER_ITEM_SHEET:"renderItemSheetV2",RENDER_COMPENDIUM_BROWSER:"renderCompendiumBrowser",RENDER_ADVANCEMENT_MANAGER:"renderAdvancementManager"},H="crlngn-ui",yo=["%cCarolingian UI","color:rgb(107, 72, 149); font-weight: bold;","|"],Ea=`
  --background: var(--color-dark-bg-95) !important;
  --filigree-background-color: var(--color-dark-bg-10) !important;
  --dnd5e-border-dotted: 1px dotted var(--color-cool-4) !important;
  --dnd5e-color-gold: rgba(159, 146, 117, 0.6) !important;
  --input-background-color: var(--color-cool-4) !important;
  --chat-dark-blue: rgba(24, 32, 38, 1) !important;
  --input-background-alt: var(--color-dark-bg-50) !important;
  --color-text-secondary: var(--color-light-1) !important;
  --color-text-primary: var(--color-light-1) !important;
  --button-text-color: var(--color-light-1) !important;
  --color-border-light-1: var(--dnd5e-color-gold) !important;
  --color-text-dark-input: var(--color-light-3) !important;
  --color-border-trait: var(--color-cool-4) !important;

  --crlngn-button-bg: rgba(15, 15, 15, 0.15) !important;
  --color-bg-button: rgba(32, 37, 43, 1) !important;
  --dnd5e-border-groove: 1px solid rgba(36, 36, 36, 0.5) !important;
  --dnd5e-color-groove: var(--dnd5e-color-gold) !important;
  --dnd5e-sheet-bg: rgb(37, 40, 48) !important;
  --sidebar-background: var(--control-bg-color, var(--color-cool-5-90)) !important;
  --dnd5e-color-parchment: rgb(32, 37, 43) !important;
  --dnd5e-background-card: rgb(32, 37, 43) !important; 
  --dnd5e-background-parchment: var(--color-cool-4) !important;

  --content-link-background: var(--color-secondary-50) !important;
  --color-pf-alternate: rgba(82, 107, 120, 0.44) !important;
  --color-text-gray-blue: rgb(168, 180, 188, 1) !important;
  --color-text-gray-blue-b: rgb(138, 155, 168, 1) !important;
  --chat-button-bg: rgba(32, 37, 43, 1) !important;
  --chat-button-bg-15: rgba(32, 37, 43, 0.15) !important;
  --chat-button-bg-25: rgba(32, 37, 43, 0.25) !important;
  --chat-button-bg-50: rgba(32, 37, 43, 0.5) !important;
  --chat-button-bg-75: rgba(32, 37, 43, 0.75) !important;
  --chat-dark-blue: rgba(24, 32, 38, 1) !important;
  --chat-dark-blue-b: rgb(29, 36, 48, 1) !important; 
  --chat-dark-bg: rgba(32, 37, 43, 1) !important; 
  --chat-dark-bg-15: rgba(32, 37, 43, 0.15) !important;
  --chat-dark-bg-25: rgba(32, 37, 43, 0.25) !important;
  --chat-dark-bg-50: rgba(32, 37, 43, 0.50) !important; 
  --chat-dark-bg-75: rgba(32, 37, 43, 0.75) !important; 
  --chat-dark-bg-90: rgba(32, 37, 43, 0.90) !important; 

  --color-input-bg: var(--color-dark-bg-50) !important; 

  --color-button-bg: rgba(90,120,150,0.5) !important;
  --color-input-border: rgba(90,120,150, 0.5) !important;
  --color-border-dark-5: rgba(80, 80, 80, 1) !important;
  --color-sidebar-font: rgba(213, 221, 230, 0.8) !important;

  --color-text-dark: rgba(235,235,235,1) !important;
  --color-text-dark-op: rgba(235,235,235,0.6) !important;
  --color-text-light: rgba(235,235,235,1) !important;
  --input-background-color: var(--color-cool-5) !important;
  --input-background-alt: var(--color-cool-5) !important;
  --color-text-secondary:var(--color-light-3) !important;
  --color-text-primary: var(--color-light-1) !important;

  --color-text-dark-primary: var(--color-light-1) !important;
  --button-border-color: transparent;

  background: var(--color-dark-bg-90) !important;
  color: var(--color-light-1) !important;

  .window-header, header, footer {
    background-color: var(--color-dark-bg-75) !important;
    color: var(--color-light-1) !important;
    box-shadow: none;
  }
  
  .window-content {
    background: var(--color-dark-bg-25) !important;
    color: var(--color-light-1) !important;
  }

  .window-header{
    border-bottom: 1px solid var(--color-cool-4) !important;
  }

  section.window-content form.crb-style header.char-header .char-level .level, section.window-content form.crb-style {
    background: transparent !important;
  }
  form.crb-style aside .sidebar * {
    background: transparent !important;
  }

  div:not(.currency-image, .success, .failure, .critical-success, .critical-failure),
  p, span, aside, section, nav, label, form, button, table, td, tr, th, h1, h2, h3, h4, h5, h6, ul, ol, li, b, strong, u {
    background-color: transparent;
    border-color: var(--color-cool-4);
    color: var(--color-light-1);
  }

  .app.journal-entry.sheet .journal-entry-content {
    background: var(--background) !important;
  }

  i.fa-solid, .fa-regular, i.fas, .fasr{
    color: var(--color-light-1);
  }

  *:not(.degree, .degree-of-success){
    color: var(--color-light-1);
  }

  a.content-link, a.inline-roll  {
    background-color: transparent !important;
    color: var(--color-light-1) !important;
  }
  p{
     line-height: 1.75;
  }

  input:not([type="range"]), select {
    background-color: var(--color-cool-4);
    color: var(--color-light-1);
    border-color: var(--color-cool-4);
  }

  select option {
    background: transparent;
  }

  fieldset {
    border-color: var(--color-cool-4);
  }

  button, .window-resizable-handle{
    color: var(--color-light-1) !important;
    border-color: transparent;
    background-color: var(--color-bg-button) !important;
  }

  button:hover{
    background-color: var(--color-warm-2) !important;
  }
`,Go=class Go{static log(e="",t=[],o=!1){try{const n=Go.debugOn;if(!(o||n))return;console.log(...yo,e,...t)}catch{console.log(...yo,e,...t)}}static warn(e="",t=[]){console.warn(...yo,e,...t)}static error(e,t){var o;t.ui&&((o=ui.notifications)==null||o.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...yo,e)}};y(Go,"debugOn",!1);let g=Go;const _o={select:"select",checkbox:"checkbox",text:"text",number:"number"},T={client:"client",world:"world"},Gt={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},Mt={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},To={left:{name:"left"},right:{name:"right"},top:{name:"top"},all:{name:"all"}},He={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},en=140,J=[{label:"Carolingian Teal",className:"crlngn-theme",colorPreview:["rgb(193, 193, 217)","rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(215, 206, 224)","rgb(40, 31, 49)","rgb(159, 35, 49)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(206, 222, 224)","rgb(31, 47, 49)","rgb(126, 88, 182)"]},{label:"Grass and Stone",className:"crlngn-theme-grass-stone",colorPreview:["rgb(207, 208, 208)","rgb(47, 48, 48)","rgb(121, 163, 62)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(221, 212, 212)","rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Pumpkin Patch",className:"crlngn-theme-pumpkin-patch",colorPreview:["rgb(215, 206, 224)","rgb(40, 31, 49)","rgb(220, 120, 43)"]},{label:"Plum Purple",className:"crlngn-plum-purple",colorPreview:["rgb(230, 233, 236)","rgb(20, 23, 26)","rgb(146, 42, 96)"]},{label:"Gambit's Blue",className:"crlngn-theme-gambits-blue",colorPreview:["rgb(215, 206, 224)","rgb(40, 31, 49)","rgb(45, 126, 207)"]}];function k(){return{moduleSettingsMenu:{isMenu:!0,showOnRoot:!0,tag:"v2-interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,scope:T.client,config:!1,requiresReload:!1,fields:[],default:{}},interfaceOptionsMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,fields:["sceneControlsFadeOut","sidebarTabsFadeOut","chatLogControlsFadeOut","playerListFadeOut","cameraDockFadeOut","macroHotbarFadeOut","sceneNavFadeOut","sceneControlsHide","sidebarTabsHide","chatLogControlsHide","playerListHide","cameraDockHide","macroHotbarHide","sceneNavHide","enableSceneControls","enableSidebarTabs","enableChatLogControls","sceneNavEnabled","enableMacroLayout","enableFloatingDock","enablePlayerList","collapseMacroBar","preventMacroBarReposition","useFolderStyle","controlsAutoHide","hoverableSettingsHints"],default:{sceneControlsFadeOut:!1,sidebarTabsFadeOut:!1,chatLogControlsFadeOut:!0,playerListFadeOut:!0,cameraDockFadeOut:!1,macroHotbarFadeOut:!0,sceneNavFadeOut:!1,sceneControlsHide:!1,sidebarTabsHide:!1,chatLogControlsHide:!1,playerListHide:!1,cameraDockHide:!1,macroHotbarHide:!1,sceneNavHide:!1,enableSceneControls:!0,enableSidebarTabs:!0,enableChatLogControls:!0,sceneNavEnabled:!0,enableMacroLayout:!0,enableFloatingDock:!0,enablePlayerList:!0,collapseMacroBar:!1,preventMacroBarReposition:!1,useFolderStyle:!0,controlsAutoHide:!1,hoverableSettingsHints:!1},scope:T.client,config:!1,requiresReload:!1},customFontsMenu:{tag:"v2-custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:game.system.id==="daggerheart"?'"Cinzel Decorative", Arial, sans-serif':'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:game.system.id==="daggerheart"?'"Cinzel Decorative", Arial, sans-serif':'"Roboto Slab", Arial, sans-serif'},scope:T.world,config:!1,requiresReload:!1},themeAndStylesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","applyDarkThemeToModules","adjustOtherModules","otherModulesList","forcedDarkTheme","customStyles","applyThemeToSheets"],default:{colorTheme:"crlngn-theme",applyDarkThemeToModules:!1,adjustOtherModules:!0,otherModulesList:"'combat-carousel','dice-tray','hurry-up','crux','fvtt-youtube-player','bg3-inspired-hotbar','touch-vtt','breaktime','simple-timekeeping'",forcedDarkTheme:"",customStyles:"",applyThemeToSheets:!0},scope:T.world,config:!1,requiresReload:!1},player_themeAndStylesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-player-theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["playerColorTheme","useHorizontalSheetTabs","useGlassEffect","glassTranslucence"],default:{playerColorTheme:"",useHorizontalSheetTabs:!0,useGlassEffect:!1,glassTranslucence:.7},scope:T.client,config:!1,requiresReload:!1},chatMessagesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,fields:["sideBarWidth","enableChatStyles","chatBorderColor","useLeftChatBorder","chatBorderPosition","openChatLogOnLoad","closeSidebarWhenIdle","useHorizontalSidebarTabs","showChatNotificationsOnTop"],default:{sideBarWidth:300,enableChatStyles:!0,chatBorderColor:Mt.playerColor.name,useLeftChatBorder:!0,chatBorderPosition:"left",openChatLogOnLoad:!1,closeSidebarWhenIdle:!1,useHorizontalSidebarTabs:!1,showChatNotificationsOnTop:!1},scope:T.client,config:!1,requiresReload:!1},leftControlsMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,fields:["controlsAutoHide"],default:{controlsAutoHide:!1},scope:T.client,config:!1,requiresReload:!1},playersListMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-players-list-menu",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),propType:Object,fields:["autoHidePlayerList","playerListAvatars"],default:{autoHidePlayerList:!1,playerListAvatars:!0},scope:T.client,config:!1,requiresReload:!1},sheets5eMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-sheets-5e-menu",label:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.hint"),propType:Object,fields:["applyThemeToSheets","useHorizontalSheetTabs"],default:{applyThemeToSheets:!0,useHorizontalSheetTabs:!0},scope:T.client,config:!1,requiresReload:!1},cameraDockMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,fields:["dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth"],default:{dockResizeOnUserJoin:He.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140},scope:T.client,config:!1,requiresReload:!1},sceneNavMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,fields:["hideLoadingSceneName","useSceneFolders","useSceneLookup","sceneClickToView","useSceneIcons","useSceneBackButton","useScenePreview","hideInactiveOnFolderToggle"],default:{hideLoadingSceneName:!0,useSceneFolders:!0,sceneClickToView:!0,useSceneIcons:!0,useSceneLookup:!0,useScenePreview:!0,useSceneBackButton:!0,hideInactiveOnFolderToggle:!0},scope:T.world,config:!1,requiresReload:!1},player_sceneNavMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-player-scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,fields:["navStartCollapsed","showNavOnHover","sceneItemWidth"],default:{navStartCollapsed:!1,showNavOnHover:!1,sceneItemWidth:150},scope:T.client,config:!1,requiresReload:!1},enforceGMSettings:{tag:"v2-enforce-gm-settings",label:game.i18n.localize("CRLNGN_UI.settings.enforceGMSettings.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enforceGMSettings.hint"),propType:Boolean,default:!1,scope:T.world,config:!0,requiresReload:!0},defaultSettings:{tag:"v2-default-settings",label:game.i18n.localize("CRLNGN_UI.settings.defaultSettings.label"),hint:game.i18n.localize("CRLNGN_UI.settings.defaultSettings.hint"),propType:Object,default:{},scope:T.world,config:!1,requiresReload:!1},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:T.client,config:!0,default:!1,requiresReload:!1},useSceneFolders:{tag:"v2-nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneFolders.hint"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},navFoldersForPlayers:{tag:"v2-nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},navStartCollapsed:{tag:"v2-nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},navShowRootFolders:{tag:"v2-nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},hideInactiveOnFolderToggle:{tag:"v2-hide-inactive-on-folder-toggle",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.hideInactiveOnFolderToggle.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.hideInactiveOnFolderToggle.hint"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},useSceneLookup:{tag:"v2-use-scene-lookup",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneLookup.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneLookup.hint"),propType:Boolean,default:!0,scope:T.world,config:!1,requiresReload:!1},sceneItemWidth:{tag:"v2-scene-nav-item-width",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneItemWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneItemWidth.hint"),propType:Number,inputType:_o.number,default:150,scope:T.client,config:!1},showNavOnHover:{tag:"v2-show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},hideLoadingSceneName:{tag:"v2-hide-loading-scene-name",oldName:"hideLoadingSceneName",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.hideLoadingSceneName.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.hideLoadingSceneName.hint"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},sceneClickToView:{tag:"v2-scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,default:!0,scope:T.world,config:!1,requiresReload:!1},useSceneIcons:{tag:"v2-use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,default:!0,scope:T.world,config:!1,requiresReload:!1},useSceneBackButton:{tag:"v2-use-scene-back-button",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.hint"),propType:Boolean,default:!0,scope:T.world,config:!1,requiresReload:!1},useScenePreview:{tag:"v2-use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,default:!0,scope:T.world,config:!1,requiresReload:!1},sceneNavCollapsed:{tag:"v2-scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},sceneNavPos:{tag:"v2-scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,default:0,scope:T.client,config:!1,requiresReload:!1},collapseMacroBar:{tag:"v2-collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},useFolderStyle:{tag:"v2-use-folder-style",label:game.i18n.localize("CRLNGN_UI.settings.useFolderStyle.label"),hint:game.i18n.localize("CRLNGN_UI.settings.useFolderStyle.hint"),propType:Boolean,default:!0,scope:T.world,config:!1,requiresReload:!1},debugMode:{tag:"v2-debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,default:!1,scope:T.client,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"v2-auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},playerListAvatars:{tag:"v2-player-list-avatars",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.hint"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},uiFontBody:{tag:"v2-ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:T.world,config:!1,requiresReload:!1},uiFontTitles:{tag:"v2-ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),propType:String,default:game.system.id==="daggerheart"?'"Cinzel Decorative", Arial, sans-serif':'"Roboto Slab", Arial, sans-serif',scope:T.world,config:!1,requiresReload:!1},journalFontBody:{tag:"v2-journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:T.world,config:!1,requiresReload:!1},journalFontTitles:{tag:"v2-journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),propType:String,default:game.system.id==="daggerheart"?'"Cinzel Decorative", Arial, sans-serif':'"Roboto Slab", Arial, sans-serif',scope:T.world,config:!1,requiresReload:!1},colorTheme:{tag:"v2-color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),propType:String,default:"crlngn-theme",scope:T.world,config:!1,requiresReload:!1},customThemeColors:{tag:"v2-custom-theme-colors",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customThemeColors.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customThemeColors.hint"),propType:Object,default:null,scope:T.world,config:!1,requiresReload:!1},applySecondaryColorToBg:{tag:"v2-apply-secondary-color-to-bg",label:game.i18n.localize("CRLNGN_UI.settings.colorPicker.applySecondaryColorToBg.label"),hint:game.i18n.localize("CRLNGN_UI.settings.colorPicker.applySecondaryColorToBg.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!0},playerColorTheme:{tag:"v2-player-color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.playerColorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.playerColorTheme.hint"),propType:String,default:"",scope:T.client,config:!1,requiresReload:!1},playerCustomThemeColors:{tag:"v2-player-custom-theme-colors",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.playerCustomThemeColors.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.playerCustomThemeColors.hint"),propType:Object,default:null,scope:T.client,config:!1,requiresReload:!1},useGlassEffect:{tag:"v2-use-glass-effect",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.useGlassEffect.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.useGlassEffect.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},glassTranslucence:{tag:"v2-glass-translucence",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.glassTranslucence.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.glassTranslucence.hint"),propType:Number,inputType:_o.number,default:.7,scope:T.client,config:!1,requiresReload:!1},adjustOtherModules:{tag:"v2-adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),propType:Boolean,default:!0,scope:T.world,config:!1,requiresReload:!1},applyDarkThemeToModules:{tag:"v2-dark-theme-to-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.applyDarkThemeToModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.applyDarkThemeToModules.hint"),propType:Boolean,default:!1,scope:T.world,config:!1,requiresReload:!0},otherModulesList:{tag:"v2-other-modules-list-a3",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),propType:Array,default:[{id:"levels-3d-preview",enabled:!0},{id:"beneos-module",enabled:!0},{id:"combat-carousel",enabled:!0},{id:"dice-calculator",enabled:!0},{id:"hurry-up",enabled:!0},{id:"crux",enabled:!0},{id:"fvtt-youtube-player",enabled:!0},{id:"bg3-inspired-hotbar",enabled:!0},{id:"touch-vtt",enabled:!0},{id:"breaktime",enabled:!0},{id:"simple-timekeeping",enabled:!0}],options:{"3D Canvas Mapmaking":"levels-3d-preview","Beneos Module":"beneos-module","BG3 Inspired Hotbar":"bg3-inspired-hotbar",Breaktime:"breaktime","Combat Carousel":"combat-carousel",Crux:"crux","Dice Tray":"dice-calculator","Hurry Up":"hurry-up","Simple Timekeeping & Calendar":"simple-timekeeping","Touch VTT":"touch-vtt","Youtube Player":"fvtt-youtube-player"},scope:T.world,config:!1,requiresReload:!1},customStyles:{tag:"v2-custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),propType:String,default:"",scope:T.world,config:!1,requiresReload:!0},forcedDarkTheme:{tag:"v2-forced-dark-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.forcedDarkTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.forcedDarkTheme.hint"),propType:String,default:"",scope:T.world,config:!1,requiresReload:!1},chatBorderColor:{tag:"v2-chat-border-color",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,default:Mt.playerColor.name,scope:T.client,config:!1,requiresReload:!0},chatBorderPosition:{tag:"v2-chat-border-position",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.hint"),options:{left:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.options.left"),right:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.options.right"),top:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.options.top"),all:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.options.all")},propType:String,default:To.left.name,scope:T.client,config:!1,requiresReload:!0},useLeftChatBorder:{tag:"v2-use-left-chat-border",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.hint"),propType:Boolean,inputType:_o.checkbox,default:!0,scope:T.client,config:!1,requiresReload:!0},enableChatStyles:{tag:"v2-enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!0},sideBarWidth:{tag:"v2-side-bar-width",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.sideBarWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.sideBarWidth.hint"),propType:Number,default:300,scope:T.client,config:!1,requiresReload:!1},openChatLogOnLoad:{tag:"v2-open-chat-log-on-load",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.openChatLogOnLoad.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.openChatLogOnLoad.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},closeSidebarWhenIdle:{tag:"v2-close-sidebar-when-idle",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.closeSidebarWhenIdle.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.closeSidebarWhenIdle.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},useHorizontalSidebarTabs:{tag:"v2-use-horizontal-sidebar-tabs",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useHorizontalSidebarTabs.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useHorizontalSidebarTabs.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},showChatNotificationsOnTop:{tag:"v2-show-chat-messages-on-top",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.showChatNotificationsOnTop.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.showChatNotificationsOnTop.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},controlsAutoHide:{tag:"v2-auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},dockPosX:{tag:"v2-camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),propType:Number,default:0,scope:T.client,config:!1,requiresReload:!1},dockPosY:{tag:"v2-camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),propType:Number,default:120,scope:T.client,config:!1,requiresReload:!1},dockWidth:{tag:"v2-camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),propType:Number,default:180,scope:T.client,config:!1,requiresReload:!1},dockHeight:{tag:"v2-camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),propType:Number,default:145,scope:T.client,config:!1,requiresReload:!1},dockResizeOnUserJoin:{tag:"v2-dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:He.horizontal.name,scope:T.client,config:!1,requiresReload:!1},defaultVideoWidth:{tag:"v2-default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),propType:Number,default:160,scope:T.client,config:!1,requiresReload:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:T.world,config:!1,default:"",requiresReload:!1},sceneControlsFadeOut:{tag:"v2-scene-controls-fade-out",oldName:"sceneControlsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},sidebarTabsFadeOut:{tag:"v2-sidebar-tabs-fade-out",oldName:"sidebarTabsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},chatLogControlsFadeOut:{tag:"v2-chat-log-controls-fade-out",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},playerListFadeOut:{tag:"v2-player-list-fade-out",oldName:"playerListFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},cameraDockFadeOut:{tag:"v2-camera-fade-out",oldName:"cameraDockFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},macroHotbarFadeOut:{tag:"v2-macro-hotbar-fade-out",oldName:"macroHotbarFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},sceneNavFadeOut:{tag:"v2-scene-nav-fade-out",oldName:"sceneNavFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},sceneControlsHide:{tag:"v2-scene-controls-hide",oldName:"sceneControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},sidebarTabsHide:{tag:"v2-sidebar-tabs-hide",oldName:"sidebarTabsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},chatLogControlsHide:{tag:"v2-chat-log-controls-hide",oldName:"chatLogControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},playerListHide:{tag:"v2-player-list-hide",oldName:"playerListHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},cameraDockHide:{tag:"v2-camera-dock-hide",oldName:"cameraDockHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},macroHotbarHide:{tag:"v2-macro-hotbar-hide",oldName:"macroHotbarHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},sceneNavHide:{tag:"v2-scene-nav-hide",oldName:"sceneNavHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},hoverableSettingsHints:{tag:"v2-hoverable-settings-hints",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.hoverableSettingsHints.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.hoverableSettingsHints.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!0},preventMacroBarReposition:{tag:"v2-prevent-macro-bar-reposition",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.preventMacroBarReposition.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.preventMacroBarReposition.hint"),propType:Boolean,default:!1,scope:T.client,config:!1,requiresReload:!1},sceneNavEnabled:{tag:"v2-scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!0},enableSceneControls:{tag:"v2-enable-scene-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},enableSidebarTabs:{tag:"v2-enable-sidebar-tabs",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},enableChatLogControls:{tag:"v2-enable-chat-log-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},enableMacroLayout:{tag:"v2-enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},enablePlayerList:{tag:"v2-enable-player-list",label:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.hint"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1},enableFloatingDock:{tag:"v2-enable-floating-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!0},applyThemeToSheets:{tag:"v2-apply-theme-and-styles",label:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.fields.applyThemeToSheets.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.fields.applyThemeToSheets.hint"),propType:Boolean,default:!0,scope:T.world,config:!1,requiresReload:!1},useHorizontalSheetTabs:{tag:"v2-use-horizontal-tabs",label:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.fields.useHorizontalSheetTabs.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.fields.useHorizontalSheetTabs.hint"),propType:Boolean,default:!0,scope:T.client,config:!1,requiresReload:!1}}}var zo,Wn;const vt=class vt{static isModuleOn(e){var o;const t=(o=game.modules)==null?void 0:o.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static async processStyleSheetRules(e,t){var o;try{if(((o=e.ownerNode)==null?void 0:o.tagName)==="STYLE"){const n=e.ownerNode.textContent;this.extractFontsFromCSSText(n,t)}try{const n=e.cssRules||e.rules;if(!n)return;for(let a=0;a<n.length;a++){const s=n[a];if(s instanceof CSSFontFaceRule){const r=s.style.getPropertyValue("font-family");r&&(t.add(r),g.log("Found font-face rule:",[r]))}else if(s instanceof CSSImportRule){if(g.log("Found import rule:",[s.href]),s.styleSheet)await this.processStyleSheetRules(s.styleSheet,t);else if(s.href)try{const i=await(await fetch(s.href)).text();this.extractFontsFromCSSText(i,t)}catch(r){g.warn("Error fetching imported CSS:",[r])}}}}catch(n){if(n.name==="SecurityError"&&e.href){g.log("Security restriction on stylesheet, trying to fetch directly:",[e.href]);try{const s=await(await fetch(e.href)).text();this.extractFontsFromCSSText(s,t)}catch(a){g.warn("Error fetching cross-origin stylesheet:",[a])}}else g.warn("Error accessing CSS rules:",[n])}}catch(n){g.warn("Error in processStyleSheetRules:",[n])}}static extractFontsFromCSSText(e,t){if(!e)return;const o=/@font-face\s*{[^}]*font-family\s*:\s*(['"])(.+?)\1[^}]*}/gs;(e.match(o)||[]).forEach(a=>{const s=/font-family\s*:\s*(['"])(.+?)\1/,r=a.match(s);if(r&&r[2]){const i=r[2].trim();t.add(i)}})}static getOffsetBottom(e){const t=e.offsetTop,o=e.offsetHeight;return window.innerHeight-(t+o)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},o=Object.entries(t).map(([s])=>s),n=await this.processStyleSheets();return Array.from(new Set([...e,...o,...n])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,r)=>s.toLowerCase().localeCompare(r.toLowerCase()))||[]}static addCSSVars(e,t){let o=document.querySelector("#crlngn-ui-vars");if(!o){const h=document.querySelector("body.crlngn-ui");if(!h)return;o=document.createElement("style"),o.id="crlngn-ui-vars",o.textContent=`body.crlngn-ui {
}
`,h.prepend(o)}let n=o.textContent,a=n.indexOf("body.crlngn-ui {"),s=n.indexOf("}",a);a===-1&&(n=`body.crlngn-ui {
}
`,a=0,s=n.indexOf("}"));const i=n.substring(a+16,s).split(";").map(h=>h.trim()).filter(h=>h!==""),d={};i.forEach(h=>{const C=h.split(":");if(C.length>=2){const b=C[0].trim(),v=C.slice(1).join(":").trim();b&&(d[b]=v)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),d[e]=t;const p=Object.entries(d).map(([h,C])=>`  ${h}: ${C};`).join(`
`),u=n.substring(0,a)+`body.crlngn-ui {
`+p+`
}`+n.substring(s+1);o.textContent=u}static addCustomCSS(e,t="crlngn-ui-custom-css",o=!0){if(!e)return;let n=document.querySelector("#"+t);n||(n=document.createElement("style"),n.id=t,n.textContent="",document.head.appendChild(n));const a=/@import\s+(?:url\()?\s*['"]?[^'")]+['"]?\s*\)?\s*;/g,s=[];let r=e,i;for(;(i=a.exec(e))!==null;)s.push(i[0]);if(r=e.replace(a,"").trim(),!o){n.textContent=s.join(`
`)+(s.length?`

`:"")+r;return}if(!n.textContent.includes(r)){const d=n.textContent,p=[];let u;for(;(u=a.exec(d))!==null;)p.push(u[0]);const h=d.replace(a,"").trim(),C=s.filter(v=>!p.includes(v)),b=[...p,...C];n.textContent=b.join(`
`)+(b.length?`

`:"")+h+(h&&r?`

`:"")+r}}static smoothScrollTo(e,t,o="horizontal",n=300,a=null){const s=e.dataset.scrollAnimationId;s&&cancelAnimationFrame(Number(s));const r=o==="horizontal",i=r?e.scrollLeft:e.scrollTop,d=t-i;if(d===0)return a&&a(),null;const p=performance.now(),u=C=>{const b=C-p;if(b>=n){r?e.scrollLeft=t:e.scrollTop=t,delete e.dataset.scrollAnimationId,a&&a();return}const v=b/n,G=v<.5?2*v*v:1-Math.pow(-2*v+2,2)/2;r?e.scrollLeft=i+d*G:e.scrollTop=i+d*G;const A=requestAnimationFrame(u);return e.dataset.scrollAnimationId=A,A},h=requestAnimationFrame(u);return e.dataset.scrollAnimationId=h,h}static confirmReload(e=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredTitle"),t=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredLabel"),o={}){const n={title:e,content:t,yes:{label:game.i18n.localize("CRLNGN_UI.ui.reloadButton"),callback:()=>(g.log("Reloading page after confirmation"),window.location.reload(),!0)},no:{label:game.i18n.localize("CRLNGN_UI.ui.cancelButton"),callback:()=>!1},defaultYes:!1,rejectClose:!1};return mergeObject(n,o),foundry.applications.api.DialogV2.confirm(n)}static renderTemplate(e,t){return foundry.applications.handlebars.renderTemplate(e,t)}static loadTemplate(e){return foundry.applications.handlebars.loadTemplate(e)}static loadTemplates(e){return foundry.applications.handlebars.loadTemplates(e)}static isValidCSSRule(e){if(!e||typeof e!="string")return!1;const t=e.trim();if(!t)return!1;try{const o=document.createElement("style"),n=`${t} { color: inherit; }`;o.textContent=n,document.head.appendChild(o);const a=!!(o.sheet&&o.sheet.cssRules&&o.sheet.cssRules.length>0);return document.head.removeChild(o),a}catch(o){return g.log("CSS validation error:",[o,e]),!1}}static processCSSRules(e,t){if(!e||!t)return"";const o=B(this,zo,Wn).call(this,e),n=t+` {
`+o.baseProperties.join(`
`)+`
}`,a=[],s=new Map;return o.nestedRules.forEach(r=>{const{selector:i,content:d}=r;if(i.startsWith("&")){const h=i.substring(1),C=t.split(",").map(b=>b.trim()).filter(Boolean).map(b=>b+h).join(", ");a.push(`${C} {
${d}
}`);return}s.has(d)||s.set(d,[]);const p=i.split(",").map(h=>h.trim()),u=t.split(",").map(h=>h.trim()).filter(Boolean);p.forEach(h=>{u.forEach(C=>{s.get(d).push(`${C} ${h}`)})})}),s.forEach((r,i)=>{a.push(`${r.join(", ")} {
${i}
}`)}),n+`

`+a.join(`

`)}};zo=new WeakSet,Wn=function(e){const t=[],o=[],n=e.split(`
`);let a=null,s=0;for(let r=0;r<n.length;r++){const i=n[r].trim();if(!i)continue;const d=(i.match(/{/g)||[]).length,p=(i.match(/}/g)||[]).length;if(i.includes("{")&&!a){a={selector:i.substring(0,i.indexOf("{")).trim(),content:"",startLine:r},s=1;const h=i.substring(i.indexOf("{")+1).trim();h&&!h.includes("}")&&(a.content+=h+`
`)}else a?(s+=d-p,s>0?a.content+=i+`
`:(a.content=a.content.replace(/}\s*$/,"").trim(),o.push(a),a=null)):!i.includes("{")&&!i.includes("}")&&t.push(i)}return{baseProperties:t,nestedRules:o}},R(vt,zo),y(vt,"processStyleSheets",async()=>{const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},o=Object.entries(t).map(([s])=>s),n=new Set;for(const s of document.styleSheets)try{if(s.ownerNode){const r=s.href||"",i=r.includes("css/")||r.includes("styles/"),d=r.includes("modules/crlngn-ui/"),p=r.includes("systems/");if(r&&!i&&!d&&!p)continue;await vt.processStyleSheetRules(s,n)}}catch(r){g.warn("Error processing stylesheet:",[r])}return g.log("Found fonts:",[{foundry:Array.from(e),custom:o,cssImported:Array.from(n)}]),Array.from(new Set([...e,...o,...n])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,r)=>s.toLowerCase().localeCompare(r.toLowerCase()))}),y(vt,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});let w=vt;var Ke,Yt,Xt;const x=class x{static init(){g.log("LeftControls - init",[]),Hooks.on(D.RENDER_SCENE_CONTROLS,x.initSceneControls),Hooks.on(D.ACTIVATE_SCENE_CONTROLS,x.onActivateSceneControls),window.addEventListener("resize",x.onActivateSceneControls),x.initSceneControls()}static applyFadeOut(e){x.useFadeOut=e,g.log("applyFadeOut",[e]),x.handleFadeOut()}static applyHide(e){x.hidden=e,x.handleHide()}static handleHide(e,t,o){const n=t||document.querySelector("#scene-controls");x.hidden?n==null||n.classList.add("hidden-ui"):n==null||n.classList.remove("hidden-ui"),g.log("handle Hide",[x.hidden])}static handleFadeOut(e,t,o){const n=t||document.querySelector("#scene-controls"),a=document.querySelector("#touch-vtt-controls");x.useFadeOut?(n==null||n.classList.add("faded-ui"),a==null||a.classList.add("faded-ui")):(n==null||n.classList.remove("faded-ui"),a==null||a.classList.remove("faded-ui")),g.log("handle FadeOut",[x.customStylesEnabled,x.useFadeOut])}static applyCustomStyle(e){var t;x.customStylesEnabled=e,g.log("applyCustomStyle",[x.customStylesEnabled,ui.controls]),(t=ui.controls)==null||t.render()}static resetLocalVars(){I(x,Ke,document.querySelector("#ui-left #controls")),I(x,Yt,document.querySelector("#ui-left"))}static initSceneControls(e,t,o){g.log("initSceneControls",[]),x.resetLocalVars();const n=document.querySelector("#interface");x.customStylesEnabled?n==null||n.classList.add("crlngn-controls"):n==null||n.classList.remove("crlngn-controls"),x.handleFadeOut(e,t,o),x.handleHide(e,t,o)}static observeControlsWidth(){if(g.log("observeControlsWidth",[]),!m(x,Ke))return;let e;const t=(o,n)=>{e||(e=setTimeout(()=>{o(),e=null},n))};I(x,Xt,new ResizeObserver(o=>{t(()=>x.updateCSSVars(),250)})),m(x,Xt).observe(m(x,Ke),{box:"border-box"}),x.updateCSSVars()}static updateCSSVars(){if(!m(x,Ke))return;let e=parseInt(m(x,Yt).offsetWidth),t=parseInt(m(x,Ke).offsetWidth),o=-e+t;g.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&w.addCSSVars("--ui-controls-margin-left",o+"px")}static onActivateSceneControls(e,t){const o=document.querySelector("#scene-controls");if(!o)return;const n=document.querySelectorAll("#scene-controls-layers .ui-control"),a=document.querySelectorAll("#scene-controls-tools .ui-control"),s=document.querySelector("#ui-left"),r=s?getComputedStyle(s).getPropertyValue("--control-columns"):"1";a.length>=n.length?(o.classList.add("more-tools"),Number(r)>2?o.classList.add("extra-columns"):o.classList.remove("extra-columns")):(o.classList.remove("more-tools"),o.classList.remove("extra-columns")),g.log("onActivateSceneControls",[r,a.length,n.length])}};Ke=new WeakMap,Yt=new WeakMap,Xt=new WeakMap,R(x,Ke),R(x,Yt),R(x,Xt),y(x,"useFadeOut",!0),y(x,"hidden",!1),y(x,"customStylesEnabled",!0),y(x,"preloadTemplates",async()=>{try{const e=[`modules/${MODULE_ID}/templates/chat-toggle-button.hbs`];return await w.loadTemplates(e),!0}catch(e){return g.log("Error loading navigation button templates:",[e]),!1}});let Ct=x;const{ApplicationV2:La,HandlebarsApplicationMixin:Na}=foundry.applications.api;var ae,Vn,jn,Eo,Lo,st;class gn extends Na(La){constructor(t={}){super(t);R(this,ae);this.callback=t.callback,this.scope=t.scope||"world",this.currentColors=t.currentColors||B(this,ae,jn).call(this),this.activeSecondaryTheme="dark",B(this,ae,Vn).call(this)}async _prepareContext(t){var s;const o=await super._prepareContext(t);o.accentHSL=Ce.rgbToHsl(this.currentColors.accent),o.secondaryDarkHSL=Ce.rgbToHsl(this.currentColors.secondaryDark||this.currentColors.secondary||J[0].colorPreview[0]),o.secondaryLightHSL=Ce.rgbToHsl(this.currentColors.secondaryLight||"rgb(223, 227, 231)"),o.themes=J;const n=k();o.applySecondaryColorToBg=L.get(n.applySecondaryColorToBg.tag)||!1,o.textOnAccent=Ce.getContrastRating("rgb(255, 255, 255)",this.currentColors.accent);const a=((s=getComputedStyle(document.documentElement).getPropertyValue("--control-bg-color"))==null?void 0:s.trim())||"rgb(11, 10, 19)";return o.accentOnBg=Ce.getContrastRating(this.currentColors.accent,a),o.currentColors=this.currentColors,o.secondaryColorDark=this.currentColors.secondaryDark||this.currentColors.secondary||J[0].colorPreview[0],o.secondaryColorLight=this.currentColors.secondaryLight||"rgb(223, 227, 231)",o}async _preparePartContext(t,o,n){const a=await super._preparePartContext(t,o,n);switch(t){case"footer":{a.buttons=[{type:"button",icon:"",label:"Cancel",action:"close"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.colorPicker.apply",action:"submit"}];break}}return a}async _onSubmit(t){t.preventDefault();const o=k(),n=game.user.isGM?o.customThemeColors.tag:o.playerCustomThemeColors.tag,a=this.element.querySelector(".color-picker-content"),s=new FormData;a.querySelectorAll('input[type="range"]').forEach(C=>{s.append(C.name,C.value)}),a.querySelectorAll('input[type="checkbox"]').forEach(C=>{s.append(C.name,C.checked)});const d=Object.fromEntries(s.entries()),u={accent:Ce.hslToRgb(parseInt(d.accentHue),parseInt(d.accentSaturation),parseInt(d.accentLightness)),secondaryDark:this.currentColors.secondaryDark||J[0].colorPreview[1],secondaryLight:this.currentColors.secondaryLight||J[0].colorPreview[0]||"rgb(223, 227, 231)"};await L.set(n,u);let h=!1;if(game.user.isGM&&d.applySecondaryColorToBg!==void 0){const C=L.get(o.applySecondaryColorToBg.tag),b=d.applySecondaryColorToBg==="true";await L.set(o.applySecondaryColorToBg.tag,b),o.applySecondaryColorToBg.requiresReload&&C!==b&&(h=!0)}Ce.applyCustomTheme(u),h&&w.confirmReload(),this.callback&&this.callback(u),this.close()}_onSecondaryTabClick(t){var C,b,v;const o=t.currentTarget,n=o.dataset.theme;this.element.querySelectorAll(".secondary-tab").forEach(G=>{G.classList.remove("active")}),o.classList.add("active"),this.activeSecondaryTheme=n;const a=n==="dark"?this.currentColors.secondaryDark||this.currentColors.secondary||J[0].colorPreview[1]:this.currentColors.secondaryLight||"rgb(223, 227, 231)",s=Ce.rgbToHsl(a),r=this.element.querySelector('[name="secondaryHue"]'),i=this.element.querySelector('[name="secondarySaturation"]'),d=this.element.querySelector('[name="secondaryLightness"]');r&&(r.value=s.h),i&&(i.value=s.s),d&&(d.value=s.l);const p=(C=this.element.querySelector('[name="secondaryHue"]'))==null?void 0:C.parentElement,u=(b=this.element.querySelector('[name="secondarySaturation"]'))==null?void 0:b.parentElement,h=(v=this.element.querySelector('[name="secondaryLightness"]'))==null?void 0:v.parentElement;p&&(p.querySelector(".value").textContent=s.h),u&&(u.querySelector(".value").textContent=s.s+"%"),h&&(h.querySelector(".value").textContent=s.l+"%"),B(this,ae,Lo).call(this),B(this,ae,Eo).call(this)}_onClickPreset(t){const n=t.currentTarget.dataset.theme,a=J.find(s=>s.className===n);a&&(this.currentColors={accent:a.colorPreview[2],secondaryDark:a.colorPreview[1],secondaryLight:a.colorPreview[0]},this.render())}_onColorChange(t){const o=t.currentTarget,n=this.element.querySelector(".color-picker-content");g.log("ColorPickerDialog._onColorChange",[o]);const a=o.parentElement.querySelector(".value");if(a){const b=o.name.includes("Hue")?"":"%";a.textContent=o.value+b}const s=parseInt(n.querySelector('[name="accentHue"]').value),r=parseInt(n.querySelector('[name="accentSaturation"]').value),i=parseInt(n.querySelector('[name="accentLightness"]').value),d=parseInt(n.querySelector('[name="secondaryHue"]').value),p=parseInt(n.querySelector('[name="secondarySaturation"]').value),u=parseInt(n.querySelector('[name="secondaryLightness"]').value),h=Ce.hslToRgb(s,r,i),C=Ce.hslToRgb(d,p,u);this.activeSecondaryTheme==="dark"?this.currentColors.secondaryDark=C:this.currentColors.secondaryLight=C,this.currentColors.accent=h,g.log("ColorPickerDialog._onColorChange",[this.currentColors]),B(this,ae,Eo).call(this),B(this,ae,Lo).call(this)}_onRender(t,o){super._onRender(t,o),g.log("ColorPickerDialog._onRender",[this.element]),this.element.querySelectorAll(".preset-button").forEach(n=>{n.addEventListener("click",this._onClickPreset.bind(this))}),this._onSecondaryTabClick&&this.element.querySelectorAll(".secondary-tab").forEach(n=>{n.addEventListener("click",this._onSecondaryTabClick.bind(this))}),this.element.querySelectorAll('input[type="range"]').forEach(n=>{n.addEventListener("input",this._onColorChange.bind(this))}),this.element.querySelectorAll('button[type="submit"]').forEach(n=>{n.addEventListener("click",this._onSubmit.bind(this))}),this.element.querySelectorAll("button.cancel").forEach(n=>{n.addEventListener("click",()=>{this.close()})}),B(this,ae,Lo).call(this),B(this,ae,Eo).call(this)}}ae=new WeakSet,Vn=async function(){const t=k(),o=game.user.isGM?t.customThemeColors.tag:t.playerCustomThemeColors.tag;if(!L.get(o)){const a=game.user.isGM?t.colorTheme.tag:t.playerColorTheme.tag,s=L.get(a);if(s){const r=Ce.migrateFromOldTheme(s);try{await L.set(o,r),this.currentColors=r,this.render()}catch{}}}},jn=function(){const t=this.scope==="player"?"v2-player-custom-theme-colors":"v2-custom-theme-colors",o=L.get(t);if(o!=null&&o.accent&&(o!=null&&o.secondaryDark))return o;if(this.scope==="player"){const n=L.get("v2-custom-theme-colors");if(n!=null&&n.accent&&(n!=null&&n.secondaryDark))return n}return{accent:J[0].colorPreview[2],secondaryDark:J[0].colorPreview[1],secondaryLight:J[0].colorPreview[0]||"rgb(223, 227, 231)"}},Eo=function(){var r;const t=this.element.querySelector(".color-picker-content");if(!t)return;const o=((r=getComputedStyle(document.documentElement).getPropertyValue("--control-bg-color"))==null?void 0:r.trim())||"rgb(11, 10, 19)",n="rgb(240, 240, 240)";t.querySelectorAll(".accent-preview .preview-item").forEach((i,d)=>{if(d===0){i.style.backgroundColor=this.currentColors.accent,i.style.color=n;const p=Ce.getContrastRating(n,this.currentColors.accent),u=i.querySelector(".contrast-rating");u&&(u.textContent=p.label,u.className=`contrast-rating ${p.class}`,u.style.color=n)}else if(d===1){i.style.backgroundColor=o,i.style.color=this.currentColors.accent,i.classList.remove("inverted");const p=Ce.getContrastRating(this.currentColors.accent,o),u=i.querySelector(".contrast-rating");u&&(u.textContent=p.label,u.className=`contrast-rating ${p.class}`,u.style.color=this.currentColors.accent)}});const s=t.querySelectorAll(".secondary-preview .preview-item");if(s.length>0){const i=this.currentColors.secondaryDark||this.currentColors.secondary||J[0].colorPreview[0];if(s[0].style.backgroundColor=i,s[1]){const d=this.currentColors.secondaryLight||"rgb(223, 227, 231)";s[1].style.backgroundColor=d}}},Lo=function(){const t=this.element.querySelector(".color-picker-content");if(!t)return;const o=parseInt(t.querySelector('[name="accentHue"]').value),n=parseInt(t.querySelector('[name="accentSaturation"]').value),a=parseInt(t.querySelector('[name="accentLightness"]').value),s=parseInt(t.querySelector('[name="secondaryHue"]').value),r=parseInt(t.querySelector('[name="secondarySaturation"]').value),i=parseInt(t.querySelector('[name="secondaryLightness"]').value);B(this,ae,st).call(this,"accentHue","hue",o,n,a),B(this,ae,st).call(this,"accentSaturation","saturation",o,n,a),B(this,ae,st).call(this,"accentLightness","lightness",o,n,a),B(this,ae,st).call(this,"secondaryHue","hue",s,r,i),B(this,ae,st).call(this,"secondarySaturation","saturation",s,r,i),B(this,ae,st).call(this,"secondaryLightness","lightness",s,r,i)},st=function(t,o,n,a,s){const r=this.element.querySelector(`[name="${t}"]`);if(!r)return;let i="";switch(o){case"hue":i=`linear-gradient(to right, 
          hsl(0, ${a}%, 50%) 0%, 
          hsl(60, ${a}%, 50%) 16.66%, 
          hsl(120, ${a}%, 50%) 33.33%, 
          hsl(180, ${a}%, 50%) 50%, 
          hsl(240, ${a}%, 50%) 66.66%, 
          hsl(300, ${a}%, 50%) 83.33%, 
          hsl(360, ${a}%, 50%) 100%)`;break;case"saturation":i=`linear-gradient(to right, 
          hsl(${n}, 0%, 50%) 0%, 
          hsl(${n}, 100%, 50%) 100%)`;break;case"lightness":i=`linear-gradient(to right, 
          hsl(${n}, ${a}%, 0%) 0%, 
          hsl(${n}, ${a}%, 50%) 50%, 
          hsl(${n}, ${a}%, 100%) 100%)`;break}r.style.background=i,r.style.backgroundSize="100% 100%",r.style.backgroundRepeat="no-repeat"},y(gn,"DEFAULT_OPTIONS",{id:"crlngn-color-picker",tag:"div",window:{icon:"fas fa-palette",title:"CRLNGN_UI.settings.colorPicker.title",contentClasses:["crlngn","color-picker-dialog","standard-form"],resizable:!0},position:{width:600,height:"auto"}}),y(gn,"PARTS",{form:{template:"modules/crlngn-ui/templates/color-picker-dialog.hbs"},footer:{template:"templates/generic/form-footer.hbs",isGMOnly:!1}});class Ce{static rgbToHsl(e){const t=e.match(/\d+/g);if(!t)return{h:0,s:0,l:0};let[o,n,a]=t.map(u=>parseInt(u)/255);const s=Math.max(o,n,a),r=Math.min(o,n,a);let i,d,p=(s+r)/2;if(s===r)i=d=0;else{const u=s-r;switch(d=p>.5?u/(2-s-r):u/(s+r),s){case o:i=((n-a)/u+(n<a?6:0))/6;break;case n:i=((a-o)/u+2)/6;break;case a:i=((o-n)/u+4)/6;break}}return{h:Math.round(i*360),s:Math.round(d*100),l:Math.round(p*100)}}static hslToRgb(e,t,o){e=e/360,t=t/100,o=o/100;let n,a,s;if(t===0)n=a=s=o;else{const r=(p,u,h)=>(h<0&&(h+=1),h>1&&(h-=1),h<.16666666666666666?p+(u-p)*6*h:h<.5?u:h<.6666666666666666?p+(u-p)*(.6666666666666666-h)*6:p),i=o<.5?o*(1+t):o+t-o*t,d=2*o-i;n=r(d,i,e+1/3),a=r(d,i,e),s=r(d,i,e-1/3)}return`rgb(${Math.round(n*255)}, ${Math.round(a*255)}, ${Math.round(s*255)})`}static getContrastRatio(e,t){const o=i=>{const d=i.match(/\d+/g);if(!d)return 0;const[p,u,h]=d.map(C=>{const b=parseInt(C)/255;return b<=.03928?b/12.92:Math.pow((b+.055)/1.055,2.4)});return .2126*p+.7152*u+.0722*h},n=o(e),a=o(t),s=Math.max(n,a),r=Math.min(n,a);return(s+.05)/(r+.05)}static getContrastRating(e,t){const o=this.getContrastRatio(e,t);return o>=4.5?{label:game.i18n.localize("CRLNGN_UI.settings.colorPicker.contrastGood"),class:"good"}:o>=2.5?{label:game.i18n.localize("CRLNGN_UI.settings.colorPicker.contrastMedium"),class:"medium"}:{label:game.i18n.localize("CRLNGN_UI.settings.colorPicker.contrastPoor"),class:"poor"}}static generateColorVariations(e,t,o="dark"){const n={},a=e.match(/\d+/g);if(!a)return n;const[s,r,i]=a.map(h=>parseInt(h)),d=k(),p=L.get(d.applySecondaryColorToBg.tag)||!1,u=o==="light";if(t==="accent")n["--color-warm-2"]=e,n["--color-highlights"]=e,n["--color-warm-1"]=`rgb(${Math.min(255,s+30)}, ${Math.min(255,r+30)}, ${Math.min(255,i+30)})`,n["--color-warm-3"]=`rgb(${Math.max(0,s-30)}, ${Math.max(0,r-30)}, ${Math.max(0,i-30)})`,n["--color-highlights-15"]=`rgba(${s}, ${r}, ${i}, 0.15)`,n["--color-highlights-25"]=`rgba(${s}, ${r}, ${i}, 0.25)`,n["--color-highlights-50"]=`rgba(${s}, ${r}, ${i}, 0.5)`,n["--color-highlights-75"]=`rgba(${s}, ${r}, ${i}, 0.75)`,n["--color-highlights-90"]=`rgba(${s}, ${r}, ${i}, 0.9)`,n["--color-border-highlight"]=e,n["--color-border-highlight-alt"]=`rgba(${s}, ${r}, ${i}, 0.9)`,n["--color-shadow-highlight"]=`rgba(${s}, ${r}, ${i}, 0.5)`,n["--color-shadow-primary"]=`rgba(${s}, ${r}, ${i}, 0.8)`,n["--color-border-light-primary"]=`rgba(${s}, ${r}, ${i}, 0.5)`,n["--color-border-light-highlight"]=e,n["--color-underline-header"]=e,n["--color-underline-active"]=e,n["--color-text-hyperlink"]=e,n["--color-scrollbar"]=`rgba(${s}, ${r}, ${i}, 0.7)`,n["--color-scrollbar-border"]=`rgba(${s}, ${r}, ${i}, 0.75)`,n["--control-active-border-color"]=e,n["--color-text-accent"]=e;else if(t==="secondary"){n["--color-secondary"]=e,n["--color-secondary-bright"]=`rgb(${Math.min(255,s+120)}, ${Math.min(255,r+120)}, ${Math.min(255,i+120)})`,n["--color-secondary-bright-50"]=`rgba(${Math.min(255,s+120)}, ${Math.min(255,r+120)}, ${Math.min(255,i+120)}, 0.5)`,n["--color-secondary-15"]=`rgba(${s}, ${r}, ${i}, 0.15)`,n["--color-secondary-25"]=`rgba(${s}, ${r}, ${i}, 0.25)`,n["--color-secondary-50"]=`rgba(${s}, ${r}, ${i}, 0.5)`,n["--color-secondary-65"]=`rgba(${s}, ${r}, ${i}, 0.65)`,n["--color-secondary-75"]=`rgba(${s}, ${r}, ${i}, 0.75)`,n["--color-secondary-90"]=`rgba(${s}, ${r}, ${i}, 0.9)`,n["--color-secondary-b"]=`rgb(${Math.max(0,s-30)}, ${Math.max(0,r-30)}, ${Math.max(0,i-30)})`,n["--color-secondary-b-25"]=`rgba(${Math.max(0,s-30)}, ${Math.max(0,r-30)}, ${Math.max(0,i-30)}, 0.25)`,n["--color-secondary-b-50"]=`rgba(${Math.max(0,s-30)}, ${Math.max(0,r-30)}, ${Math.max(0,i-30)}, 0.5)`,n["--color-secondary-b-75"]=`rgba(${Math.max(0,s-30)}, ${Math.max(0,r-30)}, ${Math.max(0,i-30)}, 0.75)`,n["--color-secondary-b-90"]=`rgba(${Math.max(0,s-30)}, ${Math.max(0,r-30)}, ${Math.max(0,i-30)}, 0.9)`;const h=this.rgbToHsl(e);if(u){const C=Math.min(30,h.l-40);n["--color-text-secondary"]=this.hslToRgb(h.h,h.s,C)}else{const C=Math.max(70,h.l+40);n["--color-text-secondary"]=this.hslToRgb(h.h,h.s,C)}if(n["--color-ownership-none"]=e,n["--color-fieldset-border"]=`rgba(${s}, ${r}, ${i}, 0.25)`,n["--input-border-color"]=e,p){const C=s,b=r,v=i,G=`rgb(${C}, ${b}, ${v})`;n["--color-cool-5"]=G,n["--color-cool-5-15"]=`rgba(${C}, ${b}, ${v}, 0.15)`,n["--color-cool-5-25"]=`rgba(${C}, ${b}, ${v}, 0.25)`,n["--color-cool-5-50"]=`rgba(${C}, ${b}, ${v}, 0.5)`,n["--color-cool-5-75"]=`rgba(${C}, ${b}, ${v}, 0.75)`,n["--color-cool-5-90"]=`rgba(${C}, ${b}, ${v}, 0.95)`,n["--background"]=`rgba(${C}, ${b}, ${v}, var(--background-opacity, 0.98))`,n["--background-color"]=`rgba(${C}, ${b}, ${v}, 0.75)`,n["--control-bg-color"]=`rgba(${C}, ${b}, ${v}, 0.75)`,n["--sidebar-background"]=`rgba(${C}, ${b}, ${v}, 0.94)`,n["--color-bg-button"]="light-dark(rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1))"}else{const C=u?224:11,b=u?217:10,v=u?213:19,G=u?.98:.95;n["--background"]=`rgba(${C}, ${b}, ${v}, var(--background-opacity, ${G}))`}}return n}static applyCustomTheme(e){var C;const t=k(),o=L.get(t.applySecondaryColorToBg.tag)||!1,n=document.getElementById("crlngn-custom-theme-style");n&&n.remove();const a=game.settings.get("core","uiConfig");(C=a==null?void 0:a.colorScheme)!=null&&C.interface;const s=this.generateColorVariations(e.accent,"accent"),r=e.secondaryDark||e.secondary||J[0].colorPreview[0],i=e.secondaryLight||"rgb(223, 227, 231)";g.log("Secondary colors",[r,i]);const d=this.generateColorVariations(r,"secondary","dark"),p=this.generateColorVariations(i,"secondary","light");let u=`body.crlngn-ui, body.crlngn-ui.game .app {
`;for(const[b,v]of Object.entries(s))u+=`  ${b}: ${v};
`;u+=`}
`,u+=`
      body.crlngn-ui.theme-dark,
      body.crlngn-ui.theme-dark .app,
      body.crlngn-ui.theme-dark .application:not(.sheet, .theme-light, .monks-enhanced-journal),
      body.crlngn-ui #interface.theme-dark,
      body.crlngn-ui #tooltip.theme-dark,
      body.crlngn-ui .application.theme-dark,
      body.crlngn-ui .sidebar-popout.theme-dark,
      body.crlngn-ui .themed.theme-dark .ui-control, 
      body.crlngn-ui .themed.theme-dark .placeable-hud, 
      body.crlngn-ui .themed.theme-dark #measurement .waypoint-label,
      body.crlngn-ui .themed.theme-dark #players {
        ${Object.entries(d).map(([b,v])=>`${b}: ${v};`).join(`
    `)}
      }
      
      body.crlngn-ui.theme-light,
      body.crlngn-ui.theme-light .app,
      body.crlngn-ui.theme-light .application:not(.sheet, .theme-dark),
      body.crlngn-ui #interface.theme-light,
      body.crlngn-ui .application.theme-light,
      body.crlngn-ui #interface.theme-light,
      body.crlngn-ui .sidebar-popout.theme-light,
      body.crlngn-ui .themed.theme-light .ui-control, 
      body.crlngn-ui .themed.theme-light .placeable-hud, 
      body.crlngn-ui .themed.theme-light #measurement .waypoint-label,
      body.crlngn-ui .themed.theme-light #players,
      body.crlngn-ui #tooltip.theme-light  {
        ${Object.entries(p).map(([b,v])=>`${b}: ${v};`).join(`
    `)}
      }
    `,o&&(u+=`
        body.crlngn-ui {
          --tools-visible-opacity: 0.75;
        }
        body.crlngn-ui .application.sheet.journal-sheet:not(.dnd5e2-journal),
        body.crlngn-ui .application.sheet.journal-sheet:not(.dnd5e2-journal) * {
          --color-light-1: light-dark(var(--color-dark-1), var(--color-light-1));
          --input-text-color: light-dark(var(--color-dark-1), var(--color-light-1));
        }
        body.crlngn-ui.theme-dark input[type=checkbox], 
        body.crlngn-ui.theme-dark input[type=radio]{
          --checkbox-background-color: light-dark(rgba(0, 0, 0, 0.25), rgba(255, 255, 255, 0.2));
        } 
      `);const h=document.createElement("style");h.id="crlngn-custom-theme-style",h.textContent=u,document.head.appendChild(h),g.log("Applied custom theme",[e,u])}static migrateFromOldTheme(e){const t=J.find(o=>o.className===e);return t?{accent:t.colorPreview[2],secondaryDark:t.colorPreview[1],secondaryLight:t.colorPreview[0]}:{accent:J[0].colorPreview[2],secondaryDark:J[0].colorPreview[1],secondaryLight:J[0].colorPreview[0]}}}var Jt,Fe,Kt,Yn,wa;const fe=class fe{static init(){var o;if(m(fe,Jt)){g.log("HintTooltipUtil already initialized, skipping",[]);return}const e=k(),t=L.get(e.hoverableSettingsHints.tag);g.log("HintTooltipUtil init called",[t,e.hoverableSettingsHints.tag]),t?(g.log("HintTooltipUtil: Setting is enabled, registering hook",[]),B(o=fe,Kt,Yn).call(o)):g.log("HintTooltipUtil: Setting is disabled, not registering hook",[]),I(fe,Jt,!0),g.log("HintTooltipUtil initialized",[t])}static applyHintHandlers(e){var n;if(!e)return;e.classList?e.classList.add("crlngn-hints"):(n=e[0])!=null&&n.classList&&e[0].classList.add("crlngn-hints");const t=e.querySelectorAll(".form-group");g.log("Applying hint handlers to form groups:",[t.length]);let o=0;t.forEach(a=>{const s=a.querySelector("p.hint, p.notes, div.notes");if(!s||s.classList.contains("on")||s.classList.contains("shown"))return;const r=a.querySelector("label, span.label");if(!r||a.dataset.hintEnhanced==="true")return;a.dataset.hintEnhanced="true",o++;let i,d;const p=Array.from(r.childNodes),u=p.filter(A=>A.nodeType===Node.TEXT_NODE),h=p.filter(A=>A.nodeType===Node.ELEMENT_NODE),b=u.map(A=>A.textContent).join("").trim().split(/\s+/).filter(A=>A.length>0);if(b.length>1){const A=b.pop(),V=b.join(" ");u.forEach(ce=>ce.remove());const Y=h.length>0?h[h.length-1]:null,X=document.createTextNode(V+" ");Y&&Y.nextSibling?r.insertBefore(X,Y.nextSibling):Y?r.appendChild(X):r.insertBefore(X,r.firstChild);const ue=document.createElement("span");ue.style.whiteSpace="nowrap",ue.textContent=A+" ";const ne=document.createElement("span");ne.className="crlngn-hint-icon",ne.textContent="?",ne.style.cursor="help",ue.appendChild(ne),r.appendChild(ue)}else if(b.length===1){const A=document.createElement("span");A.className="crlngn-hint-icon",A.textContent="?",A.style.cursor="help",r.appendChild(A)}const v=r.querySelector(".crlngn-hint-icon");g.log("Icon span found for hint",[!!v,r.textContent]);const G=A=>{if(!v)return!1;const V=v.getBoundingClientRect(),Y=A.clientX,X=A.clientY;return Y>=V.left&&Y<=V.right&&X>=V.top&&X<=V.bottom};r.addEventListener("click",A=>{s.classList.contains("shown")||G(A)&&(a.classList.toggle("show-hint"),A.preventDefault(),A.stopPropagation())}),r.addEventListener("mousemove",A=>{if(s.classList.contains("shown")){r.style.cursor="default";return}const V=G(A);g.log("Mousemove over label",[V,!!v]),V?(r.style.cursor="help",!a.classList.contains("show-hint")&&!d&&(clearTimeout(i),d=setTimeout(()=>{const Y=s.offsetHeight||s.scrollHeight,ue=.5*parseFloat(getComputedStyle(document.documentElement).fontSize),ne=Y+ue;g.log("Hint height calculation",[Y,s.offsetHeight,s.scrollHeight,ne]);let ce=a.parentElement;for(;ce&&ce!==document.body;){const Me=window.getComputedStyle(ce).overflowY;if(Me==="auto"||Me==="scroll")break;ce=ce.parentElement}if(ce&&ce!==document.body){const Me=ce.getBoundingClientRect(),he=a.getBoundingClientRect(),We=he.top-ne<Me.top;g.log("Clipping check",[We,he.top,ne,Me.top]),We?a.classList.add("hint-below"):a.classList.remove("hint-below")}a.classList.add("show-hint"),d=null},500))):(r.style.cursor="default",d&&(clearTimeout(d),d=null))}),r.addEventListener("mouseleave",()=>{r.style.cursor="default",d&&(clearTimeout(d),d=null),!s.classList.contains("shown")&&(i=setTimeout(()=>{a.classList.remove("show-hint")},500))}),s.addEventListener("mouseenter",()=>{s.classList.contains("shown")||(clearTimeout(i),a.classList.add("show-hint"))}),s.addEventListener("mouseleave",()=>{s.classList.contains("shown")||(i=setTimeout(()=>{a.classList.remove("show-hint")},500))})}),g.log("Set up hint handlers for form groups with hints",[o])}};Jt=new WeakMap,Fe=new WeakMap,Kt=new WeakSet,Yn=function(){if(m(fe,Fe)){g.log("HintTooltipUtil: Hook already registered, skipping",[]);return}g.log("HintTooltipUtil: Registering hooks for ApplicationV2 forms",[]);const e=[D.RENDER_SETTINGS_CONFIG,D.RENDER_MODULE_MANAGEMENT,D.RENDER_CONFIG_PANEL],t=[];e.forEach(n=>{const a=Hooks.on(n,(s,r)=>{const i=s.element;g.log(`HintTooltipUtil: ${n} hook called`,[s.constructor.name,i==null?void 0:i.id,i==null?void 0:i.className]),fe.applyHintHandlers(i)});t.push(a)});const o=Hooks.on(D.RENDER_APPLICATION_V2,(n,a)=>{const s=n.element;if(!s)return;const r=s.querySelector(".form-group")!==null,i=s.querySelector("form.standard-form")!==null;(r||i)&&setTimeout(()=>{fe.applyHintHandlers(s)},10)});t.push(o),I(fe,Fe,t),g.log("HintTooltipUtil hook registered")},wa=function(){if(m(fe,Fe)){const t=[D.RENDER_SETTINGS_CONFIG,D.RENDER_MODULE_MANAGEMENT,D.RENDER_CONFIG_PANEL,D.RENDER_APPLICATION_V2],o=Array.isArray(m(fe,Fe))?m(fe,Fe):[m(fe,Fe)];t.forEach((n,a)=>{o[a]&&Hooks.off(n,o[a])}),I(fe,Fe,null),g.log("HintTooltipUtil hooks unregistered")}const e=document.querySelectorAll(".crlngn-hints");e.forEach(t=>{t.classList.remove("crlngn-hints")}),g.log("HintTooltipUtil: Removed enhancements from existing forms",[e.length])},R(fe,Kt),R(fe,Jt,!1),R(fe,Fe,null);let Mo=fe;foundry.utils;const{ApplicationV2:ka,HandlebarsApplicationMixin:Ra}=foundry.applications.api;var $n,ee,Lt,En,ye,Xn,Jn,Kn,pn,hn,Zn;const O=class O extends Ra(ka){constructor(){super(...arguments);y(this,"_onRender",(t,o)=>{g.log("_onRender called",[t,o]);const n=k();I(O,ee,this.element),g.log("Element set",[m(O,ee)]),m(O,ee).querySelectorAll('input[type="range"]').forEach(i=>{const d=i.name,p=m(O,ee).querySelector(`input[type="number"].range-value-input[name="${d}_value"]`);p&&O.handleRangeInputs(i,p)});const s=m(O,ee).querySelectorAll(".toggle-hint");g.log("_onRender",[t,o,this.element]),s.forEach(i=>{i.addEventListener("click",()=>{m(O,ee).querySelectorAll("p.hint").forEach(d=>d.classList.toggle("shown"))})}),O.handleCustomFontFields(),O.handleThemeAndStyleFields(),O.handleSheetFields(),L.get(n.hoverableSettingsHints.tag)&&Mo.applyHintHandlers(this.element),g.log("_onRender",[t,o])})}_configureRenderParts(t){const o=super._configureRenderParts(t),n=O.getRestrictedTabs();return game.user.isGM||n.forEach(a=>{delete o[a]}),o}async _prepareContext(t){const o=await super._prepareContext(t);o.activeTab=t.activeTab||Object.keys(o.tabs)[0],o.isGM=game.user.isGM,k(),o.themes=J;const n=await w.getAllFonts();return o.fontList=n,o}async _preparePartContext(t,o,n){var r,i,d;const a=await super._preparePartContext(t,o,n);t in o.tabs&&(a.tab=a.tabs[t]),k(),Qn();const s=O.getRestrictedTabs();switch(game.user.isGM||s.forEach(p=>{delete a.tabs[p]}),t){case"tabs":break;case"footer":{a.buttons=[{type:"button",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.save"}];break}default:{a.tab=a.tabs[t];const p=((r=O.PARTS[t])==null?void 0:r.menuKey)||null;if(p){const u=O.getMenuContext(p);if(u.fields&&(a.fields={...a.fields,...u.fields}),u.fieldDefaults&&(a.fieldDefaults={...a.fieldDefaults,...u.fieldDefaults}),u.fieldValues){if(t==="themes"){const h=J.find(b=>b.className===u.fieldValues.colorTheme);u.fieldValues.colorTheme=(h==null?void 0:h.label)||J[0].label;const C=J.find(b=>b.className===u.fieldValues.playerColorTheme);u.fieldValues.playerColorTheme=(C==null?void 0:C.label)||""}Object.assign(a,u.fieldValues)}if(t==="themes"){const h=L.get("v2-custom-theme-colors"),C=L.get("v2-player-custom-theme-colors"),b=A=>{if(!A.secondary)return A;const V=A.secondary.match(/\d+/g);if(V){const[Y,X,ue]=V.map(ne=>parseInt(ne));return{...A,secondaryLight:`rgb(${Math.min(255,Y+150)}, ${Math.min(255,X+150)}, ${Math.min(255,ue+150)})`,secondaryDark:A.secondary}}return A},v=h||{accent:J[0].colorPreview[1],secondary:J[0].colorPreview[0]};a.customColors=b(v);const G=C||h||{accent:J[0].colorPreview[1],secondary:J[0].colorPreview[0]};a.playerCustomColors=b(G),a.otherModulesList&&Array.isArray(a.otherModulesList)?(a.otherModulesListJson=JSON.stringify(a.otherModulesList),a.adjustOtherModules=a.otherModulesList.some(A=>A.enabled),g.log("Form preparation - otherModulesList",[a.otherModulesList,"anyEnabled:",a.adjustOtherModules])):g.log("Form preparation - otherModulesList is empty or not an array",[a.otherModulesList])}a.sidebarTabs=Object.values(((d=(i=foundry.applications)==null?void 0:i.sidebar)==null?void 0:d.tabs)||{}).map(h=>({tabName:h.tabName,name:h.name,hideForGM:!1,hideForPlayer:!1,localizedName:`CRLNGN_UI.settings.sidebarTabs.${h.name}`}))}break}}return g.log("_preparePartContext",[a,t]),a}static getMenuContext(t){var d,p;const o=k(),n=((d=o[t])==null?void 0:d.fields)||[],a=((p=o["player_"+t])==null?void 0:p.fields)||[];if(!n||n.length===0)return{};const s={},r={},i={};return n==null||n.forEach(u=>{if(o[u]){const h=L.get(o[u].tag);s[u]=o[u],r[u]=h!==void 0?h:o[u].default,i[u]=o[u].default}}),a==null||a.forEach(u=>{if(o[u]){const h=L.get(o[u].tag);s[u]=o[u],r[u]=h!==void 0?h:o[u].default,i[u]=o[u].default}}),{fields:s,fieldValues:r,fieldDefaults:i}}static getRestrictedTabs(){const t=[];return Object.entries(O.PARTS).forEach((o,n)=>{o[0]!=="tabs"&&o[0]!=="footer"&&o[1].isGMOnly&&t.push(o[0])}),t}static handleRangeInputs(t,o){if(t&&o){const n=parseFloat(t.min),a=parseFloat(t.max);parseFloat(t.step),t.addEventListener("input",()=>{o.value=t.value}),o.addEventListener("input",()=>{const s=o.value;if(s===""||s==="-"||s===".")return;const r=parseFloat(s);!isNaN(r)&&r>=n&&r<=a&&(t.value=r)}),o.addEventListener("change",()=>{let s=parseFloat(o.value);isNaN(s)||s<n?s=n:s>a&&(s=a),o.value=s,t.value=s}),o.value=t.value}}static updateSettings(t){let o=!1;const n=k(),r=m(O,ee).querySelector(".form-content.active").dataset.tab;if(I(O,Lt,r),!t)return;let i;t.object&&(i=foundry.utils.expandObject(t.object));const d=J.find(u=>u.label===i.colorTheme);i.colorTheme=d?d.className:J[0].className;const p=J.find(u=>u.label===i.playerColorTheme);if(i.playerColorTheme=p?p.className:"",i.otherModulesList!==void 0){if(typeof i.otherModulesList=="string")try{i.otherModulesList=JSON.parse(i.otherModulesList),g.log("Parsed otherModulesList from form",[i.otherModulesList])}catch(u){console.warn("Failed to parse otherModulesList from form",u),i.otherModulesList=L.get(n.otherModulesList.tag)}}else{const u=L.get(n.otherModulesList.tag);i.otherModulesList=u,g.log("otherModulesList not in form, preserving current",[u])}return Object.entries(i).forEach(([u,h])=>{var C;if(!u.endsWith("_value")&&u!=="adjustOtherModules"&&(g.log("updateSettings #1",[n,n[u]]),i[u]!==void 0&&n[u])){const b=L.get(n[u].tag),v=n[u].scope===T.client,G=n[u].scope===T.world;v||G&&game.user.isGM?(u==="otherModulesList"&&g.log("Saving otherModulesList",[i[u],"Current:",b]),L.set(n[u].tag,i[u])):g.log(`Skipping world-scoped setting ${u} for non-GM user`),(C=n[u])!=null&&C.requiresReload&&b!==i[u]&&(o=!0)}}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),o}changeTab(t,o,n){super.changeTab(t,o,n),I(O,Lt,t)}static handleCustomFontFields(){const t=m(O,ee).querySelector(".form-content[data-tab=fonts]");if(!t)return;t.querySelectorAll('input[type="text"]').forEach(a=>{const s=a.closest(".dropdown-wrapper"),r=s==null?void 0:s.querySelector(".dropdown-options");if(!s||!r)return;const i=()=>{var d;B(d=O,ye,pn).call(d),r.classList.add("active")};a.addEventListener("focus",i),a.addEventListener("click",i),a.addEventListener("keydown",B(O,ye,hn)),document.addEventListener("click",d=>{s.contains(d.target)||r.classList.remove("active")})}),t.querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(r=>r.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",s=>{const r=a.closest(".dropdown-wrapper").querySelector("input");let i=a.dataset.value;i.includes(" ")&&!i.startsWith('"')?i=`"${i}"`:i.startsWith("&quot;")&&(i=i.replace(/&quot;/g,'"')),r.value=i;const d=a.closest(".dropdown-options");d.classList.remove("active"),g.log("handleCustomFontFields",[i,r,d])})})}static handleThemeAndStyleFields(){const t=m(O,ee).querySelector(".form-content[data-tab=themes]");if(!t)return;const o=t.querySelector('input[name="useGlassEffect"]');if(o){const p=()=>{const u=o.checked,h=t.querySelector('.form-group.range:has(input[name="glassTranslucence"])');h&&(h.style.display=u?"flex":"none")};p(),o.addEventListener("change",p)}t.querySelectorAll(".open-color-picker").forEach(p=>{p.addEventListener("click",u=>{u.preventDefault();const h=p.dataset.scope||"world",C=h==="player"?"v2-player-custom-theme-colors":"v2-custom-theme-colors";new gn({scope:h,currentColors:L.get(C),callback:v=>{O.updateColorPreview(v,h)}}).render(!0)})}),t.querySelectorAll('input[type="text"]:not([hidden])').forEach(p=>{const u=p.closest(".dropdown-wrapper"),h=u==null?void 0:u.querySelector(".dropdown-options");if(!u||!h)return;const C=()=>{var b;B(b=O,ye,pn).call(b),h.classList.add("active")};p.addEventListener("focus",C),p.addEventListener("click",C),p.addEventListener("keydown",B(O,ye,hn)),document.addEventListener("click",b=>{u.contains(b.target)||h.classList.remove("active")})}),t.querySelectorAll(".dropdown-option").forEach(p=>{p.addEventListener("mouseenter",()=>{p.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(h=>h.classList.remove("highlighted")),p.classList.add("highlighted")}),p.addEventListener("click",function(u){var v,G,A;g.log("theme option",[p,p.querySelector(".theme-name")]);const h=(v=p.closest(".dropdown-wrapper"))==null?void 0:v.querySelector("input");let C=(G=p.querySelector(".theme-name"))==null?void 0:G.innerHTML.toString();if(h.value=C,h.name==="colorTheme"||h.name==="playerColorTheme"){const V=J.find(Y=>Y.label===C);B(A=O,ye,Zn).call(A,V)}p.closest(".dropdown-options").classList.remove("active")})});const r=m(O,ee).querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),i=m(O,ee).querySelector('input.otherModulesList[type="hidden"]');r.forEach(p=>{p.addEventListener("change",u=>{const h=u.currentTarget,C=h.value.replace(/['''"]/g,"").trim(),b=h.checked;let v=[];try{v=JSON.parse(i.value)||[]}catch(X){console.warn("Failed to parse otherModulesList",X),v=[]}const G=v.findIndex(X=>X.id===C);G>=0?v[G].enabled=b:v.push({id:C,enabled:b}),i.value=JSON.stringify(v),g.log("checkbox changed",[v,i.value]);const A=m(O,ee).querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),V=Array.from(A).some(X=>X.checked),Y=m(O,ee).querySelector("input.adjustOtherModules");Y&&(Y.checked=V)})});const d=m(O,ee).querySelector("input.adjustOtherModules");d==null||d.addEventListener("change",p=>{const u=p.currentTarget.checked;m(O,ee).querySelectorAll('.multiple-select.other-modules input[type="checkbox"]').forEach(G=>{G.checked=u});const C=k(),b=Object.values(C.otherModulesList.options).map(G=>({id:G.replace(/['''"]/g,"").trim(),enabled:u})),v=m(O,ee).querySelector('input.otherModulesList[type="hidden"]');v.value=JSON.stringify(b),g.log("toggle all modules",[u,b])})}static handleSheetFields(){const t=m(O,ee).querySelector('.form-content:has(input[name="applyThemeToSheets"])');if(!t)return;const o=t.querySelector('input[name="applyThemeToSheets"]'),n=t.querySelector('.form-group:has(input[name="useHorizontalSheetTabs"])');if(o&&n){const a=()=>{const s=o.checked;n.style.display=s?"flex":"none"};a(),o.addEventListener("change",a)}}static updateColorPreview(t,o="world"){var r;const n=(r=m(O,ee))==null?void 0:r.querySelector(".form-content[data-tab=themes]");if(!n)return;const a=n.querySelector(`.open-color-picker[data-scope="${o}"]`);if(!a)return;const s=a.closest(".form-group").querySelector(".custom-color-preview");if(s){const i=s.querySelector(".accent-swatch"),d=s.querySelector(".secondary-swatch");i&&(i.style.backgroundColor=t.accent),d&&(d.style.backgroundColor=t.secondary)}}};ee=new WeakMap,Lt=new WeakMap,En=new WeakMap,ye=new WeakSet,Xn=async function(t,o,n){t.preventDefault(),t.stopPropagation(),O.updateSettings(n)&&w.confirmReload()},Jn=async function(t,o){const n=k(),s=m(O,ee).querySelector(".form-content.active"),r=s.dataset.tab,i=O.PARTS[r].menuKey,d=n[i].default;s.querySelectorAll("input, select").forEach(u=>{u.value=d[u.name],u.type==="checkbox"&&(u.checked=d[u.name])}),g.log("#onReset",[m(O,Lt),r,t,o])},Kn=function(){var n;const t=[],o=O.PARTS;return((n=game.system)==null?void 0:n.id)!=="dnd5e"&&delete o.sheets5e,g.log("#getTabs",[o,O.PARTS]),Object.entries(o).forEach(([a,s])=>{s.menuKey&&t.push({id:a,icon:"",group:"primary-tabs",label:`CRLNGN_UI.settings.moduleSettingsMenu.tabs.${a}`})}),t},pn=function(){m(O,ee).querySelectorAll(".dropdown-options").forEach(t=>{t.classList.remove("active")})},hn=function(t){const o=t.target.closest(".dropdown-wrapper"),n=o==null?void 0:o.querySelector(".dropdown-options"),a=n.classList.contains("active"),s=Array.from(n.querySelectorAll(".dropdown-option"));let r=s.findIndex(i=>i.classList.contains("highlighted"));t.key==="ArrowDown"||t.key==="ArrowUp"?(t.preventDefault(),a||n.classList.add("active"),s.forEach(i=>i.classList.remove("highlighted")),r===-1?r=t.key==="ArrowDown"?0:s.length-1:r=t.key==="ArrowDown"?(r+1)%s.length:(r-1+s.length)%s.length,s[r]&&(s[r].classList.add("highlighted"),s[r].scrollIntoView({block:"nearest"}))):t.key==="Enter"?(t.preventDefault(),a&&r!==-1&&s[r]&&s[r].click()):t.key==="Escape"&&n.classList.remove("active")},Zn=function(t){if(g.log("Selected theme updated:",[t]),!t)return;m(O,ee).querySelectorAll("span.selected-theme").forEach((n,a)=>{n.style.setProperty("background-color",t.colorPreview[a])})},R(O,ye),R(O,ee),R(O,Lt),R(O,En),y(O,"selectedTheme"),y(O,"DEFAULT_OPTIONS",{id:"crlngn-ui-settings",tag:"form",window:{icon:"fas fa-cog",title:"CRLNGN_UI.settings.moduleSettingsMenu.title",contentClasses:["standard-form","crlngn","tabbed-settings"],resizable:!0},position:{width:740,height:"auto"},actions:{redefine:B(O,ye,Jn)},form:{handler:B(O,ye,Xn),closeOnSubmit:!0}}),y(O,"PARTS",{tabs:{template:"templates/generic/tab-navigation.hbs",isGMOnly:!1},interface:{menuKey:"interfaceOptionsMenu",template:"modules/crlngn-ui/templates/interface-elements-settings.hbs",isGMOnly:!1},themes:{menuKey:"themeAndStylesMenu",template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs",isGMOnly:!1},fonts:{menuKey:"customFontsMenu",template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs",isGMOnly:!0},chat:{menuKey:"chatMessagesMenu",template:"modules/crlngn-ui/templates/chat-messages-settings.hbs",isGMOnly:!1},scenes:{menuKey:"sceneNavMenu",template:"modules/crlngn-ui/templates/scene-nav-settings.hbs",isGMOnly:!1},players:{menuKey:"playersListMenu",template:"modules/crlngn-ui/templates/players-list-settings.hbs",isGMOnly:!1},camera:{menuKey:"cameraDockMenu",template:"modules/crlngn-ui/templates/camera-dock-settings.hbs",isGMOnly:!1},footer:{template:"templates/generic/form-footer.hbs",isGMOnly:!1}}),y(O,"TABS",{primary:{initial:"interface",tabs:B($n=O,ye,Kn).call($n),labelPrefix:""}});let fn=O;class Ia extends FormApplication{constructor(...e){super(...e),window.open("https://www.patreon.com/c/carolingiandev/membership","_blank"),this.close()}render(){return this.close(),this}}function Qn(){return{moduleSettingsMenu:{tab:"",tag:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.hint"),icon:"fas fa-sliders-h",propType:fn,restricted:!1},supportPatreon:{tab:"",tag:game.i18n.localize("CRLNGN_UI.settings.supportPatreon.label"),name:game.i18n.localize("CRLNGN_UI.settings.supportPatreon.label"),label:game.i18n.localize("CRLNGN_UI.settings.supportPatreon.buttonLabel"),hint:game.i18n.localize("CRLNGN_UI.settings.supportPatreon.hint"),icon:"fas fa-heart",propType:Ia,restricted:!1}}}var ct,Ze,Zt,Qt,_t,eo,to,oo,no,ao,dt,so,ro;const f=class f{static applyFadeOut(e){f.useFadeOut=e,f.cameraContainer&&f.cameraContainer.classList.toggle("faded-ui",e)}static applyHide(e){f.hidden=e,f.cameraContainer&&f.cameraContainer.classList.toggle("hidden",e)}static applyCustomStyle(e){var t;f.enableFloatingDock=e,g.log("applyCustomStyle",["enableFloatingDock",e,f.enableFloatingDock,ui.webrtc]),(t=ui.webrtc)==null||t.render()}static init(){const e=k();f.enableFloatingDock=L.get(e.enableFloatingDock.tag),f.currSettings={enableFloatingDock:f.enableFloatingDock,defaultVideoWidth:L.get(e.defaultVideoWidth.tag),dockHeight:L.get(e.dockHeight.tag),dockWidth:L.get(e.dockWidth.tag),dockPosX:L.get(e.dockPosX.tag),dockPosY:L.get(e.dockPosY.tag),dockResizeOnUserJoin:L.get(e.dockResizeOnUserJoin.tag)},f.enableFloatingDock?(f.positionIntervalId&&(clearInterval(f.positionIntervalId),f.positionIntervalId=null),Hooks.on(D.RENDER_CAMERA_VIEWS,f.onRenderFloating),Hooks.on(D.RENDER_PLAYERS_LIST,f.onRenderPlayersList),Hooks.on(D.CLIENT_SETTING_CHANGED,t=>{g.log("Setting updated",[t]),t.includes("rtcClientSettings")&&f.checkMinimizedState()})):(Hooks.on(D.RENDER_CAMERA_VIEWS,f.onRenderPlain),f.onRenderPlain())}static onRenderPlain(e,t){var o;f.cameraContainer||(f.cameraContainer=document.querySelector("#av-holder")),(o=f.cameraContainer)==null||o.classList.add("visible")}static onRenderFloating(e,t,o){k();const n=f.currSettings,a=document.querySelector("#camera-views");if(f.cameraContainer=document.querySelector("#av-holder"),f.cameraContainer)f.cameraContainer.appendChild(a);else{const d=document.createElement("div");f.cameraContainer=d,d.id="av-holder",d.appendChild(a),document.querySelector("body.crlngn-ui").appendChild(d)}f.cameraContainer.querySelector("button[data-action=toggleDock]").addEventListener("click",()=>{var d;(d=ui.webrtc)==null||d.render()}),((t==null?void 0:t.querySelectorAll(".camera-view"))||[]).forEach(d=>{const p=game.users.get(d.dataset.user),u=(p==null?void 0:p.color)||"";d.style.setProperty("--player-color",u)}),g.log("CameraDockUtil.onRender",[e,t,o,n.dockPosX,n.dockPosY]);const i=game.settings.get("core","rtcClientSettings");(i==null?void 0:i.hideDock)!==!0?(f.checkMinimizedState(),f.applyDockResize(n.dockResizeOnUserJoin),f.makeDraggable(),f.makeResizeable(),f.applyVideoWidth(),f.resetPositionAndSize()):f.checkMinimizedState(),f.applyFadeOut(f.useFadeOut)}static onRenderPlayersList(){g.log("onRenderPlayersList")}static applyPositionWithDelay(){f.positionIntervalId&&(clearInterval(f.positionIntervalId),f.positionIntervalId=null),f.resetPositionAndSize();let e=0;f.positionIntervalId=setInterval(()=>{f.resetPositionAndSize(),e++,e>=f.positionAttempts&&(clearInterval(f.positionIntervalId),f.positionIntervalId=null)},20)}static applyVideoWidth(e){const t=k(),o=L.get(t.defaultVideoWidth.tag);let n=e||o;if(n<en)n=en,L.set(t.defaultVideoWidth.tag,n);else if(!Number.isNaN(n)){f.currSettings.defaultVideoWidth=n;const a=document.querySelector("#av-holder.minimized #camera-views"),s=document.querySelector("#camera-views");!a&&s&&(s.parentNode.style.setProperty("--av-width",n+"px"),s.style.setProperty("--av-width",n+"px")),f.updateDockSize()}}static resetPositionAndSize({x:e,y:t,w:o,h:n}={x:null,y:null,w:null,h:null}){k();const a=f.currSettings;if(!f.enableFloatingDock||!f.cameraContainer)return;const s=game.settings.get("core","rtcClientSettings");if((s==null?void 0:s.hideDock)===!0){f.checkMinimizedState();return}if(g.log("CameraDock",[a]),!e&&!t&&!o&&!n){const r=a.dockPosX||0,i=a.dockPosY||0;if(f.cameraContainer.style.left=`${r}px`,f.cameraContainer.style.bottom=`${i}px`,f.currSettings.dockResizeOnUserJoin===He.off.name){const d=a.dockWidth||0,p=a.dockHeight||0;f.cameraContainer.style.width=`${d}px`,f.cameraContainer.style.height=`${p}px`}}else e!==null&&(f.cameraContainer.style.left=`${e}px`),t!==null&&(f.cameraContainer.style.bottom=`${t}px`),f.currSettings.dockResizeOnUserJoin===He.horizontal.name?o!==null&&(f.cameraContainer.style.width=`${o}px`):f.currSettings.dockResizeOnUserJoin===He.vertical.name&&n!==null&&(f.cameraContainer.style.height=`${n}px`)}static makeDraggable(){var e,t;(e=f.cameraContainer)==null||e.addEventListener("mousedown",o=>{var i,d;const n=document.querySelector("#av-holder.minimized #camera-views");if(o.button!==0)return;const a=document.querySelector("body.crlngn-ui");if(g.log("mousedown",[o.target.tagName,o.target.parentNode.tagName]),o.target.tagName=="input"||(i=o.target.parentNode)!=null&&i.classList.contains("webrtc-volume-slider")||(a==null||a.addEventListener("mousemove",m(f,oo)),a==null||a.addEventListener("mouseup",m(f,no)),n))return;const s=w.getOffsetBottom(f.cameraContainer);let r=((d=f.cameraContainer)==null?void 0:d.offsetLeft)||0;f.isDragging=!0,I(f,ct,o.clientX-r),I(f,Ze,window.innerHeight-o.clientY-s),o.preventDefault(),o.stopPropagation()}),(t=f.cameraContainer)==null||t.addEventListener("touchstart",o=>{var d,p;const n=document.querySelector("#av-holder.minimized #camera-views");if(!o.touches[0])return;const a=document.querySelector("body.crlngn-ui");if((d=o.target.parentNode)!=null&&d.classList.contains("volume-bar")||(a.addEventListener("touchmove",m(f,ao)),a.addEventListener("touchend",m(f,dt)),a.addEventListener("touchcancel",m(f,dt)),n))return;const s=o.touches[0],r=w.getOffsetBottom(f.cameraContainer);let i=((p=f.cameraContainer)==null?void 0:p.offsetLeft)||0;f.isDragging=!0,I(f,ct,s.clientX-i),I(f,Ze,window.innerHeight-s.clientY-r),o.preventDefault(),o.stopPropagation()})}static updateDockSize(){var i,d;if(!f.cameraContainer)return;const e=k(),t=f.currSettings.dockResizeOnUserJoin,o=f.currSettings.defaultVideoWidth||en,a=(((d=(i=game.webrtc)==null?void 0:i.users)==null?void 0:d.filter(p=>p.active&&p.canBroadcastVideo))||[]).length;if(a===0)return;if(t===He.horizontal.name){const p=o*a+16;f.cameraContainer.style.width=`${p}px`}else if(t===He.vertical.name){const p=o*a+16;f.cameraContainer.style.height=`${p}px`}const s=parseInt(f.cameraContainer.style.width||0),r=parseInt(f.cameraContainer.style.height||0);s>0&&L.set(e.dockWidth.tag,s),r>0&&L.set(e.dockHeight.tag,r)}static applyDockResize(e=null){if(!f.cameraContainer)return;e?f.currSettings.dockResizeOnUserJoin=e:e=f.currSettings.dockResizeOnUserJoin,f.cameraContainer.classList.remove("horizontal"),f.cameraContainer.classList.remove("vertical");const t=f.cameraContainer.querySelector("#camera-views");t.classList.remove("horizontal"),t.classList.remove("vertical"),e===He.horizontal.name?f.cameraContainer.classList.add("horizontal"):e===He.vertical.name&&f.cameraContainer.classList.add("vertical"),f.updateDockSize()}static makeResizeable(){if(f.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div"),o=f.cameraContainer.querySelector(".resize-handle");o&&o.remove(),t.classList.add("resize-handle"),f.cameraContainer.append(t),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),f.isResizing=!0,I(f,Zt,n.clientX),I(f,Qt,n.clientY),I(f,to,parseInt(getComputedStyle(f.cameraContainer).bottom)||0),I(f,_t,f.cameraContainer.offsetWidth),I(f,eo,f.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",m(f,so)),e==null||e.addEventListener("mouseup",m(f,ro))})}}static checkMinimizedState(){if(!f.cameraContainer)return;const e=game.settings.get("core","rtcClientSettings"),t=(e==null?void 0:e.hideDock)===!0;t?document.querySelector("#av-holder").classList.add("minimized"):document.querySelector("#av-holder").classList.remove("minimized"),g.log("Checking minimized state",[e,t]),f.handleMinimizedState(t)}static handleMinimizedState(e){var a;const t=document.querySelector("#interface #players #players-active"),o=f.cameraContainer.querySelector("button[data-action=toggleDock]");if(!t||!o||!f.cameraContainer)return;if(g.log("handleMinimizedState",[e]),e)f.cameraContainer.parentNode!==t&&(f.originalParent=f.cameraContainer.parentNode,t.prepend(f.cameraContainer),o.classList.remove("fa-caret-down"),o.classList.remove("fa-caret-left"),o.classList.remove("fa-caret-right"),o.classList.remove("fa-compress"),o.classList.add("fa-camera"));else{if(!f.originalParent)return;f.originalParent.prepend(f.cameraContainer),f.makeDraggable(),f.makeResizeable(),o.classList.remove("fa-caret-up"),o.classList.remove("fa-caret-left"),o.classList.remove("fa-caret-right"),o.classList.remove("fa-expand"),o.classList.add("fa-caret-down"),g.log("Restored camera position from settings",[f.currSettings])}const n=(a=f.cameraContainer)==null?void 0:a.querySelector("#camera-views");n==null||n.classList.remove("horizontal"),n==null||n.classList.remove("vertical")}};ct=new WeakMap,Ze=new WeakMap,Zt=new WeakMap,Qt=new WeakMap,_t=new WeakMap,eo=new WeakMap,to=new WeakMap,oo=new WeakMap,no=new WeakMap,ao=new WeakMap,dt=new WeakMap,so=new WeakMap,ro=new WeakMap,R(f,ct,0),R(f,Ze,0),y(f,"isDragging",!1),y(f,"cameraContainer"),y(f,"isResizing",!1),R(f,Zt,0),R(f,Qt,0),R(f,_t,0),R(f,eo,0),R(f,to,0),y(f,"currSettings",{}),y(f,"positionIntervalId",null),y(f,"positionAttempts",5),y(f,"useFadeOut",!0),y(f,"hidden",!1),y(f,"enableFloatingDock",!0),R(f,oo,e=>{const t=document.querySelector("#av-holder.minimized #camera-views");if(!(!f.isDragging||t)){if(g.log("mousemove",[window.innerHeight,e.clientY,m(f,Ze)]),f.cameraContainer){let o=e.clientX-m(f,ct),n=window.innerHeight-e.clientY-m(f,Ze);o+f.cameraContainer.offsetWidth>window.innerWidth&&(o=window.innerWidth-f.cameraContainer.offsetWidth),o<0&&(o=0),f.cameraContainer.style.left=`${o}px`,n+f.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-f.cameraContainer.offsetHeight),f.cameraContainer.style.bottom=`${n}px`}e.preventDefault(),e.stopPropagation()}}),R(f,no,e=>{var a,s;const t=k(),o={...f.currSettings},n=document.querySelector("#av-holder.minimized #camera-views");if(f.isDragging&&!n){const r=document.querySelector("body.crlngn-ui");o.dockPosX=parseInt((a=f.cameraContainer)==null?void 0:a.style.left)||0,o.dockPosY=parseInt((s=f.cameraContainer)==null?void 0:s.style.bottom)||0,o.dockPosY<=0&&(o.dockPosY=0),L.set(t.dockPosX.tag,o.dockPosX),L.set(t.dockPosY.tag,o.dockPosY),r==null||r.removeEventListener("mousemove",m(f,oo)),r==null||r.removeEventListener("mouseup",m(f,no)),f.isDragging=!1,e.stopPropagation()}}),R(f,ao,e=>{if(!(!f.isDragging||!e.touches[0])){if(f.cameraContainer){const t=e.touches[0];let o=t.clientX-m(f,ct),n=window.innerHeight-t.clientY-m(f,Ze);o+f.cameraContainer.offsetWidth>window.innerWidth&&(o=window.innerWidth-f.cameraContainer.offsetWidth),o<0&&(o=0),f.cameraContainer.style.left=`${o}px`,n+f.cameraContainer.offsetHeight>window.innerHeight&&(n=window.innerHeight-f.cameraContainer.offsetHeight),f.cameraContainer.style.bottom=`${n}px`}e.preventDefault(),e.stopPropagation()}}),R(f,dt,e=>{var n,a;const t=k(),o={...f.currSettings};if(f.isDragging){const s=document.querySelector("body.crlngn-ui");o.dockPosX=parseInt((n=f.cameraContainer)==null?void 0:n.style.left)||0,o.dockPosY=parseInt((a=f.cameraContainer)==null?void 0:a.style.bottom)||0,o.dockPosY<=0&&(o.dockPosY=0),L.set(t.dockPosX.tag,o.dockPosX),L.set(t.dockPosY.tag,o.dockPosY),s==null||s.removeEventListener("touchmove",m(f,ao)),s==null||s.removeEventListener("touchend",m(f,dt)),s==null||s.removeEventListener("touchcancel",m(f,dt)),f.isDragging=!1,e.preventDefault(),e.stopPropagation()}}),R(f,so,e=>{if(!f.isResizing)return;const t=m(f,_t)+(e.clientX-m(f,Zt)),o=e.clientY-m(f,Qt),n=m(f,eo)+o,a=m(f,to)-o;f.cameraContainer.style.width=`${t}px`,f.cameraContainer.style.height=`${n}px`,f.cameraContainer.style.bottom=`${a}px`}),R(f,ro,()=>{var n,a,s,r,i,d,p;const e=k(),t={...f.currSettings},o=document.querySelector("body.crlngn-ui");f.isResizing=!1,o==null||o.removeEventListener("mousemove",m(f,so)),o==null||o.removeEventListener("mouseup",m(f,ro)),g.log("onStopResize",[(n=f.cameraContainer)==null?void 0:n.style.width,(a=f.cameraContainer)==null?void 0:a.style.height,(s=f.cameraContainer)==null?void 0:s.style.bottom]),t.dockWidth=parseInt(((r=f.cameraContainer)==null?void 0:r.style.width)||0),t.dockHeight=parseInt(((i=f.cameraContainer)==null?void 0:i.style.height)||0),t.dockPosY=parseInt(((d=f.cameraContainer)==null?void 0:d.style.bottom)||0),t.dockPosX=parseInt(((p=f.cameraContainer)==null?void 0:p.style.left)||0),L.set(e.dockWidth.tag,t.dockWidth),L.set(e.dockHeight.tag,t.dockHeight),L.set(e.dockPosY.tag,t.dockPosY),L.set(e.dockPosX.tag,t.dockPosX)});let de=f;const K=class K{static init(){Hooks.on(D.RENDER_SIDE_BAR,K.onRender),Hooks.on(D.COLLAPSE_SIDE_BAR,K.onRender),Hooks.on(D.READY,K.onRender)}static applyFadeOut(e){K.useFadeOut=e,K.handleFadeOut()}static applyHide(e){K.hidden=e,K.handleHide()}static applyCustomStyle(e){var t;K.customStylesEnabled=e,g.log("applyCustomStyle",[K.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static onRender(e,t,o){const n=t&&typeof t===HTMLElement?t:document;n.querySelector("#roll-privacy button[data-action='toggleChat']")||K.addChatToggle(n),K.handleFadeOut(e,n,o),K.handleHide(e,n,o)}static handleFadeOut(e,t,o){g.log("handle FadeOut, ChatLogControls",[K.useFadeOut]);const n=t?t.querySelector("#chat-notifications"):document.querySelector("#ui-right #chat-notifications");K.useFadeOut?n==null||n.classList.add("faded-ui"):n==null||n.classList.remove("faded-ui")}static handleHide(e,t,o){g.log("handle Hide, ChatLogControls",[K.hidden]);const n=t?t.querySelector("#chat-notifications"):document.querySelector("#ui-right #chat-notifications");K.hidden?n==null||n.classList.add("hidden-ui"):n==null||n.classList.remove("hidden-ui")}};y(K,"useFadeOut",!0),y(K,"hidden",!1),y(K,"customStylesEnabled",!0),y(K,"addChatToggle",async e=>{const t=e.querySelector("button[data-action=toggleChat]");if(!K.customStylesEnabled||t)return;const o=await w.renderTemplate(`modules/${H}/templates/chat-toggle-button.hbs`,{}),n=document.querySelector("#ui-right #roll-privacy");n.insertAdjacentHTML("afterbegin",o);const a=n.querySelector("button[data-action=toggleChat]");a.addEventListener("click",K.onToggleChatBox);const s=game.user.getFlag(H,"chatBoxHidden");if(s!==void 0){g.log("Applying saved chat box state",[s]);const r=document.querySelector("#chat-notifications"),i=k(),d=game.settings.get(H,i.preventMacroBarReposition.tag);s?(a.classList.remove("fa-comment-slash"),a.classList.add("fa-comment"),r.classList.add("input-hidden"),d&&document.body.classList.add("chat-input-hidden"),w.addCSSVars("--chat-input-height","0px")):(a.classList.add("fa-comment-slash"),a.classList.remove("fa-comment"),r.classList.remove("input-hidden"),d&&document.body.classList.remove("chat-input-hidden"),w.addCSSVars("--chat-input-height","100px"))}}),y(K,"onToggleChatBox",e=>{const t=document.querySelector("#ui-right button[data-action=toggleChat]"),o=document.querySelector("#chat-notifications"),n=k(),a=game.settings.get(H,n.preventMacroBarReposition.tag);let s=!1;t.classList.contains("fa-comment-slash")?(t.classList.remove("fa-comment-slash"),t.classList.add("fa-comment"),o.classList.add("input-hidden"),a&&document.body.classList.add("chat-input-hidden"),w.addCSSVars("--chat-input-height","0px"),s=!0):(t.classList.add("fa-comment-slash"),t.classList.remove("fa-comment"),o.classList.remove("input-hidden"),a&&document.body.classList.remove("chat-input-hidden"),w.addCSSVars("--chat-input-height","100px"),s=!1),game.user.setFlag(H,"chatBoxHidden",s),g.log("Chat box state saved to flag",[s])});let Tt=K;const Te=class Te{static init(){const e=k();Te.enableChatStyles=L.get(e.enableChatStyles.tag),Te.chatBorderColor=L.get(e.chatBorderColor.tag),Te.chatBorderPosition=L.get(e.chatBorderPosition.tag)}};y(Te,"chatBorderColor"),y(Te,"enableChatStyles"),y(Te,"chatBorderPosition"),y(Te,"enrichCard",async(e,t)=>{var a,s,r,i,d,p,u,h;g.log("renderChatMessage",[Te.chatBorderColor,Te.enableChatStyles,Mt.playerColor.name,(a=e.author)==null?void 0:a.id]);let o=t.get?t.get(0):t;if(!o)return;switch(o.classList.add("crlngn"),Te.chatBorderPosition){case To.left.name:o.classList.add("left-border");break;case To.right.name:o.classList.add("right-border");break;case To.top.name:o.classList.add("top-border");break}if(Te.chatBorderColor===Mt.playerColor.name&&((s=e.author)!=null&&s.id)&&(o.style.setProperty("border-color",`var(--user-color-${e.author.id})`,"important"),g.log("renderChatMessage #2",[Te.chatBorderColor,(r=e.author)==null?void 0:r.id])),(i=e.flags)!=null&&i.dnd5e){const C=((d=e.flags.dnd5e.activity)==null?void 0:d.type)||((h=(u=(p=e.flags)==null?void 0:p.dnd5e)==null?void 0:u.roll)==null?void 0:h.type)||"custom";o.classList.add(C)}else{o.classList.add("custom");return}const n=o.querySelectorAll(".card-buttons button[data-action=rollSave]");n.length>0&&n.forEach(C=>{const b=C.querySelector(".visible-dc"),v=C.querySelector(".hidden-dc");g.log("enrichCard",[b,v]),b.setAttribute("data-ability",C.getAttribute("data-ability")||""),b.setAttribute("data-dc",C.getAttribute("data-dc")||""),v.setAttribute("data-ability",C.getAttribute("data-ability")||"")})});let et=Te;const W=class W{static init(){this.preloadTemplates(),Hooks.on(D.RENDER_HOTBAR,W.onRender)}static applyFadeOut(e){W.useFadeOut=e,W.handleFadeOut()}static applyHide(e){W.hidden=e,W.handleHide()}static handleHide(e,t,o){const n=t||document.querySelector("#hotbar");W.hidden?n==null||n.classList.add("hidden-ui"):n==null||n.classList.remove("hidden-ui"),g.log("handle Hide",[W.hidden])}static onRender(e,t,o){g.log("MacroHotbar onRender",[W.customStylesEnabled]),W.applyCustomStyle(W.customStylesEnabled),W.handleFadeOut(e,t,o),W.handleHide(e,t,o),W.addCollapseButton(),W.applyHotBarCollapse()}static handleCollapse(e){const t=game.user.getFlag(H,"hotbarCollapsed");W.applyHotBarCollapse(!t)}static handleOpenDirectory(e){g.log("open directory")}static handleFadeOut(e,t,o){const n=t||document.querySelector("#hotbar");W.useFadeOut?n==null||n.classList.add("faded-ui"):n==null||n.classList.remove("faded-ui")}static applyCustomStyle(e){const t=k();W.customStylesEnabled=e!==void 0?e:L.get(t.enableMacroLayout.tag),g.log("applyCustomStyle",[W.customStylesEnabled]),W.applyHotBarLayout()}static applyHotBarLayout(){const e=document.querySelector("#hotbar");e&&(W.customStylesEnabled?e.classList.add("crlngn-macro"):e.classList.remove("crlngn-macro"))}};y(W,"useFadeOut",!0),y(W,"customStylesEnabled",!0),y(W,"macroStartCollapsed",!1),y(W,"hidden",!1),y(W,"preloadTemplates",async()=>{try{const e=[`modules/${H}/templates/macro-buttons.hbs`];return await w.loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),y(W,"addCollapseButton",async()=>{const e=document.querySelector("#hotbar #hotbar-controls-right");if(!e)return;game.user.getFlag(H,"hotbarCollapsed");const t=await w.renderTemplate(`modules/${H}/templates/macro-buttons.hbs`,{});e.insertAdjacentHTML("beforeend",t);const o=e.querySelector("button[data-action=collapse]"),n=e.querySelector("button[data-action=openDirectory]");o==null||o.addEventListener("click",W.handleCollapse),n==null||n.addEventListener("click",W.handleOpenDirectory)}),y(W,"applyHotBarCollapse",async e=>{const t=k();W.macroStartCollapsed=e!==void 0?e:L.get(t.collapseMacroBar.tag),game.user&&await game.user.setFlag(H,"hotbarCollapsed",W.macroStartCollapsed);const o=document.querySelector("#hotbar #hotbar-controls-right"),n=o==null?void 0:o.querySelector("button[data-action=collapse]"),a=document.querySelector("#hotbar");W.macroStartCollapsed&&a?(a.classList.add("collapsed"),n&&(n.classList.remove("fa-angle-down"),n.classList.add("fa-angle-up"),n.dataset.tooltip=game.i18n.localize("CRLNGN_UI.ui.macroBarTooltipKeepOpen"))):(a==null||a.classList.remove("collapsed"),n&&(n.classList.add("fa-angle-down"),n.classList.remove("fa-angle-up"),n.dataset.tooltip=game.i18n.localize("CRLNGN_UI.ui.macroBarTooltipAutoHide")))});let Pe=W;var qo;const _=class _{static init(){g.log("PlayersList init",[]),Hooks.on(D.RENDER_PLAYERS_LIST,_.onRender)}static applyFadeOut(e){_.useFadeOut=e,_.handleFadeOut()}static applyHide(e){_.hidden=e,_.handleHide()}static handleHide(e,t,o){const n=t||document.querySelector("#players");_.hidden?n==null||n.classList.add("hidden-ui"):n==null||n.classList.remove("hidden-ui"),g.log("handle Hide",[_.hidden])}static handleFadeOut(e,t,o){const n=t||document.querySelector("#players");I(_,qo,setTimeout(()=>{g.log("handleFadeOut - PlayersList",[n,_.useFadeOut]),_.useFadeOut?n==null||n.classList.add("faded-ui"):n==null||n.classList.remove("faded-ui"),Ot.handleYTPlayerFadeOut()},500))}static applyCustomStyle(e){_.customStylesEnabled=e,ui.players&&ui.players.render()}static onRender(e,t,o){g.log("PlayersList onRender",[e,t,o]),k();const n=t||document.querySelector("#players");_.customStylesEnabled?n==null||n.classList.add("crlngn-ui"):n==null||n.classList.remove("crlngn-ui"),_.applyPlayersListSettings(),_.applyAvatars(),_.handleFadeOut(e,n,o),_.handleHide(e,n,o)}static applyPlayersListSettings(){var t,o,n,a;const e=k();g.log("applyPlayersListSettings",[L.get(e.autoHidePlayerList.tag)]),L.get(e.autoHidePlayerList.tag)?((t=document.querySelector("#players.crlngn-ui"))==null||t.classList.add("minimized"),(o=document.querySelector("body"))==null||o.classList.add("crlngn-players-minimized")):((n=document.querySelector("#players"))==null||n.classList.remove("minimized"),(a=document.querySelector("body"))==null||a.classList.remove("crlngn-players-minimized"))}static applyAvatars(){const e=k();g.log("applyAvatars",[game.users]);const t=document.querySelector("#players"),o=game.users.filter(s=>s.active===!0),n=game.users.filter(s=>s.active===!1),a=[...o,...n];L.get(e.playerListAvatars.tag)&&_.customStylesEnabled?(t==null||t.classList.add("crlngn-avatars"),a.forEach(s=>{var u;const r=t==null?void 0:t.querySelector(`li[data-user-id='${s.id}']`),i=game.users.get(s.id),d=((u=i.character)==null?void 0:u.img)||"";g.log("player",[i]);const p=document.createElement("img");p.src=d||i.avatar||"",p.alt="*",p.classList.add("crlngn-avatar"),r&&r.prepend(p)})):((t==null?void 0:t.querySelectorAll("li.player")).forEach(r=>{const i=r.querySelector("img.crlngn-avatar");i==null||i.remove()}),t==null||t.classList.remove("crlngn-avatars"))}};qo=new WeakMap,R(_,qo),y(_,"useFadeOut",!0),y(_,"customStylesEnabled",!0),y(_,"playerListAvatars",!0),y(_,"hidden",!1);let Ie=_;var Ln,io,Nt;const pe=class pe{static init(){var n;if(w.isModuleOn("foundry-taskbar")&&Hooks.on(D.UPDATE_USER,pe.checkTaskbarLock),pe.checkTaskbarLock(),setTimeout(()=>{pe.addModuleClasses()},100),w.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0}),Hooks.on(D.CLIENT_SETTING_CHANGED,a=>{a.includes("fvtt-youtube-player.windowPosition")&&pe.handleYTPlayerFadeOut()}),I(pe,Nt,0),I(pe,io,setInterval(()=>{(document.querySelector("#sidebar-video-player")||m(pe,Nt)>=10)&&(clearInterval(m(pe,io)),pe.handleYTPlayerFadeOut()),Dn(pe,Nt)._++},200)),w.isModuleOn("dfreds-chat-pins")){const a=document.querySelector("#chat-pins"),s=game.settings.get("core","uiConfig"),r=(n=s==null?void 0:s.colorScheme)==null?void 0:n.interface;g.log("currentTheme",[r,a]),a==null||a.classList.add(`theme-${r}`)}}static handleYTPlayerFadeOut(){var o,n;const e=w.isModuleOn("fvtt-youtube-player"),t=document.querySelector("#sidebar-video-player.tyw-docked");g.log("handleYTPlayerFadeOut",[e,Ie.useFadeOut,t]),e&&t&&Ie.useFadeOut?(o=document.querySelector("#sidebar-video-player.tyw-docked"))==null||o.classList.add("faded-ui"):e&&((n=document.querySelector("#sidebar-video-player"))==null||n.classList.remove("faded-ui"))}};Ln=new WeakMap,io=new WeakMap,Nt=new WeakMap,R(pe,Ln),R(pe,io),R(pe,Nt,0),y(pe,"addModuleClasses",()=>{const e=k(),t=L.get(e.otherModulesList.tag)||[];if(g.log("addModuleClasses",[t]),!Array.isArray(t)){console.warn("otherModulesList is not an array, skipping module classes");return}Object.values(e.otherModulesList.options).forEach(o=>{const n=o.replace(/['''"]/g,"").trim();document.querySelector("body").classList.remove("crlngn-"+n)}),t.forEach(o=>{if(o.enabled&&o.id){const n=o.id.trim(),a=game.modules.get(n),s=a==null?void 0:a.active;g.log(`Checking module: ${n}`,["enabled in settings:",o.enabled,"moduleData:",a,"active:",s]),s?(document.querySelector("body").classList.add("crlngn-"+n),g.log(`Added class for active module: crlngn-${n}`)):g.log(`Skipping class for inactive/missing module: ${n}`,["Module exists:",!!a,"Module active:",s])}})}),y(pe,"checkTaskbarLock",()=>{var a,s,r;const e=w.isModuleOn("foundry-taskbar"),t=(a=game.user.flags)==null?void 0:a["foundry-taskbar"];if(!e||!(t!=null&&t.taskbarSettings))return;const o=game.settings.get("foundry-taskbar","reduceSidebar");g.log("checkTaskbarLock #2",[t,o]),(s=t.taskbarSettings)!=null&&s.locked?w.addCSSVars("--crlngn-margin-bottom",o?"50px":"0px"):w.addCSSVars("--crlngn-margin-bottom",o?"10px":"0px"),(r=t.taskbarSettings)!=null&&r.locked?w.addCSSVars("--crlngn-taskbar-height","50px"):w.addCSSVars("--crlngn-taskbar-height","10px"),w.addCustomCSS("body.crlngn-ui #ui-right {height: calc((100% - var(--crlngn-margin-bottom)) / var(--ui-scale));}");const n=document.querySelector("#ft-move-players-macro");n&&(n.innerHTML="")});let Ot=pe;var Z,lo,ut,Nn,wt,gt,ft,Ho,wn,co,Re,kt,pt,Ae,Qe,xe,Rt,uo,xo,go,fo,Bo,Uo,$o,Wo,Vo,jo,Yo;const c=class c{static applyFadeOut(e){c.useFadeOut=e,g.log("applyFadeOut",[e]),c.handleSceneFadeOut()}static applyHide(e){c.hidden=e,c.handleHide()}static handleHide(){const e=document.querySelector("#scene-navigation"),t=document.querySelector("#crlngn-scene-navigation-expand"),o=document.querySelectorAll("#ui-left-column-2 .crlngn-btn");c.hidden||document.querySelector("body").classList.contains("hide-player-ui-navigation")?(e==null||e.classList.add("hidden-ui"),t==null||t.classList.add("hidden-ui"),o.forEach(n=>{n.classList.add("hidden-ui")})):(e==null||e.classList.remove("hidden-ui"),t==null||t.classList.remove("hidden-ui"),o.forEach(n=>{n.classList.remove("hidden-ui")}))}static applyCustomStyle(e){c.sceneNavEnabled=e,g.log("applyCustomStyle - TopNavigation",[c.sceneNavEnabled,ui.nav])}static resetLocalVars(){I(c,Z,document.querySelector("#scene-navigation")),I(c,wt,document.querySelector("#crlngn-scene-navigation-expand")),I(c,gt,document.querySelector("#ui-left")),I(c,lo,document.querySelector("#scene-navigation-inactive"))}static handleSceneFadeOut(e,t,o){const n=document.querySelector("#ui-left-column-2"),a=t||document.querySelector("#ui-left-column-2 #scene-navigation")||null;g.log("handleSceneFadeOut",[t,a,document.querySelector("#ui-left-column-2 #scene-navigation")]),c.sceneNavEnabled?(a==null||a.classList.remove("faded-ui"),c.useFadeOut?n==null||n.classList.add("faded-ui"):n==null||n.classList.remove("faded-ui")):c.useFadeOut?a==null||a.classList.add("faded-ui"):a==null||a.classList.remove("faded-ui")}static handleFolderList(e,t,o){var n;!c.useSceneFolders||!((n=game.user)!=null&&n.isGM)||it.addFolderButtons(e,t,o)}static handleNavState(){const e=k();m(c,co)&&(I(c,co,!1),c.toggleNav(L.get(e.navStartCollapsed.tag)))}static updateToggleButton(e){const t=document.querySelector("#crlngn-scene-navigation-expand");if(!t)return;const o=t.querySelector("i"),n=document.querySelector("#scene-navigation");n==null||n.classList.toggle("expanded",e),o&&(o.classList.toggle("fa-caret-down",!e),o.classList.toggle("fa-caret-up",e));const a=e?"SCENE_NAVIGATION.COLLAPSE":"SCENE_NAVIGATION.EXPAND",s=game.i18n.localize(a);t.setAttribute("data-tooltip",a),t.setAttribute("aria-label",s)}static toggleNav(e){I(c,Ho,setTimeout(()=>{c.resetLocalVars(),e===!0?(ui.nav.collapse(),c.isCollapsed=!0,g.log("toggleNav collapse",[ui.nav.collapse,e,c.navStartCollapsed]),document.querySelectorAll("#ui-left .crlngn-btn").forEach(o=>o.remove()),c.updateToggleButton(!1)):e===!1&&(c.isCollapsed=!1,ui.nav.expand(),g.log("toggleNav expand",[e,c.navStartCollapsed]),c.updateToggleButton(!0))},200))}static checkSceneNavCompat(){var e;k(),document.querySelector("#ui-left"),I(this,Rt,w.isModuleOn("monks-scene-navigation")),g.log("checkSceneNavCompat",[m(this,Rt)]),c.sceneNavEnabled&&!m(this,uo)&&(e=game.user)!=null&&e.isGM&&m(this,Rt)&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{localize:!0,permanent:!0,console:!1}),I(this,uo,!0))}static addListeners(){var e,t,o,n;(e=m(c,Z))==null||e.removeEventListener("mouseenter",m(c,go)),(t=m(c,Z))==null||t.removeEventListener("mouseleave",m(c,fo)),(o=m(c,Z))==null||o.addEventListener("mouseenter",m(c,go)),(n=m(c,Z))==null||n.addEventListener("mouseleave",m(c,fo))}static setNavPosition(e=null,t=!0,o=400){var n,a;try{const s=k();if(!m(c,Z))return;const r=((n=m(c,Z))==null?void 0:n.querySelectorAll("li.nav-item"))||[],i=0,d=e!==null?e:c.navPos||0,p=(a=m(c,Z))==null?void 0:a.querySelector("li.nav-item:first-of-type");if(!p)return;const u=r[d],h=p.offsetWidth||0,C=parseInt(h)*d;g.log("setNavPosition",["position",d,C,m(c,Z).scrollWidth]);const b=C-i;if(b>m(c,Z).scrollWidth)return;c.navPos=d,L.set(s.sceneNavPos.tag,d),t?w.smoothScrollTo(m(c,Z),b,"horizontal",o):m(c,Z).scrollTo({left:b,behavior:"instant"})}catch(s){g.log("setNavPosition",["Error:",s]),console.error("Error in setNavPosition:",s)}}static loadSettings(){const e=k();c.navStartCollapsed=L.get(e.navStartCollapsed.tag),c.showNavOnHover=L.get(e.showNavOnHover.tag),c.sceneNavEnabled=L.get(e.sceneNavEnabled.tag),c.useScenePreview=L.get(e.useScenePreview.tag),c.useSceneFolders=L.get(e.useSceneFolders.tag),c.navFoldersForPlayers=L.get(e.navFoldersForPlayers.tag),c.navShowRootFolders=L.get(e.navShowRootFolders.tag),c.useSceneIcons=L.get(e.useSceneIcons.tag),c.useSceneBackButton=L.get(e.useSceneBackButton.tag),c.useSceneLookup=L.get(e.useSceneLookup.tag),c.sceneClickToView=L.get(e.sceneClickToView.tag),c.isCollapsed=c.navStartCollapsed}static refreshSettings(){c.loadSettings();const e=document.querySelector("body");c.sceneNavEnabled?e.classList.add("crlngn-scene-nav"):e.classList.remove("crlngn-scene-nav"),ui.nav&&ui.nav.render()}};Z=new WeakMap,lo=new WeakMap,ut=new WeakMap,Nn=new WeakMap,wt=new WeakMap,gt=new WeakMap,ft=new WeakMap,Ho=new WeakMap,wn=new WeakMap,co=new WeakMap,Re=new WeakMap,kt=new WeakMap,pt=new WeakMap,Ae=new WeakMap,Qe=new WeakMap,xe=new WeakMap,Rt=new WeakMap,uo=new WeakMap,xo=new WeakMap,go=new WeakMap,fo=new WeakMap,Bo=new WeakMap,Uo=new WeakMap,$o=new WeakMap,Wo=new WeakMap,Vo=new WeakMap,jo=new WeakMap,Yo=new WeakMap,R(c,Z),R(c,lo),R(c,ut),R(c,Nn),R(c,wt),R(c,gt),y(c,"sceneFoldersTemplate"),y(c,"navButtonsTemplate"),R(c,ft),R(c,Ho),R(c,wn),R(c,co,!0),R(c,Re,null),R(c,kt,null),R(c,pt,""),R(c,Ae,[]),R(c,Qe,!1),R(c,xe),R(c,Rt,!1),R(c,uo,!1),y(c,"useFadeOut",!0),y(c,"hidden",!1),y(c,"sceneNavEnabled"),y(c,"useSceneFolders"),y(c,"navFoldersForPlayers"),y(c,"navShowRootFolders"),y(c,"hideInactiveOnFolderToggle"),y(c,"navStartCollapsed"),y(c,"showNavOnHover"),y(c,"useSceneIcons"),y(c,"useScenePreview"),y(c,"useSceneBackButton"),y(c,"useSceneLookup"),y(c,"sceneClickToView"),y(c,"isCollapsed"),y(c,"navPos"),y(c,"init",()=>{k(),Hooks.on(D.RENDER_SCENE_NAV,c.onRender),c.loadSettings(),g.log("SCENE NAV INIT",[c.sceneNavEnabled]);const e=document.querySelector("body");c.sceneNavEnabled?e.classList.add("crlngn-scene-nav"):e.classList.remove("crlngn-scene-nav"),c.sceneNavEnabled&&(c.checkSceneNavCompat(),c.preloadTemplates(),it.init(),Hooks.on(D.READY,()=>{c.handleSceneFadeOut(),w.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",t=>t.top=42)}),Hooks.on(D.COLLAPSE_SIDE_BAR,t=>{g.log(D.COLLAPSE_SIDE_BAR,[t]),c.checkSideBar(t.expanded||!1),c.placeNavButtons()}),Hooks.on(D.COLLAPSE_SCENE_NAV,(t,o)=>{clearTimeout(m(c,ft)),c.isCollapsed=o,o&&document.querySelectorAll("#ui-left .crlngn-btn").forEach(a=>a.remove()),I(c,ft,setTimeout(()=>{c.setCollapsedClass(o),c.updateToggleButton(!o),c.applySceneNavOffset()},250))}),c.placeNavButtons()),Hooks.on(D.CREATE_SCENE,()=>{var t;(t=ui.nav)==null||t.render()}),Hooks.on(D.UPDATE_SCENE,()=>{if(m(c,Qe)){I(c,Qe,!1);return}g.log(D.UPDATE_SCENE,[m(c,Qe)])}),Hooks.on(D.DELETE_SCENE,()=>{var t;(t=ui.nav)==null||t.render()}),Hooks.on(D.CANVAS_INIT,()=>{var o,n;const t=(n=(o=game.scenes)==null?void 0:o.viewed)==null?void 0:n.id;t!==m(c,Ae)[m(c,Ae).length-1]&&m(c,Ae).push(t),c.handleSceneFadeOut()}),Hooks.on(D.RENDER_SCENE_DIRECTORY,t=>{g.log(D.RENDER_SCENE_DIRECTORY,[t]),document.querySelector("#scenes .directory-list").querySelectorAll(".directory-item.scene").forEach(a=>{var r,i;const s=game.scenes.get(a.dataset.entryId);if(c.sceneClickToView&&(a.addEventListener("dblclick",c.onActivateScene),a.addEventListener("click",c.onSelectScene)),c.useSceneIcons&&s&&((r=game.user)!=null&&r.isGM)){let d=document.createElement("i");d.classList.add("fas"),d.classList.add("icon"),s.ownership.default!==0?(s.active&&(d.classList.add("fa-bullseye"),a.prepend(d)),((i=game.scenes.current)==null?void 0:i.id)===s.id&&(d.classList.add("fa-star"),a.prepend(d))):(d.classList.add("fa-eye-slash"),a.prepend(d))}})}),c.handleHide()}),y(c,"onRender",(e,t,o)=>{var s;const n=k(),a=L.get(n.sceneNavPos.tag);if(!c.preventNavRender){if(g.log("onRender - "+D.RENDER_SCENE_NAV,[t]),c.checkSceneNavCompat(),c.resetLocalVars(),c.handleHide(),c.sceneNavEnabled?(c.handleExtraButtons(e,t,o),c.handleSceneList(e,t,o),c.handleFolderList(e,t,o),c.setNavPosition(a,!1),c.handleNavState(),c.addListeners(),c.addSceneListeners(t),w.addCSSVars("--region-legend-offset","calc(-100vw + 500px)")):w.addCSSVars("--region-legend-offset","0px"),c.resetLocalVars(),c.sceneNavEnabled&&c.navShowRootFolders&&game.user.isGM&&(it.init(),it.renderFolderList()),c.sceneNavEnabled&&(clearTimeout(m(c,ft)),I(c,ft,setTimeout(()=>{g.log("NAV no transition remove"),c.placeNavButtons(),c.applySceneNavOffset()},500))),(s=game.user)!=null&&s.isGM){const r=L.get(n.navShowRootFolders.tag),i=L.get(n.hideInactiveOnFolderToggle.tag),d=t.querySelectorAll("#scene-navigation-inactive .scene"),p=document.querySelector("#crlngn-folder-toggle");g.log("hideInactiveOnToggle",[r,i,d,p]),i&&r&&p?d.forEach(u=>u.classList.add("hidden")):i&&d.forEach(u=>u.classList.remove("hidden"))}c.handleSceneFadeOut(e,t,o)}}),y(c,"setCollapsedClass",e=>{const t=document.querySelector("body");e?(m(c,gt).classList.add("navigation-collapsed"),t.classList.add("navigation-collapsed"),w.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",o=>o.top=10)):(m(c,gt).classList.remove("navigation-collapsed"),t.classList.remove("navigation-collapsed"),c.placeNavButtons(),w.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",o=>o.top=42))}),y(c,"checkSideBar",(e=!1)=>{c.placeNavButtons();const t=document.querySelector("body");g.log("TopNavigation.checkSideBar",[ui.sidebar,e]),e?t.classList.add("crlngn-sidebar-expanded"):t.classList.remove("crlngn-sidebar-expanded")}),y(c,"handleSceneList",async(e,t,o)=>{var a,s,r,i;g.log("handleSceneList",[e,t,o,c.useScenePreview,(a=game.user)==null?void 0:a.isGM]);const n=t.querySelectorAll(".scene-navigation-menu li.scene");for(const d of n){const p=d.dataset.sceneId;if(c.useScenePreview&&((s=game.user)!=null&&s.isGM)){const u=game.scenes.find(C=>C.id===p);u.isGM=(r=game.user)==null?void 0:r.isGM;const h=await w.renderTemplate(`modules/${H}/templates/scene-nav-preview.hbs`,u);if(d.classList.add("nav-item"),d.insertAdjacentHTML("beforeend",h),u.isGM&&m(c,pt)===p){const C=new MouseEvent("mouseenter");d.dispatchEvent(C)}c.addPreviewIconListeners(d,u)}c.useSceneIcons&&d.classList.add("crlngn")}if(c.sceneNavEnabled){const d=document.querySelector("#ui-left-column-2"),p=document.querySelector("#crlngn-scene-navigation-expand");if(!d)return;p&&p.remove();const u=await w.renderTemplate(`modules/${H}/templates/scene-nav-toggle.hbs`,{isExpanded:((i=ui.nav)==null?void 0:i.expanded)||!1});d.insertAdjacentHTML("afterbegin",u);const h=document.querySelector("#crlngn-scene-navigation-expand");h&&h.addEventListener("click",C=>{C.preventDefault(),C.stopPropagation(),ui.nav&&(g.log("Toggle nav clicked",["expanded:",ui.nav.expanded]),c.toggleNav(ui.nav.expanded))})}}),y(c,"handleExtraButtons",async(e,t,o)=>{var s,r,i,d,p;k(),g.log("handleExtraButtons",[e,t,o]);const n=await w.renderTemplate(`modules/${H}/templates/scene-nav-extra-buttons.hbs`,{useSceneBackButton:c.useSceneBackButton,useSceneFolders:(s=game.user)!=null&&s.isGM?c.useSceneFolders:!1,useSceneLookup:(r=game.user)!=null&&r.isGM?c.useSceneLookup:!1,backButtonTooltip:game.i18n.localize("CRLNGN_UI.ui.sceneNav.backButtonTooltip"),sceneLookupTooltip:game.i18n.localize("CRLNGN_UI.ui.sceneNav.sceneLookupTooltip"),isGM:(i=game.user)==null?void 0:i.isGM});(d=t.querySelector("#scene-navigation-active"))==null||d.insertAdjacentHTML("afterbegin",n);const a=t.querySelector("#crlngn-back-button");a&&a.addEventListener("click",m(c,xo)),c.sceneNavEnabled&&c.useSceneLookup&&((p=game.user)!=null&&p.isGM)&&it.handleFolderLookup(e,t,o)}),R(c,xo,e=>{var a;e.stopPropagation(),e.preventDefault();const t=m(c,Ae).length,o=m(c,Ae)[t-2];let n;g.log("#onBackButton before",[t,o,m(c,Ae)]),o&&o!==((a=game.scenes.current)==null?void 0:a.id)&&(n=game.scenes.get(o),n&&n.view(),m(c,Ae).pop()),g.log("#onBackButton after",[m(c,Ae)])}),R(c,go,e=>{if(g.log("TopNavigation mouseenter",[]),!c.isCollapsed||!c.showNavOnHover)return;e.stopPropagation(),clearTimeout(m(c,ut)),document.querySelector("#scene-navigation").classList.add("expanded")}),R(c,fo,e=>{g.log("TopNavigation mouseleave",[]),!(!c.isCollapsed||!c.showNavOnHover)&&(e.stopPropagation(),I(c,ut,setTimeout(()=>{clearTimeout(m(c,ut)),I(c,ut,null),document.querySelector("#scene-navigation").classList.remove("expanded")},700)))}),y(c,"placeNavButtons",async()=>{var i;const e=document.querySelector("#scene-navigation");if(!e||!c.sceneNavEnabled)return;e.querySelector("#scene-navigation-inactive");let t=document.querySelectorAll("button.crlngn-btn");const o=((i=m(c,wt))==null?void 0:i.offsetWidth)*2||0,n=e.offsetWidth-o<e.scrollWidth;if(g.log("placeNavButtons *",[c.isCollapsed,n,t]),!n||c.isCollapsed||m(c,gt).classList.contains("navigation-collapsed")){t.forEach(d=>{g.log("placeNavButtons remove",[d.remove,d]),d.remove()}),t=[];return}if(t.length>0)return;const a=await w.renderTemplate(`modules/${H}/templates/scene-nav-buttons.hbs`,{});e.insertAdjacentHTML("afterend",a);const s=document.querySelector("#ui-left button.crlngn-btn.ui-nav-left"),r=document.querySelector("#ui-left button.crlngn-btn.ui-nav-right");s&&s.addEventListener("click",m(c,Bo)),r&&r.addEventListener("click",m(c,Uo)),c.handleHide(),c.applySceneNavOffset()}),R(c,Bo,async e=>{const t=await c.getItemsPerPage(),o=c.navPos||0;if(!m(c,lo)||!m(c,Z))return;let n=o-(t-1);g.log("onNavLast",["pos",n,m(c,Z).scrollWidth]),n=n<0?0:n,c.setNavPosition(n)}),R(c,Uo,async e=>{var d,p;const t=await c.getItemsPerPage(),o=c.navPos||0,n=(d=m(c,Z))==null?void 0:d.querySelector("li.nav-item:first-of-type"),a=(n==null?void 0:n.offsetWidth)||0,s=((p=m(c,Z))==null?void 0:p.scrollWidth)||0;if(!a||!m(c,Z))return;let r=o+(t-1),i=r*a;g.log("onNavNext",["pos",o,r,n==null?void 0:n.offsetWidth,i,s]),i>=s&&(r=Math.floor(s/a)),c.setNavPosition(r)}),y(c,"getItemsPerPage",async()=>{var e,t;try{g.log("getItemsPerPage",["Starting"]),c.resetLocalVars();const o=0,n=0,a=((e=m(c,wt))==null?void 0:e.offsetWidth)||0,s=(t=m(c,Z))==null?void 0:t.querySelector("li.nav-item:first-of-type");if(!s||!m(c,Z))return g.log("getItemsPerPage",["No scene items found"]),0;const r=s.offsetWidth,i=m(c,Z).offsetWidth;if(!i)return g.log("getItemsPerPage",["Nav element has no width"]),0;const d=Math.floor((i-a*2)/r);return g.log("getItemsPerPage",["Calculated:",d,i,r]),d||0}catch(o){return g.log("getItemsPerPage",["Error:",o]),g.error("Error in getItemsPerPage:",o),0}}),y(c,"preloadTemplates",async()=>{try{const e=[`modules/${H}/templates/scene-nav-buttons.hbs`,`modules/${H}/templates/scene-nav-preview.hbs`,`modules/${H}/templates/scene-nav-toggle.hbs`];return await w.loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),y(c,"getCurrScenePosition",async e=>{try{if(!m(c,Z)||!e)return 0;const t=await c.getItemsPerPage()||1,o=m(c,Z).querySelectorAll("li.nav-item");if(!o||o.length===0)return 0;const a=Array.from(o).findIndex(i=>i.dataset.sceneId===e);if(a===-1)return 0;const s=a>=c.navPos&&a<=c.navPos+t,r=s?c.navPos:a;return g.log("getCurrScenePosition",["Final position:",r,"isVisible:",s]),r}catch(t){return g.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}}),y(c,"onActivateScene",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,n=t.classList.contains("scene-name")?t.parentNode.dataset:t.dataset,a=game.scenes.get(n.entryId||n.sceneId);g.log("onActivateScene",[n,a]),a.activate(),a.sheet.render=m(c,xe),m(c,Re)&&(clearTimeout(m(c,Re)),I(c,Re,null))}),y(c,"onSelectScene",e=>{var s;e.preventDefault(),e.stopPropagation();const t=e.currentTarget,o=t.classList.contains("scene-name"),n=o?t.parentNode.dataset:t.dataset,a=game.scenes.get(n.entryId||n.sceneId);I(c,pt,""),g.log("onSelectScene",[a,t,o]),a&&a.sheet&&!m(c,Re)&&(I(c,xe,(s=a==null?void 0:a.sheet)==null?void 0:s.render),g.log("onSelectScene - originalRender",[m(c,xe)]),a.sheet.render=()=>{},setTimeout(()=>{a.sheet.render=m(c,xe)},500)),m(c,Re)&&(clearTimeout(m(c,Re)),a.sheet.render=m(c,xe),I(c,Re,null)),I(c,Re,setTimeout(()=>{a.view(),a.sheet.render=m(c,xe),I(c,Re,null)},350))}),y(c,"onScenePreviewOn",e=>{if(g.log("onScenePreviewOn",[]),e.preventDefault(),c.isCollapsed)return;const t=e.currentTarget,o=t.dataset;I(c,pt,o.sceneId),I(c,kt,setTimeout(()=>{var n;clearTimeout(m(c,kt)),(n=t.querySelector(".scene-preview"))==null||n.classList.add("open")},200))}),y(c,"onScenePreviewOff",e=>{var o;if(g.log("onScenePreviewOff",[]),e.preventDefault(),clearTimeout(m(c,kt)),c.isCollapsed)return;const t=e.currentTarget;I(c,pt,""),(o=t.querySelector(".scene-preview"))==null||o.classList.remove("open")}),y(c,"addSceneListeners",e=>{e.querySelectorAll("li.scene").forEach(o=>{var n;if(o.querySelector(".scene-name").addEventListener("click",c.onSelectScene),o.querySelector(".scene-name").addEventListener("dblclick",c.onActivateScene),o.removeEventListener("mouseenter",c.onScenePreviewOn),o.removeEventListener("mouseleave",c.onScenePreviewOff),c.useScenePreview){const a=o.dataset.sceneId,s=game.scenes.find(r=>r.id===a);(n=game.user)!=null&&n.isGM&&c.addPreviewIconListeners(o,s),o.addEventListener("mouseenter",c.onScenePreviewOn),o.addEventListener("mouseleave",c.onScenePreviewOff)}})}),y(c,"addPreviewIconListeners",(e,t)=>{if(!e||!t)return;const o=game.scenes.get(t.id);if(!o)return;const n=e.querySelector(".scene-preview");if(!n)return;const a=n.querySelector(".ilum");a&&a.addEventListener("click",m(c,jo));const s=n.querySelector(".token-vision");s&&s.addEventListener("click",m(c,Yo));const r=n.querySelector(".sound");r&&o.playlistSound&&r.addEventListener("click",m(c,Vo));const i=n.querySelector(".preload");i&&i.addEventListener("click",m(c,Wo));const d=n.querySelector(".config");d&&d.addEventListener("click",m(c,$o))}),R(c,$o,e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene");c.getSceneFromElement(t).sheet.render(!0),g.log("Opened scene configuration")}),R(c,Wo,e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene"),o=c.getSceneFromElement(t);game.scenes.preload(o.id,!0),g.log("Preloaded scene")}),R(c,Vo,async e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene");let o=c.getSceneFromElement(t);const n=o.playlistSound;if(n){const a=n.sound.playing;a?n.sound.pause():n.sound.play(),await c.updateScenePreview(t,o.id),g.log("Toggled playlist sound",[!a])}}),R(c,jo,async e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene");let o=c.getSceneFromElement(t);const n=o.environment.globalLight.enabled;I(c,Qe,!0),await o.update({"environment.globalLight.enabled":!n}),await c.updateScenePreview(t,o.id),g.log("Toggled global illumination",[!n])}),R(c,Yo,async e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene");let o=c.getSceneFromElement(t);const n=o.tokenVision;I(c,Qe,!0),await o.update({tokenVision:!n}),await c.updateScenePreview(t,o.id),g.log("Toggled token vision",[!n])}),y(c,"getSceneFromElement",e=>{const t=e.dataset.sceneId;return game.scenes.get(t)}),y(c,"updateScenePreview",async(e,t)=>{var d,p,u,h;if(!c.sceneNavEnabled||!e||!t)return;const o=game.scenes.get(t);if(!o)return;const n=e.querySelector(".scene-preview");if(!n)return;const a=n.classList.contains("open");g.log("Scene data for preview",[t,(p=(d=o.environment)==null?void 0:d.globalLight)==null?void 0:p.enabled,o.tokenVision]);const s={id:o.id,name:o.name,thumb:o.thumb||"",environment:o.environment,tokenVision:o.tokenVision,isGM:(u=game.user)==null?void 0:u.isGM},r=await w.renderTemplate(`modules/${H}/templates/scene-nav-preview.hbs`,s);n.outerHTML=r;const i=e.querySelector(".scene-preview");a&&i&&i.classList.add("open"),c.sceneNavEnabled&&c.useScenePreview&&(e.removeEventListener("mouseenter",c.onScenePreviewOn),e.removeEventListener("mouseleave",c.onScenePreviewOff),e.addEventListener("mouseenter",c.onScenePreviewOn),e.addEventListener("mouseleave",c.onScenePreviewOff),(h=game.user)!=null&&h.isGM&&c.addPreviewIconListeners(e,s))}),y(c,"applySceneItemWidth",()=>{const e=k(),t=L.get(e.sceneItemWidth.tag)||150;w.addCSSVars("--scene-nav-item-width",`${t}px`)}),y(c,"applyTopNavHeight",()=>{const e=k(),t=L.get(e.sceneNavEnabled.tag);w.addCSSVars("--top-nav-height",`${t?"calc(var(--control-item-size) + 1px)":"0px"}`)}),y(c,"applySceneNavOffset",()=>{const e=document.querySelector("#scene-navigation");if(!e||!c.sceneNavEnabled){w.addCSSVars("--scene-nav-offset","0px");return}if(!e.classList.contains("expanded")){w.addCSSVars("--scene-nav-offset","10px"),g.log("applySceneNavOffset",["Collapsed - 10px"]);return}if(c.navShowRootFolders){const o=e.querySelector("#scene-navigation-inactive");let n=1;const a=(o==null?void 0:o.querySelectorAll(".crlngn-folder-active"))||[];n+=a.length,w.addCSSVars("--scene-nav-offset",`calc(var(--top-nav-height) * ${n})`),g.log("applySceneNavOffset",["Rows:",n,"Active folders:",a.length])}else w.addCSSVars("--scene-nav-offset","var(--top-nav-height)"),g.log("applySceneNavOffset",["Single nav height"])});let z=c;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Pn(l,e){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(l);e&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(l,n).enumerable})),t.push.apply(t,o)}return t}function ze(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Pn(Object(t),!0).forEach(function(o){Ma(l,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):Pn(Object(t)).forEach(function(o){Object.defineProperty(l,o,Object.getOwnPropertyDescriptor(t,o))})}return l}function No(l){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?No=function(e){return typeof e}:No=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},No(l)}function Ma(l,e,t){return e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function Ue(){return Ue=Object.assign||function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(l[o]=t[o])}return l},Ue.apply(this,arguments)}function Oa(l,e){if(l==null)return{};var t={},o=Object.keys(l),n,a;for(a=0;a<o.length;a++)n=o[a],!(e.indexOf(n)>=0)&&(t[n]=l[n]);return t}function Aa(l,e){if(l==null)return{};var t=Oa(l,e),o,n;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(l);for(n=0;n<a.length;n++)o=a[n],!(e.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(l,o)&&(t[o]=l[o])}return t}var Da="1.15.6";function Be(l){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(l)}var $e=Be(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),po=Be(/Edge/i),Fn=Be(/firefox/i),Bt=Be(/safari/i)&&!Be(/chrome/i)&&!Be(/android/i),kn=Be(/iP(ad|od|hone)/i),_n=Be(/chrome/i)&&Be(/android/i),ea={capture:!1,passive:!1};function $(l,e,t){l.addEventListener(e,t,!$e&&ea)}function U(l,e,t){l.removeEventListener(e,t,!$e&&ea)}function Oo(l,e){if(e){if(e[0]===">"&&(e=e.substring(1)),l)try{if(l.matches)return l.matches(e);if(l.msMatchesSelector)return l.msMatchesSelector(e);if(l.webkitMatchesSelector)return l.webkitMatchesSelector(e)}catch{return!1}return!1}}function ta(l){return l.host&&l!==document&&l.host.nodeType?l.host:l.parentNode}function De(l,e,t,o){if(l){t=t||document;do{if(e!=null&&(e[0]===">"?l.parentNode===t&&Oo(l,e):Oo(l,e))||o&&l===t)return l;if(l===t)break}while(l=ta(l))}return null}var Gn=/\s+/g;function Le(l,e,t){if(l&&e)if(l.classList)l.classList[t?"add":"remove"](e);else{var o=(" "+l.className+" ").replace(Gn," ").replace(" "+e+" "," ");l.className=(o+(t?" "+e:"")).replace(Gn," ")}}function P(l,e,t){var o=l&&l.style;if(o){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(l,""):l.currentStyle&&(t=l.currentStyle),e===void 0?t:t[e];!(e in o)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),o[e]=t+(typeof t=="string"?"":"px")}}function Et(l,e){var t="";if(typeof l=="string")t=l;else do{var o=P(l,"transform");o&&o!=="none"&&(t=o+" "+t)}while(!e&&(l=l.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(t)}function oa(l,e,t){if(l){var o=l.getElementsByTagName(e),n=0,a=o.length;if(t)for(;n<a;n++)t(o[n],n);return o}return[]}function Ge(){var l=document.scrollingElement;return l||document.documentElement}function re(l,e,t,o,n){if(!(!l.getBoundingClientRect&&l!==window)){var a,s,r,i,d,p,u;if(l!==window&&l.parentNode&&l!==Ge()?(a=l.getBoundingClientRect(),s=a.top,r=a.left,i=a.bottom,d=a.right,p=a.height,u=a.width):(s=0,r=0,i=window.innerHeight,d=window.innerWidth,p=window.innerHeight,u=window.innerWidth),(e||t)&&l!==window&&(n=n||l.parentNode,!$e))do if(n&&n.getBoundingClientRect&&(P(n,"transform")!=="none"||t&&P(n,"position")!=="static")){var h=n.getBoundingClientRect();s-=h.top+parseInt(P(n,"border-top-width")),r-=h.left+parseInt(P(n,"border-left-width")),i=s+a.height,d=r+a.width;break}while(n=n.parentNode);if(o&&l!==window){var C=Et(n||l),b=C&&C.a,v=C&&C.d;C&&(s/=v,r/=b,u/=b,p/=v,i=s+p,d=r+u)}return{top:s,left:r,bottom:i,right:d,width:u,height:p}}}function zn(l,e,t){for(var o=tt(l,!0),n=re(l)[e];o;){var a=re(o)[t],s=void 0;if(s=n>=a,!s)return o;if(o===Ge())break;o=tt(o,!1)}return!1}function At(l,e,t,o){for(var n=0,a=0,s=l.children;a<s.length;){if(s[a].style.display!=="none"&&s[a]!==F.ghost&&(o||s[a]!==F.dragged)&&De(s[a],t.draggable,l,!1)){if(n===e)return s[a];n++}a++}return null}function Rn(l,e){for(var t=l.lastElementChild;t&&(t===F.ghost||P(t,"display")==="none"||e&&!Oo(t,e));)t=t.previousElementSibling;return t||null}function ke(l,e){var t=0;if(!l||!l.parentNode)return-1;for(;l=l.previousElementSibling;)l.nodeName.toUpperCase()!=="TEMPLATE"&&l!==F.clone&&(!e||Oo(l,e))&&t++;return t}function qn(l){var e=0,t=0,o=Ge();if(l)do{var n=Et(l),a=n.a,s=n.d;e+=l.scrollLeft*a,t+=l.scrollTop*s}while(l!==o&&(l=l.parentNode));return[e,t]}function Pa(l,e){for(var t in l)if(l.hasOwnProperty(t)){for(var o in e)if(e.hasOwnProperty(o)&&e[o]===l[t][o])return Number(t)}return-1}function tt(l,e){if(!l||!l.getBoundingClientRect)return Ge();var t=l,o=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var n=P(t);if(t.clientWidth<t.scrollWidth&&(n.overflowX=="auto"||n.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(n.overflowY=="auto"||n.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Ge();if(o||e)return t;o=!0}}while(t=t.parentNode);return Ge()}function Fa(l,e){if(l&&e)for(var t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);return l}function tn(l,e){return Math.round(l.top)===Math.round(e.top)&&Math.round(l.left)===Math.round(e.left)&&Math.round(l.height)===Math.round(e.height)&&Math.round(l.width)===Math.round(e.width)}var Ut;function na(l,e){return function(){if(!Ut){var t=arguments,o=this;t.length===1?l.call(o,t[0]):l.apply(o,t),Ut=setTimeout(function(){Ut=void 0},e)}}}function Ga(){clearTimeout(Ut),Ut=void 0}function aa(l,e,t){l.scrollLeft+=e,l.scrollTop+=t}function sa(l){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(l).cloneNode(!0):t?t(l).clone(!0)[0]:l.cloneNode(!0)}function ra(l,e,t){var o={};return Array.from(l.children).forEach(function(n){var a,s,r,i;if(!(!De(n,e.draggable,l,!1)||n.animated||n===t)){var d=re(n);o.left=Math.min((a=o.left)!==null&&a!==void 0?a:1/0,d.left),o.top=Math.min((s=o.top)!==null&&s!==void 0?s:1/0,d.top),o.right=Math.max((r=o.right)!==null&&r!==void 0?r:-1/0,d.right),o.bottom=Math.max((i=o.bottom)!==null&&i!==void 0?i:-1/0,d.bottom)}}),o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}var Ee="Sortable"+new Date().getTime();function za(){var l=[],e;return{captureAnimationState:function(){if(l=[],!!this.options.animation){var o=[].slice.call(this.el.children);o.forEach(function(n){if(!(P(n,"display")==="none"||n===F.ghost)){l.push({target:n,rect:re(n)});var a=ze({},l[l.length-1].rect);if(n.thisAnimationDuration){var s=Et(n,!0);s&&(a.top-=s.f,a.left-=s.e)}n.fromRect=a}})}},addAnimationState:function(o){l.push(o)},removeAnimationState:function(o){l.splice(Pa(l,{target:o}),1)},animateAll:function(o){var n=this;if(!this.options.animation){clearTimeout(e),typeof o=="function"&&o();return}var a=!1,s=0;l.forEach(function(r){var i=0,d=r.target,p=d.fromRect,u=re(d),h=d.prevFromRect,C=d.prevToRect,b=r.rect,v=Et(d,!0);v&&(u.top-=v.f,u.left-=v.e),d.toRect=u,d.thisAnimationDuration&&tn(h,u)&&!tn(p,u)&&(b.top-u.top)/(b.left-u.left)===(p.top-u.top)/(p.left-u.left)&&(i=Ha(b,h,C,n.options)),tn(u,p)||(d.prevFromRect=p,d.prevToRect=u,i||(i=n.options.animation),n.animate(d,b,u,i)),i&&(a=!0,s=Math.max(s,i),clearTimeout(d.animationResetTimer),d.animationResetTimer=setTimeout(function(){d.animationTime=0,d.prevFromRect=null,d.fromRect=null,d.prevToRect=null,d.thisAnimationDuration=null},i),d.thisAnimationDuration=i)}),clearTimeout(e),a?e=setTimeout(function(){typeof o=="function"&&o()},s):typeof o=="function"&&o(),l=[]},animate:function(o,n,a,s){if(s){P(o,"transition",""),P(o,"transform","");var r=Et(this.el),i=r&&r.a,d=r&&r.d,p=(n.left-a.left)/(i||1),u=(n.top-a.top)/(d||1);o.animatingX=!!p,o.animatingY=!!u,P(o,"transform","translate3d("+p+"px,"+u+"px,0)"),this.forRepaintDummy=qa(o),P(o,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),P(o,"transform","translate3d(0,0,0)"),typeof o.animated=="number"&&clearTimeout(o.animated),o.animated=setTimeout(function(){P(o,"transition",""),P(o,"transform",""),o.animated=!1,o.animatingX=!1,o.animatingY=!1},s)}}}}function qa(l){return l.offsetWidth}function Ha(l,e,t,o){return Math.sqrt(Math.pow(e.top-l.top,2)+Math.pow(e.left-l.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*o.animation}var mt=[],on={initializeByDefault:!0},ho={mount:function(e){for(var t in on)on.hasOwnProperty(t)&&!(t in e)&&(e[t]=on[t]);mt.forEach(function(o){if(o.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),mt.push(e)},pluginEvent:function(e,t,o){var n=this;this.eventCanceled=!1,o.cancel=function(){n.eventCanceled=!0};var a=e+"Global";mt.forEach(function(s){t[s.pluginName]&&(t[s.pluginName][a]&&t[s.pluginName][a](ze({sortable:t},o)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](ze({sortable:t},o)))})},initializePlugins:function(e,t,o,n){mt.forEach(function(r){var i=r.pluginName;if(!(!e.options[i]&&!r.initializeByDefault)){var d=new r(e,t,e.options);d.sortable=e,d.options=e.options,e[i]=d,Ue(o,d.defaults)}});for(var a in e.options)if(e.options.hasOwnProperty(a)){var s=this.modifyOption(e,a,e.options[a]);typeof s<"u"&&(e.options[a]=s)}},getEventProperties:function(e,t){var o={};return mt.forEach(function(n){typeof n.eventProperties=="function"&&Ue(o,n.eventProperties.call(t[n.pluginName],e))}),o},modifyOption:function(e,t,o){var n;return mt.forEach(function(a){e[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[t]=="function"&&(n=a.optionListeners[t].call(e[a.pluginName],o))}),n}};function xa(l){var e=l.sortable,t=l.rootEl,o=l.name,n=l.targetEl,a=l.cloneEl,s=l.toEl,r=l.fromEl,i=l.oldIndex,d=l.newIndex,p=l.oldDraggableIndex,u=l.newDraggableIndex,h=l.originalEvent,C=l.putSortable,b=l.extraEventProperties;if(e=e||t&&t[Ee],!!e){var v,G=e.options,A="on"+o.charAt(0).toUpperCase()+o.substr(1);window.CustomEvent&&!$e&&!po?v=new CustomEvent(o,{bubbles:!0,cancelable:!0}):(v=document.createEvent("Event"),v.initEvent(o,!0,!0)),v.to=s||t,v.from=r||t,v.item=n||t,v.clone=a,v.oldIndex=i,v.newIndex=d,v.oldDraggableIndex=p,v.newDraggableIndex=u,v.originalEvent=h,v.pullMode=C?C.lastPutMode:void 0;var V=ze(ze({},b),ho.getEventProperties(o,e));for(var Y in V)v[Y]=V[Y];t&&t.dispatchEvent(v),G[A]&&G[A].call(e,v)}}var Ba=["evt"],ve=function(e,t){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=o.evt,a=Aa(o,Ba);ho.pluginEvent.bind(F)(e,t,ze({dragEl:N,parentEl:oe,ghostEl:q,rootEl:Q,nextEl:rt,lastDownEl:wo,cloneEl:te,cloneHidden:Je,dragStarted:zt,putSortable:ge,activeSortable:F.active,originalEvent:n,oldIndex:St,oldDraggableIndex:$t,newIndex:Ne,newDraggableIndex:Ye,hideGhostForTarget:da,unhideGhostForTarget:ua,cloneNowHidden:function(){Je=!0},cloneNowShown:function(){Je=!1},dispatchSortableEvent:function(r){be({sortable:t,name:r,originalEvent:n})}},a))};function be(l){xa(ze({putSortable:ge,cloneEl:te,targetEl:N,rootEl:Q,oldIndex:St,oldDraggableIndex:$t,newIndex:Ne,newDraggableIndex:Ye},l))}var N,oe,q,Q,rt,wo,te,Je,St,Ne,$t,Ye,bo,ge,bt=!1,Ao=!1,Do=[],nt,Oe,nn,an,Hn,xn,zt,yt,Wt,Vt=!1,So=!1,ko,me,sn=[],mn=!1,Po=[],Zo=typeof document<"u",vo=kn,Bn=po||$e?"cssFloat":"float",Ua=Zo&&!_n&&!kn&&"draggable"in document.createElement("div"),ia=function(){if(Zo){if($e)return!1;var l=document.createElement("x");return l.style.cssText="pointer-events:auto",l.style.pointerEvents==="auto"}}(),la=function(e,t){var o=P(e),n=parseInt(o.width)-parseInt(o.paddingLeft)-parseInt(o.paddingRight)-parseInt(o.borderLeftWidth)-parseInt(o.borderRightWidth),a=At(e,0,t),s=At(e,1,t),r=a&&P(a),i=s&&P(s),d=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+re(a).width,p=i&&parseInt(i.marginLeft)+parseInt(i.marginRight)+re(s).width;if(o.display==="flex")return o.flexDirection==="column"||o.flexDirection==="column-reverse"?"vertical":"horizontal";if(o.display==="grid")return o.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&r.float&&r.float!=="none"){var u=r.float==="left"?"left":"right";return s&&(i.clear==="both"||i.clear===u)?"vertical":"horizontal"}return a&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||d>=n&&o[Bn]==="none"||s&&o[Bn]==="none"&&d+p>n)?"vertical":"horizontal"},$a=function(e,t,o){var n=o?e.left:e.top,a=o?e.right:e.bottom,s=o?e.width:e.height,r=o?t.left:t.top,i=o?t.right:t.bottom,d=o?t.width:t.height;return n===r||a===i||n+s/2===r+d/2},Wa=function(e,t){var o;return Do.some(function(n){var a=n[Ee].options.emptyInsertThreshold;if(!(!a||Rn(n))){var s=re(n),r=e>=s.left-a&&e<=s.right+a,i=t>=s.top-a&&t<=s.bottom+a;if(r&&i)return o=n}}),o},ca=function(e){function t(a,s){return function(r,i,d,p){var u=r.options.group.name&&i.options.group.name&&r.options.group.name===i.options.group.name;if(a==null&&(s||u))return!0;if(a==null||a===!1)return!1;if(s&&a==="clone")return a;if(typeof a=="function")return t(a(r,i,d,p),s)(r,i,d,p);var h=(s?r:i).options.group.name;return a===!0||typeof a=="string"&&a===h||a.join&&a.indexOf(h)>-1}}var o={},n=e.group;(!n||No(n)!="object")&&(n={name:n}),o.name=n.name,o.checkPull=t(n.pull,!0),o.checkPut=t(n.put),o.revertClone=n.revertClone,e.group=o},da=function(){!ia&&q&&P(q,"display","none")},ua=function(){!ia&&q&&P(q,"display","")};Zo&&!_n&&document.addEventListener("click",function(l){if(Ao)return l.preventDefault(),l.stopPropagation&&l.stopPropagation(),l.stopImmediatePropagation&&l.stopImmediatePropagation(),Ao=!1,!1},!0);var at=function(e){if(N){e=e.touches?e.touches[0]:e;var t=Wa(e.clientX,e.clientY);if(t){var o={};for(var n in e)e.hasOwnProperty(n)&&(o[n]=e[n]);o.target=o.rootEl=t,o.preventDefault=void 0,o.stopPropagation=void 0,t[Ee]._onDragOver(o)}}},Va=function(e){N&&N.parentNode[Ee]._isOutsideThisEl(e.target)};function F(l,e){if(!(l&&l.nodeType&&l.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(l));this.el=l,this.options=e=Ue({},e),l[Ee]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(l.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return la(l,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,r){s.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:F.supportPointer!==!1&&"PointerEvent"in window&&(!Bt||kn),emptyInsertThreshold:5};ho.initializePlugins(this,l,t);for(var o in t)!(o in e)&&(e[o]=t[o]);ca(e);for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this));this.nativeDraggable=e.forceFallback?!1:Ua,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?$(l,"pointerdown",this._onTapStart):($(l,"mousedown",this._onTapStart),$(l,"touchstart",this._onTapStart)),this.nativeDraggable&&($(l,"dragover",this),$(l,"dragenter",this)),Do.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Ue(this,za())}F.prototype={constructor:F,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(yt=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,N):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,o=this.el,n=this.options,a=n.preventOnFilter,s=e.type,r=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,i=(r||e).target,d=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||i,p=n.filter;if(_a(o),!N&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||n.disabled)&&!d.isContentEditable&&!(!this.nativeDraggable&&Bt&&i&&i.tagName.toUpperCase()==="SELECT")&&(i=De(i,n.draggable,o,!1),!(i&&i.animated)&&wo!==i)){if(St=ke(i),$t=ke(i,n.draggable),typeof p=="function"){if(p.call(this,e,i,this)){be({sortable:t,rootEl:d,name:"filter",targetEl:i,toEl:o,fromEl:o}),ve("filter",t,{evt:e}),a&&e.preventDefault();return}}else if(p&&(p=p.split(",").some(function(u){if(u=De(d,u.trim(),o,!1),u)return be({sortable:t,rootEl:u,name:"filter",targetEl:i,fromEl:o,toEl:o}),ve("filter",t,{evt:e}),!0}),p)){a&&e.preventDefault();return}n.handle&&!De(d,n.handle,o,!1)||this._prepareDragStart(e,r,i)}}},_prepareDragStart:function(e,t,o){var n=this,a=n.el,s=n.options,r=a.ownerDocument,i;if(o&&!N&&o.parentNode===a){var d=re(o);if(Q=a,N=o,oe=N.parentNode,rt=N.nextSibling,wo=o,bo=s.group,F.dragged=N,nt={target:N,clientX:(t||e).clientX,clientY:(t||e).clientY},Hn=nt.clientX-d.left,xn=nt.clientY-d.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,N.style["will-change"]="all",i=function(){if(ve("delayEnded",n,{evt:e}),F.eventCanceled){n._onDrop();return}n._disableDelayedDragEvents(),!Fn&&n.nativeDraggable&&(N.draggable=!0),n._triggerDragStart(e,t),be({sortable:n,name:"choose",originalEvent:e}),Le(N,s.chosenClass,!0)},s.ignore.split(",").forEach(function(p){oa(N,p.trim(),rn)}),$(r,"dragover",at),$(r,"mousemove",at),$(r,"touchmove",at),s.supportPointer?($(r,"pointerup",n._onDrop),!this.nativeDraggable&&$(r,"pointercancel",n._onDrop)):($(r,"mouseup",n._onDrop),$(r,"touchend",n._onDrop),$(r,"touchcancel",n._onDrop)),Fn&&this.nativeDraggable&&(this.options.touchStartThreshold=4,N.draggable=!0),ve("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(po||$e))){if(F.eventCanceled){this._onDrop();return}s.supportPointer?($(r,"pointerup",n._disableDelayedDrag),$(r,"pointercancel",n._disableDelayedDrag)):($(r,"mouseup",n._disableDelayedDrag),$(r,"touchend",n._disableDelayedDrag),$(r,"touchcancel",n._disableDelayedDrag)),$(r,"mousemove",n._delayedDragTouchMoveHandler),$(r,"touchmove",n._delayedDragTouchMoveHandler),s.supportPointer&&$(r,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(i,s.delay)}else i()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){N&&rn(N),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;U(e,"mouseup",this._disableDelayedDrag),U(e,"touchend",this._disableDelayedDrag),U(e,"touchcancel",this._disableDelayedDrag),U(e,"pointerup",this._disableDelayedDrag),U(e,"pointercancel",this._disableDelayedDrag),U(e,"mousemove",this._delayedDragTouchMoveHandler),U(e,"touchmove",this._delayedDragTouchMoveHandler),U(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?$(document,"pointermove",this._onTouchMove):t?$(document,"touchmove",this._onTouchMove):$(document,"mousemove",this._onTouchMove):($(N,"dragend",this),$(Q,"dragstart",this._onDragStart));try{document.selection?Ro(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(bt=!1,Q&&N){ve("dragStarted",this,{evt:t}),this.nativeDraggable&&$(document,"dragover",Va);var o=this.options;!e&&Le(N,o.dragClass,!1),Le(N,o.ghostClass,!0),F.active=this,e&&this._appendGhost(),be({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(Oe){this._lastX=Oe.clientX,this._lastY=Oe.clientY,da();for(var e=document.elementFromPoint(Oe.clientX,Oe.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Oe.clientX,Oe.clientY),e!==t);)t=e;if(N.parentNode[Ee]._isOutsideThisEl(e),t)do{if(t[Ee]){var o=void 0;if(o=t[Ee]._onDragOver({clientX:Oe.clientX,clientY:Oe.clientY,target:e,rootEl:t}),o&&!this.options.dragoverBubble)break}e=t}while(t=ta(t));ua()}},_onTouchMove:function(e){if(nt){var t=this.options,o=t.fallbackTolerance,n=t.fallbackOffset,a=e.touches?e.touches[0]:e,s=q&&Et(q,!0),r=q&&s&&s.a,i=q&&s&&s.d,d=vo&&me&&qn(me),p=(a.clientX-nt.clientX+n.x)/(r||1)+(d?d[0]-sn[0]:0)/(r||1),u=(a.clientY-nt.clientY+n.y)/(i||1)+(d?d[1]-sn[1]:0)/(i||1);if(!F.active&&!bt){if(o&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<o)return;this._onDragStart(e,!0)}if(q){s?(s.e+=p-(nn||0),s.f+=u-(an||0)):s={a:1,b:0,c:0,d:1,e:p,f:u};var h="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");P(q,"webkitTransform",h),P(q,"mozTransform",h),P(q,"msTransform",h),P(q,"transform",h),nn=p,an=u,Oe=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!q){var e=this.options.fallbackOnBody?document.body:Q,t=re(N,!0,vo,!0,e),o=this.options;if(vo){for(me=e;P(me,"position")==="static"&&P(me,"transform")==="none"&&me!==document;)me=me.parentNode;me!==document.body&&me!==document.documentElement?(me===document&&(me=Ge()),t.top+=me.scrollTop,t.left+=me.scrollLeft):me=Ge(),sn=qn(me)}q=N.cloneNode(!0),Le(q,o.ghostClass,!1),Le(q,o.fallbackClass,!0),Le(q,o.dragClass,!0),P(q,"transition",""),P(q,"transform",""),P(q,"box-sizing","border-box"),P(q,"margin",0),P(q,"top",t.top),P(q,"left",t.left),P(q,"width",t.width),P(q,"height",t.height),P(q,"opacity","0.8"),P(q,"position",vo?"absolute":"fixed"),P(q,"zIndex","100000"),P(q,"pointerEvents","none"),F.ghost=q,e.appendChild(q),P(q,"transform-origin",Hn/parseInt(q.style.width)*100+"% "+xn/parseInt(q.style.height)*100+"%")}},_onDragStart:function(e,t){var o=this,n=e.dataTransfer,a=o.options;if(ve("dragStart",this,{evt:e}),F.eventCanceled){this._onDrop();return}ve("setupClone",this),F.eventCanceled||(te=sa(N),te.removeAttribute("id"),te.draggable=!1,te.style["will-change"]="",this._hideClone(),Le(te,this.options.chosenClass,!1),F.clone=te),o.cloneId=Ro(function(){ve("clone",o),!F.eventCanceled&&(o.options.removeCloneOnHide||Q.insertBefore(te,N),o._hideClone(),be({sortable:o,name:"clone"}))}),!t&&Le(N,a.dragClass,!0),t?(Ao=!0,o._loopId=setInterval(o._emulateDragOver,50)):(U(document,"mouseup",o._onDrop),U(document,"touchend",o._onDrop),U(document,"touchcancel",o._onDrop),n&&(n.effectAllowed="move",a.setData&&a.setData.call(o,n,N)),$(document,"drop",o),P(N,"transform","translateZ(0)")),bt=!0,o._dragStartId=Ro(o._dragStarted.bind(o,t,e)),$(document,"selectstart",o),zt=!0,window.getSelection().removeAllRanges(),Bt&&P(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,o=e.target,n,a,s,r=this.options,i=r.group,d=F.active,p=bo===i,u=r.sort,h=ge||d,C,b=this,v=!1;if(mn)return;function G(Ft,Sa){ve(Ft,b,ze({evt:e,isOwner:p,axis:C?"vertical":"horizontal",revert:s,dragRect:n,targetRect:a,canSort:u,fromSortable:h,target:o,completed:V,onMove:function(On,va){return Co(Q,t,N,n,On,re(On),e,va)},changed:Y},Sa))}function A(){G("dragOverAnimationCapture"),b.captureAnimationState(),b!==h&&h.captureAnimationState()}function V(Ft){return G("dragOverCompleted",{insertion:Ft}),Ft&&(p?d._hideClone():d._showClone(b),b!==h&&(Le(N,ge?ge.options.ghostClass:d.options.ghostClass,!1),Le(N,r.ghostClass,!0)),ge!==b&&b!==F.active?ge=b:b===F.active&&ge&&(ge=null),h===b&&(b._ignoreWhileAnimating=o),b.animateAll(function(){G("dragOverAnimationComplete"),b._ignoreWhileAnimating=null}),b!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(o===N&&!N.animated||o===t&&!o.animated)&&(yt=null),!r.dragoverBubble&&!e.rootEl&&o!==document&&(N.parentNode[Ee]._isOutsideThisEl(e.target),!Ft&&at(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),v=!0}function Y(){Ne=ke(N),Ye=ke(N,r.draggable),be({sortable:b,name:"change",toEl:t,newIndex:Ne,newDraggableIndex:Ye,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),o=De(o,r.draggable,t,!0),G("dragOver"),F.eventCanceled)return v;if(N.contains(e.target)||o.animated&&o.animatingX&&o.animatingY||b._ignoreWhileAnimating===o)return V(!1);if(Ao=!1,d&&!r.disabled&&(p?u||(s=oe!==Q):ge===this||(this.lastPutMode=bo.checkPull(this,d,N,e))&&i.checkPut(this,d,N,e))){if(C=this._getDirection(e,o)==="vertical",n=re(N),G("dragOverValid"),F.eventCanceled)return v;if(s)return oe=Q,A(),this._hideClone(),G("revert"),F.eventCanceled||(rt?Q.insertBefore(N,rt):Q.appendChild(N)),V(!0);var X=Rn(t,r.draggable);if(!X||Ja(e,C,this)&&!X.animated){if(X===N)return V(!1);if(X&&t===e.target&&(o=X),o&&(a=re(o)),Co(Q,t,N,n,o,a,e,!!o)!==!1)return A(),X&&X.nextSibling?t.insertBefore(N,X.nextSibling):t.appendChild(N),oe=t,Y(),V(!0)}else if(X&&Xa(e,C,this)){var ue=At(t,0,r,!0);if(ue===N)return V(!1);if(o=ue,a=re(o),Co(Q,t,N,n,o,a,e,!1)!==!1)return A(),t.insertBefore(N,ue),oe=t,Y(),V(!0)}else if(o.parentNode===t){a=re(o);var ne=0,ce,Me=N.parentNode!==t,he=!$a(N.animated&&N.toRect||n,o.animated&&o.toRect||a,C),We=C?"top":"left",Ve=zn(o,"top","top")||zn(N,"top","top"),Dt=Ve?Ve.scrollTop:void 0;yt!==o&&(ce=a[We],Vt=!1,So=!he&&r.invertSwap||Me),ne=Ka(e,o,a,C,he?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,So,yt===o);var qe;if(ne!==0){var ot=ke(N);do ot-=ne,qe=oe.children[ot];while(qe&&(P(qe,"display")==="none"||qe===q))}if(ne===0||qe===o)return V(!1);yt=o,Wt=ne;var Pt=o.nextElementSibling,je=!1;je=ne===1;var mo=Co(Q,t,N,n,o,a,e,je);if(mo!==!1)return(mo===1||mo===-1)&&(je=mo===1),mn=!0,setTimeout(Ya,30),A(),je&&!Pt?t.appendChild(N):o.parentNode.insertBefore(N,je?Pt:o),Ve&&aa(Ve,0,Dt-Ve.scrollTop),oe=N.parentNode,ce!==void 0&&!So&&(ko=Math.abs(ce-re(o)[We])),Y(),V(!0)}if(t.contains(N))return V(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){U(document,"mousemove",this._onTouchMove),U(document,"touchmove",this._onTouchMove),U(document,"pointermove",this._onTouchMove),U(document,"dragover",at),U(document,"mousemove",at),U(document,"touchmove",at)},_offUpEvents:function(){var e=this.el.ownerDocument;U(e,"mouseup",this._onDrop),U(e,"touchend",this._onDrop),U(e,"pointerup",this._onDrop),U(e,"pointercancel",this._onDrop),U(e,"touchcancel",this._onDrop),U(document,"selectstart",this)},_onDrop:function(e){var t=this.el,o=this.options;if(Ne=ke(N),Ye=ke(N,o.draggable),ve("drop",this,{evt:e}),oe=N&&N.parentNode,Ne=ke(N),Ye=ke(N,o.draggable),F.eventCanceled){this._nulling();return}bt=!1,So=!1,Vt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),yn(this.cloneId),yn(this._dragStartId),this.nativeDraggable&&(U(document,"drop",this),U(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Bt&&P(document.body,"user-select",""),P(N,"transform",""),e&&(zt&&(e.cancelable&&e.preventDefault(),!o.dropBubble&&e.stopPropagation()),q&&q.parentNode&&q.parentNode.removeChild(q),(Q===oe||ge&&ge.lastPutMode!=="clone")&&te&&te.parentNode&&te.parentNode.removeChild(te),N&&(this.nativeDraggable&&U(N,"dragend",this),rn(N),N.style["will-change"]="",zt&&!bt&&Le(N,ge?ge.options.ghostClass:this.options.ghostClass,!1),Le(N,this.options.chosenClass,!1),be({sortable:this,name:"unchoose",toEl:oe,newIndex:null,newDraggableIndex:null,originalEvent:e}),Q!==oe?(Ne>=0&&(be({rootEl:oe,name:"add",toEl:oe,fromEl:Q,originalEvent:e}),be({sortable:this,name:"remove",toEl:oe,originalEvent:e}),be({rootEl:oe,name:"sort",toEl:oe,fromEl:Q,originalEvent:e}),be({sortable:this,name:"sort",toEl:oe,originalEvent:e})),ge&&ge.save()):Ne!==St&&Ne>=0&&(be({sortable:this,name:"update",toEl:oe,originalEvent:e}),be({sortable:this,name:"sort",toEl:oe,originalEvent:e})),F.active&&((Ne==null||Ne===-1)&&(Ne=St,Ye=$t),be({sortable:this,name:"end",toEl:oe,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){ve("nulling",this),Q=N=oe=q=rt=te=wo=Je=nt=Oe=zt=Ne=Ye=St=$t=yt=Wt=ge=bo=F.dragged=F.ghost=F.clone=F.active=null,Po.forEach(function(e){e.checked=!0}),Po.length=nn=an=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":N&&(this._onDragOver(e),ja(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,o=this.el.children,n=0,a=o.length,s=this.options;n<a;n++)t=o[n],De(t,s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||Qa(t));return e},sort:function(e,t){var o={},n=this.el;this.toArray().forEach(function(a,s){var r=n.children[s];De(r,this.options.draggable,n,!1)&&(o[a]=r)},this),t&&this.captureAnimationState(),e.forEach(function(a){o[a]&&(n.removeChild(o[a]),n.appendChild(o[a]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return De(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var o=this.options;if(t===void 0)return o[e];var n=ho.modifyOption(this,e,t);typeof n<"u"?o[e]=n:o[e]=t,e==="group"&&ca(o)},destroy:function(){ve("destroy",this);var e=this.el;e[Ee]=null,U(e,"mousedown",this._onTapStart),U(e,"touchstart",this._onTapStart),U(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(U(e,"dragover",this),U(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Do.splice(Do.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Je){if(ve("hideClone",this),F.eventCanceled)return;P(te,"display","none"),this.options.removeCloneOnHide&&te.parentNode&&te.parentNode.removeChild(te),Je=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Je){if(ve("showClone",this),F.eventCanceled)return;N.parentNode==Q&&!this.options.group.revertClone?Q.insertBefore(te,N):rt?Q.insertBefore(te,rt):Q.appendChild(te),this.options.group.revertClone&&this.animate(N,te),P(te,"display",""),Je=!1}}};function ja(l){l.dataTransfer&&(l.dataTransfer.dropEffect="move"),l.cancelable&&l.preventDefault()}function Co(l,e,t,o,n,a,s,r){var i,d=l[Ee],p=d.options.onMove,u;return window.CustomEvent&&!$e&&!po?i=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(i=document.createEvent("Event"),i.initEvent("move",!0,!0)),i.to=e,i.from=l,i.dragged=t,i.draggedRect=o,i.related=n||e,i.relatedRect=a||re(e),i.willInsertAfter=r,i.originalEvent=s,l.dispatchEvent(i),p&&(u=p.call(d,i,s)),u}function rn(l){l.draggable=!1}function Ya(){mn=!1}function Xa(l,e,t){var o=re(At(t.el,0,t.options,!0)),n=ra(t.el,t.options,q),a=10;return e?l.clientX<n.left-a||l.clientY<o.top&&l.clientX<o.right:l.clientY<n.top-a||l.clientY<o.bottom&&l.clientX<o.left}function Ja(l,e,t){var o=re(Rn(t.el,t.options.draggable)),n=ra(t.el,t.options,q),a=10;return e?l.clientX>n.right+a||l.clientY>o.bottom&&l.clientX>o.left:l.clientY>n.bottom+a||l.clientX>o.right&&l.clientY>o.top}function Ka(l,e,t,o,n,a,s,r){var i=o?l.clientY:l.clientX,d=o?t.height:t.width,p=o?t.top:t.left,u=o?t.bottom:t.right,h=!1;if(!s){if(r&&ko<d*n){if(!Vt&&(Wt===1?i>p+d*a/2:i<u-d*a/2)&&(Vt=!0),Vt)h=!0;else if(Wt===1?i<p+ko:i>u-ko)return-Wt}else if(i>p+d*(1-n)/2&&i<u-d*(1-n)/2)return Za(e)}return h=h||s,h&&(i<p+d*a/2||i>u-d*a/2)?i>p+d/2?1:-1:0}function Za(l){return ke(N)<ke(l)?1:-1}function Qa(l){for(var e=l.tagName+l.className+l.src+l.href+l.textContent,t=e.length,o=0;t--;)o+=e.charCodeAt(t);return o.toString(36)}function _a(l){Po.length=0;for(var e=l.getElementsByTagName("input"),t=e.length;t--;){var o=e[t];o.checked&&Po.push(o)}}function Ro(l){return setTimeout(l,0)}function yn(l){return clearTimeout(l)}Zo&&$(document,"touchmove",function(l){(F.active||bt)&&l.cancelable&&l.preventDefault()});F.utils={on:$,off:U,css:P,find:oa,is:function(e,t){return!!De(e,t,e,!1)},extend:Fa,throttle:na,closest:De,toggleClass:Le,clone:sa,index:ke,nextTick:Ro,cancelNextTick:yn,detectDirection:la,getChild:At,expando:Ee};F.get=function(l){return l[Ee]};F.mount=function(){for(var l=arguments.length,e=new Array(l),t=0;t<l;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(o){if(!o.prototype||!o.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(o));o.utils&&(F.utils=ze(ze({},F.utils),o.utils)),ho.mount(o)})};F.create=function(l,e){return new F(l,e)};F.version=Da;var se=[],qt,bn,Sn=!1,ln,cn,Fo,Ht;function es(){function l(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return l.prototype={dragStarted:function(t){var o=t.originalEvent;this.sortable.nativeDraggable?$(document,"dragover",this._handleAutoScroll):this.options.supportPointer?$(document,"pointermove",this._handleFallbackAutoScroll):o.touches?$(document,"touchmove",this._handleFallbackAutoScroll):$(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var o=t.originalEvent;!this.options.dragOverBubble&&!o.rootEl&&this._handleAutoScroll(o)},drop:function(){this.sortable.nativeDraggable?U(document,"dragover",this._handleAutoScroll):(U(document,"pointermove",this._handleFallbackAutoScroll),U(document,"touchmove",this._handleFallbackAutoScroll),U(document,"mousemove",this._handleFallbackAutoScroll)),Un(),Io(),Ga()},nulling:function(){Fo=bn=qt=Sn=Ht=ln=cn=null,se.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,o){var n=this,a=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,r=document.elementFromPoint(a,s);if(Fo=t,o||this.options.forceAutoScrollFallback||po||$e||Bt){dn(t,this.options,r,o);var i=tt(r,!0);Sn&&(!Ht||a!==ln||s!==cn)&&(Ht&&Un(),Ht=setInterval(function(){var d=tt(document.elementFromPoint(a,s),!0);d!==i&&(i=d,Io()),dn(t,n.options,d,o)},10),ln=a,cn=s)}else{if(!this.options.bubbleScroll||tt(r,!0)===Ge()){Io();return}dn(t,this.options,tt(r,!1),!1)}}},Ue(l,{pluginName:"scroll",initializeByDefault:!0})}function Io(){se.forEach(function(l){clearInterval(l.pid)}),se=[]}function Un(){clearInterval(Ht)}var dn=na(function(l,e,t,o){if(e.scroll){var n=(l.touches?l.touches[0]:l).clientX,a=(l.touches?l.touches[0]:l).clientY,s=e.scrollSensitivity,r=e.scrollSpeed,i=Ge(),d=!1,p;bn!==t&&(bn=t,Io(),qt=e.scroll,p=e.scrollFn,qt===!0&&(qt=tt(t,!0)));var u=0,h=qt;do{var C=h,b=re(C),v=b.top,G=b.bottom,A=b.left,V=b.right,Y=b.width,X=b.height,ue=void 0,ne=void 0,ce=C.scrollWidth,Me=C.scrollHeight,he=P(C),We=C.scrollLeft,Ve=C.scrollTop;C===i?(ue=Y<ce&&(he.overflowX==="auto"||he.overflowX==="scroll"||he.overflowX==="visible"),ne=X<Me&&(he.overflowY==="auto"||he.overflowY==="scroll"||he.overflowY==="visible")):(ue=Y<ce&&(he.overflowX==="auto"||he.overflowX==="scroll"),ne=X<Me&&(he.overflowY==="auto"||he.overflowY==="scroll"));var Dt=ue&&(Math.abs(V-n)<=s&&We+Y<ce)-(Math.abs(A-n)<=s&&!!We),qe=ne&&(Math.abs(G-a)<=s&&Ve+X<Me)-(Math.abs(v-a)<=s&&!!Ve);if(!se[u])for(var ot=0;ot<=u;ot++)se[ot]||(se[ot]={});(se[u].vx!=Dt||se[u].vy!=qe||se[u].el!==C)&&(se[u].el=C,se[u].vx=Dt,se[u].vy=qe,clearInterval(se[u].pid),(Dt!=0||qe!=0)&&(d=!0,se[u].pid=setInterval((function(){o&&this.layer===0&&F.active._onTouchMove(Fo);var Pt=se[this.layer].vy?se[this.layer].vy*r:0,je=se[this.layer].vx?se[this.layer].vx*r:0;typeof p=="function"&&p.call(F.dragged.parentNode[Ee],je,Pt,l,Fo,se[this.layer].el)!=="continue"||aa(se[this.layer].el,je,Pt)}).bind({layer:u}),24))),u++}while(e.bubbleScroll&&h!==i&&(h=tt(h,!1)));Sn=d}},30),ga=function(e){var t=e.originalEvent,o=e.putSortable,n=e.dragEl,a=e.activeSortable,s=e.dispatchSortableEvent,r=e.hideGhostForTarget,i=e.unhideGhostForTarget;if(t){var d=o||a;r();var p=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,u=document.elementFromPoint(p.clientX,p.clientY);i(),d&&!d.el.contains(u)&&(s("spill"),this.onSpill({dragEl:n,putSortable:o}))}};function In(){}In.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,o=e.putSortable;this.sortable.captureAnimationState(),o&&o.captureAnimationState();var n=At(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(t,n):this.sortable.el.appendChild(t),this.sortable.animateAll(),o&&o.animateAll()},drop:ga};Ue(In,{pluginName:"revertOnSpill"});function Mn(){}Mn.prototype={onSpill:function(e){var t=e.dragEl,o=e.putSortable,n=o||this.sortable;n.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),n.animateAll()},drop:ga};Ue(Mn,{pluginName:"removeOnSpill"});F.mount(new es);F.mount(Mn,In);const un="root";var _e,le,Xo,Jo,fa;const M=class M{static init(){if(M.noFolderView()||!ui.scenes||!game.user.isGM)return;M.preloadTemplates(),game.user.getFlag(H,"activeSceneFolders")||game.user.setFlag(H,"activeSceneFolders",[]);const e=document.querySelector("#scene-navigation-inactive");((e==null?void 0:e.querySelectorAll("li.folder"))||[]).forEach(o=>{o.remove()}),Hooks.on(D.RENDER_SCENE_DIRECTORY,(o,n)=>{var a;B(a=M,Jo,fa).call(a)})}static addFolderButtons(e,t,o){if(!z.useSceneFolders||game.scenes.size<2||game.scenes.folders.size<1)return;const n=k();if(document.querySelector("#crlngn-folder-toggle"))return;const s=t.querySelector("#scene-navigation-active");s==null||s.querySelector("li.scene");const r=`CRLNGN_UI.ui.sceneNav.${z.navShowRootFolders?"hideSceneFoldersTooltip":"showSceneFoldersTooltip"}`,i=document.createElement("div");i.dataset.tooltip=game.i18n.localize(r),i.id="crlngn-folder-toggle",i.innerHTML="<i class='fa-solid icon'></i>",i.addEventListener("click",()=>{z.setNavPosition(0);const d=!z.navShowRootFolders;L.set(n.navShowRootFolders.tag,d),z.placeNavButtons()}),s==null||s.append(i),z.navShowRootFolders?s==null||s.classList.add("with-folders"):s==null||s.classList.remove("with-folders")}static toggleFolderLookup(e){const t=e.target.parentNode;t.classList.contains("open")?t.classList.remove("open"):t.classList.add("open")}static buildTemplateData(e){if(!e||!ui.scenes)return{};const t=ui.scenes.collection.folders;let o={},n=[],a=e.contents?[...e.contents]:[];return a=a.filter(s=>s.permission>=2),I(M,_e,game.scenes.sortingMode),g.log("buildFolderData A",[e.name,e]),e.id===un?n=t.filter(s=>s.folder===null)||[]:n=e.children,n=M.sortFolderList(n),o={currentFolder:e,folders:n,scenes:a},g.log("buildFolderData",[n,o]),o}static sortFolderList(e){return e=e.map((t,o)=>t.folder?t.folder:t),m(M,_e)==="a"?e.sort((t,o)=>t.name.toLowerCase().localeCompare(o.name.toLowerCase())):e.sort((t,o)=>t.sort-o.sort),e}};_e=new WeakMap,le=new WeakMap,Xo=new WeakMap,Jo=new WeakSet,fa=function(){try{if(game.scenes&&game.scenes.sortingMode!==void 0){I(M,_e,game.scenes.sortingMode);return}}catch(e){console.error("Error checking scene directory sort mode:",e)}I(M,_e,"a"),g.log("updateSortMode fallback",[m(M,_e)])},R(M,Jo),y(M,"selectedFolder",un),R(M,_e,"a"),R(M,le,[]),y(M,"searchValue",""),y(M,"renderFolderList",async e=>{I(M,le,game.user.getFlag(H,"activeSceneFolders")||[]);let t;const o=ui.scenes.collection.folders,n=e?o.get(e.dataset.folderId):{name:"",id:un},a=M.buildTemplateData(n),s=await w.renderTemplate(`modules/${H}/templates/scene-nav-folders.hbs`,a);e?t=e.parentNode:t=document.querySelector("#scene-navigation-inactive"),t.insertAdjacentHTML("afterbegin",s);const r=t.querySelectorAll("li.folder");M.addFolderListeners(r),z.placeNavButtons()}),y(M,"handleFolderLookup",async()=>{const e=await w.renderTemplate(`modules/${H}/templates/scene-nav-lookup.hbs`,{}),t=document.querySelector("#crlngn-lookup-list");t&&t.remove();const o=document.querySelector("#crlngn-scene-lookup");o.insertAdjacentHTML("beforeend",e);const n=o.querySelector(".search-container .input-scene-search");n.addEventListener("keyup",M.onSearchInput),n.addEventListener("keydown",s=>{s.stopPropagation()});const a=o==null?void 0:o.querySelector(".scene-lookup-toggle");a&&a.addEventListener("click",M.toggleFolderLookup)}),y(M,"addFolderListeners",e=>{const t=ui.scenes.collection.folders;e&&e.forEach(o=>{o.querySelector(".folder-item").addEventListener("click",m(M,Xo));const n=o.dataset.folderId,a=t.get(n),s=m(M,le).includes(n);g.log("addFolderListeners isActive",[s,n,a.name]),s&&(o.classList.add("crlngn-folder-active"),M.injectSubfolders(a,o))})}),R(M,Xo,async e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.offsetLeft,t.parentNode.parentNode.querySelectorAll(".crlngn-folder-active");const o=t.dataset.folderId||t.parentNode.dataset.folderId,n=ui.scenes.collection.folders,a=o?n.get(o):null;if(!a)return;await M.injectSubfolders(a,t.parentNode),z.addSceneListeners(t.parentNode),g.log("onNavFolderClick",[t,t.parentNode,t.parentNode.dataset]),t.classList.contains("crlngn-folder-active")||t.parentNode.classList.contains("crlngn-folder-active")?M.updateActiveFolders(o,!0):M.updateActiveFolders(o,!1)}),y(M,"injectSubfolders",async(e,t)=>{const o=M.buildTemplateData(e),n=await w.renderTemplate(`modules/${H}/templates/scene-nav-subfolders.hbs`,o),a=t.querySelector(".contents");a&&a.remove(),t.insertAdjacentHTML("beforeend",n);const s=t.querySelectorAll("li.folder");M.addFolderListeners(s),z.addSceneListeners(t.querySelector(".contents")),setTimeout(()=>z.applySceneNavOffset(),100)}),y(M,"updateActiveFolders",async(e,t=!1)=>{const o=document.querySelector("#scene-navigation-inactive"),n=o==null?void 0:o.querySelector(`li.folder[data-folder-id="${e}"]`),a=m(M,le).indexOf(e);g.log("updateActiveFolders A",[a,e,game.user.getFlag(H,"activeSceneFolders"),m(M,le)]),t?(I(M,le,m(M,le).filter(s=>s!==e)),n.classList.remove("crlngn-folder-active")):m(M,le).includes(e)||(n.parentNode.querySelectorAll("li.folder").forEach(r=>{r!==n&&(I(M,le,m(M,le).filter(i=>i!==r.dataset.folderId)),r.classList.remove("crlngn-folder-active"))}),m(M,le).push(e),n.classList.add("crlngn-folder-active")),await game.user.setFlag(H,"activeSceneFolders",m(M,le)),g.log("updateActiveFolders B",[t,e,game.user.getFlag(H,"activeSceneFolders"),m(M,le)]),setTimeout(()=>z.applySceneNavOffset(),100)}),y(M,"selectFolder",e=>M.getFolderById(e)||null),y(M,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!z.navFoldersForPlayers||!z.useSceneFolders||!z.sceneNavEnabled}),y(M,"preloadTemplates",async()=>{const e=[`modules/${H}/templates/scene-nav-folders.hbs`,`modules/${H}/templates/scene-nav-subfolders.hbs`,`modules/${H}/templates/scene-nav-lookup.hbs`];return await w.loadTemplates(e),!0}),y(M,"onSearchInput",e=>{e.stopPropagation();const o=e.currentTarget.value;M.searchValue=o,M.updateSearchResults(o)}),y(M,"updateSearchResults",e=>{var a,s;if(!z.useSceneLookup)return;const t=document.querySelector("#crlngn-scene-lookup .search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const o=((a=game.scenes)==null?void 0:a.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())&&r.permission>=2))||[];o.sort((r,i)=>r.name.toLowerCase().localeCompare(i.name.toLowerCase()));let n=[];if(z.useSceneFolders&&(n=((s=game.scenes)==null?void 0:s.folders.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())))||[],n.sort((r,i)=>r.name.toLowerCase().localeCompare(i.name.toLowerCase())),n.forEach(r=>{const i=document.createElement("li");i.className="search-folder",i.dataset.folderId=r.id,i.innerHTML=`<a><i class="fas fa-folder"></i> ${r.name}</a>`,i.addEventListener("click",M.onSelectSearchedFolder),t.appendChild(i)})),t.classList.remove("hidden"),o.forEach(r=>{const i=document.createElement("li");i.className="search-scene",i.dataset.sceneId=r.id,i.innerHTML=`<a><i class="fas fa-map"></i> ${r.name}</a>`,i.addEventListener("dblclick",z.onActivateScene),i.addEventListener("click",z.onSelectScene),t.appendChild(i)}),n.length===0&&o.length===0){const r=document.createElement("li");r.className="no-results",r.textContent="No matching results found",t.appendChild(r)}}),y(M,"onSelectSearchedFolder",async e=>{e.stopPropagation(),e.preventDefault();const o=e.currentTarget.dataset.folderId,n=document.querySelector("#crlngn-folder-toggle");if(z.navShowRootFolders||n.click(),!o)return;const r=[...ui.scenes.collection.folders.get(o).ancestors];I(M,le,[]);for(const i of r)m(M,le).push(i.id);m(M,le).push(o),await game.user.setFlag(H,"activeSceneFolders",m(M,le)),setTimeout(async()=>{ui.nav.render()},200)});let it=M;var ie,pa,ha,ma,ya,ba,xt,vn;const j=class j{static init(){const e=k();g.log("SheetsUtil.init",[]),!(game.system.id!=="dnd5e"&&game.system.id!=="daggerheart")&&(j.themeStylesEnabled=L.get(e.applyThemeToSheets.tag),j.horizontalSheetTabsEnabled=L.get(e.useHorizontalSheetTabs.tag),Hooks.on(D.RENDER_ACTOR_SHEET,B(j,ie,pa)),Hooks.on(D.RENDER_COMPENDIUM_BROWSER,B(j,ie,ha)),Hooks.on(D.RENDER_ADVANCEMENT_MANAGER,B(j,ie,ma)),Hooks.on(D.UPDATE_SETTING,B(j,ie,ya)))}static applyThemeToSheets(e){var t,o;j.themeStylesEnabled=e,e?(document.body.classList.add("crlngn-sheets"),j.horizontalSheetTabsEnabled&&(document.body.classList.add("crlngn-sheet-tabs"),B(t=j,ie,xt).call(t))):(document.body.classList.remove("crlngn-sheets"),document.body.classList.remove("crlngn-sheet-tabs"),j.horizontalSheetTabsEnabled=!1,B(o=j,ie,vn).call(o))}static applyHorizontalSheetTabs(e){var t,o;j.horizontalSheetTabsEnabled=e,j.horizontalSheetTabsEnabled&&j.themeStylesEnabled?(document.body.classList.add("crlngn-sheet-tabs"),B(t=j,ie,xt).call(t)):(document.body.classList.remove("crlngn-sheet-tabs"),B(o=j,ie,vn).call(o))}};ie=new WeakSet,pa=function(e,t,o){var a;g.log(D.RENDER_ACTOR_SHEET,[e,t.querySelector(".sheet-body"),o]),(a=t.querySelector(".sheet-body .main-content"))==null||a.addEventListener("scroll",B(j,ie,ba));const n=t.querySelectorAll("nav.tabs > a.item");for(const s of n)s.removeAttribute("data-tooltip"),s.removeAttribute("data-tooltip-delay");j.applyThemeToSheets(j.themeStylesEnabled),j.applyHorizontalSheetTabs(j.horizontalSheetTabsEnabled),j.horizontalSheetTabsEnabled&&setTimeout(()=>{var s;B(s=j,ie,xt).call(s)},100)},ha=function(e,t,o){g.log(D.RENDER_COMPENDIUM_BROWSER,[e,t,o]),j.horizontalSheetTabsEnabled&&setTimeout(()=>{var n;B(n=j,ie,xt).call(n)},100)},ma=function(e,t,o){var s;const n=game.settings.get("core","uiConfig"),a=(s=n==null?void 0:n.colorScheme)==null?void 0:s.applications;g.log(D.RENDER_ADVANCEMENT_MANAGER,[e,t,o,n==null?void 0:n.colorScheme]),a==="dark"&&(t.classList.add("theme-dark"),t.classList.remove("theme-light"))},ya=function(e,t,o,n){var a;if(e.key==="core.uiConfig"){g.log(D.UPDATE_SETTING,["core.uiConfig changed",t]);const s=(a=t==null?void 0:t.colorScheme)==null?void 0:a.applications;document.querySelectorAll(".advancement-manager").forEach(i=>{s==="dark"?(i.classList.add("theme-dark"),i.classList.remove("theme-light")):(i.classList.remove("theme-dark"),i.classList.add("theme-light"))})}},ba=function(e){const t=e.target.closest(".window-content"),o=t==null?void 0:t.querySelector(".ability-scores");o&&(e.target.scrollTop>30?o.classList.add("fadeout"):o.classList.remove("fadeout"))},xt=function(){document.querySelectorAll(".dnd5e2.vertical-tabs nav.tabs").forEach(t=>{const o=t.parentElement;if(o.querySelector(".crlngn-tab-scroll-btn"))return;const n=document.createElement("div");n.className="crlngn-tab-scroll-wrapper";const a=document.createElement("button");a.className="crlngn-tab-scroll-btn crlngn-tab-scroll-prev",a.innerHTML='<i class="fas fa-caret-left"></i>',a.addEventListener("click",d=>{d.preventDefault(),t.scrollBy({left:-150,behavior:"smooth"})});const s=document.createElement("button");s.className="crlngn-tab-scroll-btn crlngn-tab-scroll-next",s.innerHTML='<i class="fas fa-caret-right"></i>',s.addEventListener("click",d=>{d.preventDefault(),t.scrollBy({left:150,behavior:"smooth"})}),o.insertBefore(n,t),n.appendChild(a),n.appendChild(t),n.appendChild(s);const r=()=>{t.scrollWidth>t.clientWidth?(a.classList.remove("hidden"),s.classList.remove("hidden")):(a.classList.add("hidden"),s.classList.add("hidden"))};setTimeout(r,150);const i=new ResizeObserver(r);i.observe(t),n._resizeObserver=i})},vn=function(){document.querySelectorAll(".crlngn-tab-scroll-wrapper").forEach(t=>{t._resizeObserver&&(t._resizeObserver.disconnect(),delete t._resizeObserver);const o=t.querySelector("nav.tabs");o&&t.parentElement&&(t.parentElement.insertBefore(o,t),t.remove())})},R(j,ie),y(j,"themeStylesEnabled",!0),y(j,"horizontalSheetTabsEnabled",!0);let lt=j;var we,ht;const E=class E{static init(){Hooks.on(D.RENDER_SIDE_BAR,E.onRender),Hooks.once(D.READY,E.onReady)}static applyFadeOut(e){E.useFadeOut=e,E.handleFadeOut()}static applyHide(e){E.hidden=e,E.handleHide()}static handleHide(e,t,o){var a;const n=t?t.querySelector("#sidebar-tabs"):document.querySelector("#sidebar-tabs");E.hidden?(a=game.user)!=null&&a.isGM||n==null||n.classList.add("hidden-ui"):n==null||n.classList.remove("hidden-ui"),g.log("handle Hide",[E.hidden])}static applyCustomStyle(e){var t;E.customStylesEnabled=e,g.log("applyCustomStyle",[E.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static applyFolderStyles(e){E.folderStylesEnabled=e,E.folderStylesEnabled?document.querySelector("body").classList.add("crlngn-folder-style"):document.querySelector("body").classList.remove("crlngn-folder-style"),g.log("applyFolderStyles",[E.folderStylesEnabled])}static onRender(e,t,o){var n,a;E.handleClassApplication(),E.handleFadeOut(e,t,o),E.handleHide(e,t,o),E.applyFolderStyles(E.folderStylesEnabled),E.useHorizontalSidebarTabs&&E.debouncedUpdateArrows(),E.showChatNotificationsOnTop&&E.applyShowChatNotificationsOnTop(E.showChatNotificationsOnTop),g.log("SidebarTabs onRender",[(a=(n=foundry.applications)==null?void 0:n.sidebar)==null?void 0:a.tabs])}static handleClassApplication(){E.customStylesEnabled?document.querySelector("body").classList.add("crlngn-tabs"):document.querySelector("body").classList.remove("crlngn-tabs")}static handleFadeOut(e,t,o){const n=t?t.querySelector("#sidebar-tabs"):document.querySelector("#sidebar-tabs");E.useFadeOut?n==null||n.classList.add("faded-ui"):n==null||n.classList.remove("faded-ui"),g.log("SidebarTabs handle fade out",[E.useFadeOut])}};we=new WeakMap,ht=new WeakMap,y(E,"useFadeOut",!0),y(E,"hidden",!1),y(E,"customStylesEnabled",!0),y(E,"folderStylesEnabled",!0),y(E,"openChatLogOnLoad",!1),y(E,"closeSidebarWhenIdle",!1),y(E,"useHorizontalSidebarTabs",!1),y(E,"showChatNotificationsOnTop",!1),R(E,we,null),R(E,ht,null),y(E,"applySideBarWidth",()=>{const e=k(),t=L.get(e.sideBarWidth.tag)||300;w.addCSSVars("--sidebar-width",`${t}px`),E.useHorizontalSidebarTabs&&E.debouncedUpdateArrows()}),y(E,"onReady",()=>{const e=k();E.openChatLogOnLoad=L.get(e.openChatLogOnLoad.tag),E.closeSidebarWhenIdle=L.get(e.closeSidebarWhenIdle.tag),E.openChatLogOnLoad&&setTimeout(()=>{ui.sidebar&&!ui.sidebar.expanded&&ui.sidebar.expand()},2e3),E.closeSidebarWhenIdle&&E.setupIdleClose()}),y(E,"applyOpenChatLogOnLoad",e=>{E.openChatLogOnLoad=e,g.log("applyOpenChatLogOnLoad",[E.openChatLogOnLoad])}),y(E,"applyCloseSidebarWhenIdle",e=>{E.closeSidebarWhenIdle=e,e?E.setupIdleClose():E.removeIdleClose(),g.log("applyCloseSidebarWhenIdle",[E.closeSidebarWhenIdle])}),y(E,"setupIdleClose",()=>{const e=document.querySelector("#sidebar");e&&(E.removeIdleClose(),e.addEventListener("mouseout",E.handleMouseOut),e.addEventListener("mouseenter",E.handleMouseEnter))}),y(E,"removeIdleClose",()=>{const e=document.querySelector("#sidebar");e&&(e.removeEventListener("mouseout",E.handleMouseOut),e.removeEventListener("mouseenter",E.handleMouseEnter),m(E,we)&&(clearTimeout(m(E,we)),I(E,we,null)))}),y(E,"handleMouseEnter",()=>{m(E,we)&&(clearTimeout(m(E,we)),I(E,we,null))}),y(E,"handleMouseOut",e=>{(!e.relatedTarget||!e.currentTarget.contains(e.relatedTarget))&&(m(E,we)&&clearTimeout(m(E,we)),I(E,we,setTimeout(()=>{ui.sidebar&&ui.sidebar.expanded&&ui.sidebar.collapse(),I(E,we,null)},3e3)))}),y(E,"applyHorizontalSidebarTabs",e=>{E.useHorizontalSidebarTabs=e;const t=document.querySelector("body.crlngn-ui");e?(t==null||t.classList.add("crlngn-horiz-sidebar-tabs"),E.debouncedUpdateArrows()):(t==null||t.classList.remove("crlngn-horiz-sidebar-tabs"),E.removeHorizontalTabsArrows()),g.log("applyHorizontalSidebarTabs",[E.useHorizontalSidebarTabs])}),y(E,"applyShowChatNotificationsOnTop",e=>{E.showChatNotificationsOnTop=e;const t=document.querySelector("#chat-notifications");e?t==null||t.classList.add("messages-on-top"):t==null||t.classList.remove("messages-on-top"),g.log("applyShowChatNotificationsOnTop",[E.showChatNotificationsOnTop])}),y(E,"debouncedUpdateArrows",()=>{m(E,ht)&&clearTimeout(m(E,ht)),I(E,ht,setTimeout(()=>{E.updateHorizontalTabsArrows(),I(E,ht,null)},100))}),y(E,"updateHorizontalTabsArrows",()=>{if(!E.useHorizontalSidebarTabs)return;const e=document.querySelector("#sidebar-tabs"),t=e==null?void 0:e.querySelector("menu");if(!e||!t)return;const o=t.scrollWidth,n=t.clientWidth,a=o>n;g.log("updateHorizontalTabsArrows",{scrollWidth:o,clientWidth:n,hasOverflow:a}),a?E.addHorizontalTabsArrows():E.removeHorizontalTabsArrows()}),y(E,"addHorizontalTabsArrows",()=>{const e=document.querySelector("#sidebar-tabs");if(!e||e.querySelector(".crlngn-tab-arrow"))return;const t=e.querySelector("menu");if(!t)return;const o=document.createElement("button");o.className="crlngn-tab-arrow crlngn-tab-arrow-left",o.innerHTML='<i class="fas fa-caret-left"></i>',o.type="button",o.addEventListener("click",()=>{t.scrollBy({left:-100,behavior:"smooth"})});const n=document.createElement("button");n.className="crlngn-tab-arrow crlngn-tab-arrow-right",n.innerHTML='<i class="fas fa-caret-right"></i>',n.type="button",n.addEventListener("click",()=>{t.scrollBy({left:100,behavior:"smooth"})}),e.insertBefore(o,t),t.parentNode.insertBefore(n,t.nextSibling),g.log("addHorizontalTabsArrows","Arrows added")}),y(E,"removeHorizontalTabsArrows",()=>{document.querySelectorAll(".crlngn-tab-arrow").forEach(t=>t.remove()),g.log("removeHorizontalTabsArrows","Arrows removed")});let Se=E;var It;const S=class S{static get(e,t=H){if(!e)return null;let o=!1;if(t===H)o=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),o=a==null?void 0:a.value,g.log("GET Setting",[a,o])}return o}static set(e,t,o=H){var s;if(!e)return!1;let n=game.settings.storage.get("client")[`${o}.${e}`],a=!!n;n||(n=game.settings.storage.get("world").getSetting(`${o}.${e}`)),g.log("Setting",[e,n,t]);try{game.settings.set(o,e,t)}catch(r){(!a||!((s=r.message)!=null&&s.includes("lacks permission")))&&g.log("Unable to change setting",[e,n,r.message])}return!0}static apply(e,t=void 0){var n,a,s,r,i,d,p,u,h,C,b,v,G,A;const o=k();switch(t===void 0&&(t=S.get(e)),g.log("SettingsUtil.apply",[e,t,S.get(e)]),e){case o.disableUI.tag:location.reload();break;case o.enableMacroLayout.tag:Pe.applyCustomStyle(t);break;case o.collapseMacroBar.tag:Pe.applyHotBarCollapse();break;case o.playerListAvatars.tag:Ie.applyAvatars();break;case o.autoHidePlayerList.tag:Ie.applyPlayersListSettings();break;case o.uiFontBody.tag:case o.uiFontTitles.tag:case o.journalFontBody.tag:case o.journalFontTitles.tag:S.applyCustomFonts(e,t);break;case o.controlsAutoHide.tag:S.applyLeftControlsSettings(e,t);break;case o.dockHeight.tag:de.currSettings.dockHeight=t,S.applyCameraHeight(t);break;case o.dockWidth.tag:de.currSettings.dockWidth=t,S.applyCameraWidth(t);break;case o.dockPosX.tag:de.currSettings.dockPosX=t,S.applyCameraPosX(t);break;case o.dockPosY.tag:de.currSettings.dockPosY=t,S.applyCameraPosY(t);break;case o.defaultVideoWidth.tag:de.currSettings.defaultVideoWidth=t,de.applyVideoWidth(t);break;case o.dockResizeOnUserJoin.tag:de.currSettings.dockResizeOnUserJoin=t,de.applyDockResize(t);break;case o.chatBorderColor.tag:et.chatBorderColor=t,S.applyBorderColors();break;case o.chatBorderPosition.tag:et.chatBorderPosition=t,S.applyBorderColors();break;case o.sideBarWidth.tag:z.sideBarWidth=t,Se.applySideBarWidth();break;case o.useLeftChatBorder.tag:et.useLeftChatBorder=t;case o.enableChatStyles.tag:et.enableChatStyles=t,S.applyChatStyles();break;case o.debugMode.tag:S.applyDebugSettings();break;case o.useSceneFolders.tag:z.useSceneFolders=t,(n=ui.nav)==null||n.render();break;case o.navShowRootFolders.tag:z.navShowRootFolders=t,(a=ui.nav)==null||a.render();break;case o.hideInactiveOnFolderToggle.tag:z.hideInactiveOnFolderToggle=t,(s=ui.nav)==null||s.render();break;case o.sceneClickToView.tag:z.sceneClickToView=t,(r=ui.nav)==null||r.render(),(d=(i=game.scenes)==null?void 0:i.directory)==null||d.render();break;case o.useSceneIcons.tag:z.useSceneIcons=t,(p=ui.nav)==null||p.render(),(h=(u=game.scenes)==null?void 0:u.directory)==null||h.render();break;case o.useSceneBackButton.tag:z.useSceneBackButton=t,(C=ui.nav)==null||C.render();break;case o.useSceneLookup.tag:z.useSceneLookup=t,(b=ui.nav)==null||b.render();break;case o.useScenePreview.tag:z.useScenePreview=t,(v=ui.nav)==null||v.render();break;case o.sceneItemWidth.tag:z.sceneItemWidth=t,z.applySceneItemWidth();break;case o.navStartCollapsed.tag:z.navStartCollapsed=t,(G=ui.nav)==null||G.render();break;case o.showNavOnHover.tag:z.showNavOnHover=t;break;case o.sceneNavCollapsed.tag:z.isCollapsed=S.get(o.sceneNavCollapsed.tag);break;case o.colorTheme.tag:S.applyThemeSettings();break;case o.playerColorTheme.tag:S.applyThemeSettings();break;case o.customThemeColors.tag:S.applyThemeSettings();break;case o.playerCustomThemeColors.tag:S.applyThemeSettings();break;case o.customStyles.tag:S.applyCustomCSS(t);break;case o.forcedDarkTheme.tag:S.applyForcedDarkTheme(t);break;case o.adjustOtherModules.tag:S.applyModuleAdjustments(t);break;case o.applyDarkThemeToModules.tag:S.applyDarkThemeToModules(t);break;case o.otherModulesList.tag:S.applyOtherModulesList(t);break;case o.enablePlayerList.tag:Ie.applyCustomStyle(t);break;case o.sceneNavEnabled.tag:z.applyTopNavHeight(),z.applyCustomStyle(t);break;case o.enableMacroLayout.tag:Pe.applyCustomStyle(t);break;case o.enableFloatingDock.tag:de.applyCustomStyle(t);break;case o.enableSidebarTabs.tag:Se.applyCustomStyle(t);break;case o.enableChatLogControls.tag:Tt.applyCustomStyle(t);break;case o.enableSceneControls.tag:Ct.applyCustomStyle(t);break;case o.sceneControlsFadeOut.tag:Ct.applyFadeOut(t);break;case o.playerListFadeOut.tag:Ie.applyFadeOut(t);break;case o.sidebarTabsFadeOut.tag:Se.applyFadeOut(t);break;case o.cameraDockFadeOut.tag:de.applyFadeOut(t);break;case o.macroHotbarFadeOut.tag:Pe.applyFadeOut(t);break;case o.chatLogControlsFadeOut.tag:Tt.applyFadeOut(t);break;case o.sceneNavFadeOut.tag:z.applyFadeOut(t);break;case o.sceneControlsHide.tag:Ct.applyHide(t);break;case o.playerListHide.tag:Ie.applyHide(t);break;case o.sidebarTabsHide.tag:Se.applyHide(t);break;case o.cameraDockHide.tag:de.applyHide(t);break;case o.macroHotbarHide.tag:Pe.applyHide(t);break;case o.chatLogControlsHide.tag:Tt.applyHide(t);break;case o.sceneNavHide.tag:z.applyHide(t);break;case o.useFolderStyle.tag:Se.applyFolderStyles(t);break;case o.openChatLogOnLoad.tag:Se.applyOpenChatLogOnLoad(t);break;case o.closeSidebarWhenIdle.tag:Se.applyCloseSidebarWhenIdle(t);break;case o.useHorizontalSidebarTabs.tag:Se.applyHorizontalSidebarTabs(t);break;case o.showChatNotificationsOnTop.tag:Se.applyShowChatNotificationsOnTop(t);break;case o.applyThemeToSheets.tag:lt.applyThemeToSheets(t);break;case o.useHorizontalSheetTabs.tag:lt.applyHorizontalSheetTabs(t);break;case o.useGlassEffect.tag:S.applyGlassEffect(t);break;case o.glassTranslucence.tag:S.applyTranslucence(t);break;case o.enforceGMSettings.tag:t&&((A=game.user)!=null&&A.isGM)&&(S.saveDefaultSettings(),ui.notifications.info("Current settings saved as defaults for players"));break;case o.hideLoadingSceneName.tag:S.applyHideLoadingSceneName(t);break}}static applyBorderColors(){const e=k(),t=S.get(e.chatBorderColor.tag),o=document.querySelector("body");t===Mt.playerColor.name?(o.classList.add("player-chat-borders"),o.classList.remove("roll-chat-borders")):t===Mt.rollType.name?(o.classList.add("roll-chat-borders"),o.classList.remove("player-chat-borders")):(o.classList.remove("player-chat-borders"),o.classList.remove("roll-chat-borders"))}static applyHideLoadingSceneName(e){const t=document.querySelector("body");e?t.classList.add("hide-scene-name"):t.classList.remove("hide-scene-name")}static applyGlassEffect(e){const t=document.querySelector("body"),o=k();if(e){t.classList.add("crlngn-glass-effect");const n=S.get(o.glassTranslucence.tag);S.applyTranslucence(n)}else t.classList.remove("crlngn-glass-effect"),w.addCSSVars("--background-blur","0px"),w.addCSSVars("--background-opacity","0.98");g.log("applyGlassEffect",[e])}static applyTranslucence(e){const t=1-e*.3,o=10+e*20;w.addCSSVars("--background-opacity",t.toFixed(2)),w.addCSSVars("--background-blur",`${o.toFixed(1)}px`),g.log("applyTranslucence",[e,{opacity:t,blur:`${o}px`}])}static applyChatStyles(){const e=k(),t=S.get(e.enableChatStyles.tag),o=document.querySelector("body");g.log("applyChatStyles",[t,e]),t?o.classList.add("crlngn-chat"):o.classList.remove("crlngn-chat")}static applyLeftControlsSettings(e,t){const o=k();S.get(o.sceneNavEnabled.tag);const n=document.querySelector("#ui-left");if(document.querySelector("body.crlngn-ui"),document.querySelector("#crlngn-ui-vars"),g.log("applyLeftControlsSettings",[e]),!n){g.log("applyLeftControlsSettings - no controls found (stream mode?)");return}switch(e){case o.controlsAutoHide.tag:S.get(o.controlsAutoHide.tag)?n.classList.add("auto-hide"):n.classList.remove("auto-hide");break}}static applyControlIconSize(){const e=k(),t=S.get(e.controlsIconSize.tag);document.querySelector("body");const o=Gt[t]?Gt[t].size:Gt.regular.size;function n(a){switch(a){case Gt.large.name:return"var(--font-size-18);";case Gt.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}g.log("applyControlIconSize",[o]),w.addCSSVars("--icon-font-size",n(t)),w.addCSSVars("--control-item-size",o),S.applyLeftControlsSettings()}static applySceneNavPos(e){const t=k();z.navPos=e||S.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=k(),o=S.get(t.dockPosX.tag),n=e||o;de.resetPositionAndSize({x:n})}static applyCameraPosY(e){const t=k(),o=S.get(t.dockPosY.tag),n=e||o;de.resetPositionAndSize({y:n})}static applyCameraWidth(e){const t=k(),o=S.get(t.dockWidth.tag),n=e||o;de.resetPositionAndSize({w:n})}static applyCameraHeight(e){const t=k(),o=S.get(t.dockHeight.tag),n=e||o;de.resetPositionAndSize({h:n})}static applyCustomFonts(e,t){const o=k(),n=o.customFontsMenu.fields,a={};switch(g.log("applyCustomFonts",[e,t]),n.forEach(s=>{a[s]=S.get(o[s].tag)}),document.querySelector("body.crlngn-ui"),e){case o.uiFontBody.tag:w.addCSSVars("--crlngn-font-family",t||a.uiFontBody||"");break;case o.uiFontTitles.tag:w.addCSSVars("--crlngn-font-titles",t||a.uiFontTitles||"");break;case o.journalFontBody.tag:w.addCSSVars("--crlngn-font-journal-body",t||a.journalFontBody||"");break;case o.journalFontTitles.tag:w.addCSSVars("--crlngn-font-journal-title",t||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){}static applyDebugSettings(e){const t=k();g.debugOn=e||S.get(t.debugMode.tag)}static enforceGMSettings(){var s,r;const e=k(),t=w.isModuleOn("force-client-settings"),o=S.get(e.enforceGMSettings.tag);if(t&&o&&((s=game.user)!=null&&s.isGM)){ui.notifications.warn(game.i18n.localize("CRLNGN_UI.settings.enforceGMSettings.conflictWarning"),{permanent:!0});return}if((r=game.user)!=null&&r.isGM||!o||t)return;const n=S.get(e.defaultSettings.tag);if(!n||Object.keys(n).length<=1){g.log("No default GM settings found to enforce");return}g.log("Enforcing GM settings to player",[n]);let a=!1;for(const[i,d]of Object.entries(n))if(i!=="_version")try{const p=Object.values(e).find(u=>u.tag===i);p&&p.scope==="client"&&S.get(i)!==d&&(S.set(i,d),g.log(`Applied GM setting: ${i}`,[d]),a=!0)}catch(p){g.log(`Failed to apply GM setting: ${i}`,[p])}return a}static saveDefaultSettings(){var o;const e=k();if(!((o=game.user)!=null&&o.isGM)||!S.get(e.enforceGMSettings.tag))return;const t={_version:Date.now()};for(const[n,a]of Object.entries(e))if(a.tag&&a.scope==="client"&&!a.isMenu){const s=S.get(a.tag);s!==void 0&&(t[a.tag]=s)}S.set(e.defaultSettings.tag,t),g.log("Saved default GM settings",[t])}static onSettingChange(e){var o;const t=k();(o=game.user)!=null&&o.isGM&&S.get(t.enforceGMSettings.tag)&&S.saveDefaultSettings()}static updateColorScheme(){var o;const e=game.settings.get("core","uiConfig");let t=(o=e==null?void 0:e.colorScheme)==null?void 0:o.interface;t||(matchMedia("(prefers-color-scheme: dark)").matches?t="dark":matchMedia("(prefers-color-scheme: light)").matches&&(t="light")),S.coreColorScheme=t,g.log("SettingsUtil.updateColorScheme",[e,S.coreColorScheme]),S.applyStreamModeTheme(t)}static applyStreamModeTheme(e="dark"){const t=document.querySelector("body"),o=t==null?void 0:t.classList.contains("stream");if(g.log("Applied stream mode theme",[e,o]),o&&e){t.classList.remove("themed","theme-light","theme-dark"),t.classList.add("themed",`theme-${e}`);const n=document.querySelector(".chat-log");n&&(n.classList.remove("theme-light","theme-dark"),n.classList.add(`theme-${e}`))}}};It=new WeakMap,R(S,It,!1),y(S,"firstLoad",!0),y(S,"foundryUiConfig",null),y(S,"coreColorScheme",null),y(S,"registerSettings",async()=>{const e=k();Object.entries(e).forEach(async b=>{const v=b[1];if(v.showOnRoot&&v.isMenu||!v.isMenu){const G={name:v.label,hint:v.hint,default:v.default,type:v.propType,scope:v.scope,config:v.config,requiresReload:v.requiresReload||!1,onChange:A=>{S.apply(v.tag,A),v.tag!=="v2-enforce-gm-settings"&&v.tag!=="v2-default-settings"&&S.onSettingChange(v.tag)}};(v.choices||v.options)&&(G.choices=v.choices||v.options),await game.settings.register(H,v.tag,G),S.get(v.tag)===void 0&&(g.log("resetting...",[v.tag]),S.set(v.tag,v.default))}}),game.keybindings.register(H,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{S.hideInterface()},restricted:!1});const o=Object.entries(Qn());for(const[b,v]of o){const G={name:v.tag,label:v.label,hint:v.hint,icon:v.icon,type:v.propType,restricted:v.restricted||!1};await game.settings.registerMenu(H,v.tag,G)}if(S.get(e.disableUI.tag)===!0)return;const n=document.body.classList.contains("stream");if(S.applyThemeSettings(),S.applyCustomCSS(),S.applyModuleAdjustments(),S.foundryUiConfig=game.settings.get("core","uiConfig")||null,S.updateColorScheme(),S.applyDebugSettings(),S.applyChatStyles(),S.applyBorderColors(),n){g.log("Stream mode detected - skipping UI settings initialization"),Hooks.on(D.UPDATE_SETTING,(b,v)=>{b.key==="core.uiConfig"&&(S.foundryUiConfig=v,S.updateColorScheme())});return}z.applyTopNavHeight(),Hooks.on(D.RENDER_SCENE_CONTROLS,S.applyLeftControlsSettings),Hooks.on(D.RENDER_PLAYERS_LIST,Ie.applyPlayersListSettings),Hooks.on(D.RENDER_HOTBAR,()=>{Pe.applyCustomStyle(),S.firstLoad&&(S.firstLoad=!1,Pe.applyHotBarCollapse())}),Hooks.on(D.UPDATE_SETTING,(b,v)=>{b.key==="core.uiConfig"&&(S.foundryUiConfig=v,S.updateColorScheme())}),lt.applyThemeToSheets(S.get(e.applyThemeToSheets.tag)),lt.applyHorizontalSheetTabs(S.get(e.useHorizontalSheetTabs.tag)),e.sceneNavMenu.fields.forEach(b=>{S.apply(e[b].tag)}),e.cameraDockMenu.fields.forEach(b=>{S.apply(e[b].tag)}),e.customFontsMenu.fields.forEach(b=>{S.applyCustomFonts(e[b].tag)}),e.leftControlsMenu.fields.forEach(b=>{S.applyLeftControlsSettings(e[b].tag)}),e.interfaceOptionsMenu.fields.forEach(b=>{S.apply(e[b].tag)}),S.applyForcedDarkTheme(),Se.applySideBarWidth(),S.applyDarkThemeToModules(),z.applyHide();const p=S.get(e.useGlassEffect.tag),u=S.get(e.glassTranslucence.tag);S.applyGlassEffect(p),p&&S.applyTranslucence(u);const h=S.get(e.useHorizontalSidebarTabs.tag);Se.applyHorizontalSidebarTabs(h);const C=S.get(e.showChatNotificationsOnTop.tag);Se.applyShowChatNotificationsOnTop(C)}),y(S,"applyThemeSettings",async e=>{const t=k(),o=document.querySelector("body");let n=S.get(t.playerCustomThemeColors.tag),a="player";if(n||(n=S.get(t.customThemeColors.tag),a="world"),n!=null&&n.accent&&(n!=null&&n.secondaryDark||n!=null&&n.secondary))Ce.applyCustomTheme(n),g.log("Applied custom theme colors",[n,a]);else{const s=e||S.get(t.playerColorTheme.tag)||S.get(t.colorTheme.tag)||"";J.forEach(r=>{r.className&&o.classList.remove(r.className)}),s&&o.classList.add(s),g.log("Applied legacy theme",[s])}}),y(S,"applyCustomCSS",e=>{const t=k(),o=e||S.get(t.customStyles.tag)||"";w.addCustomCSS(o)}),y(S,"applyForcedDarkTheme",e=>{var s,r,i,d;if(!(((r=(s=S.foundryUiConfig)==null?void 0:s.colorScheme)==null?void 0:r.applications)==="dark"||((d=(i=S.foundryUiConfig)==null?void 0:i.colorScheme)==null?void 0:d.interface)==="dark"))return;const o=k(),n=e||S.get(o.forcedDarkTheme.tag)||"";if(!n.trim())return;const a=w.processCSSRules(Ea,n);g.log("applyForcedDarkTheme",[a.substring(0,100)+"..."]),w.addCustomCSS(a,"crlngn-forced-dark-mode")}),y(S,"applyModuleAdjustments",e=>{const t=k();(e||S.get(t.adjustOtherModules.tag)||!1)&&Ot.addModuleClasses()}),y(S,"applyDarkThemeToModules",e=>{var a;const t=k(),o=e||S.get(t.applyDarkThemeToModules.tag)||!1,n=game.settings.get("core","uiConfig")||null;o&&((a=n==null?void 0:n.colorScheme)==null?void 0:a.applications)==="dark"&&(S.applyForcedDarkTheme(".app.theme-light:not(.sheet.dnd5e2, .journal-sheet, #hurry-up), #AA-autorec-settings"),document.querySelector("body").classList.add("crlngn-forced-dark-theme"))}),y(S,"migrateOtherModulesList",()=>{const e=k(),t=game.settings.get(H,e.otherModulesList.tag);if(Array.isArray(t)){const o=S.mergeModuleListDefaults(t);return JSON.stringify(o)!==JSON.stringify(t)&&S.set(e.otherModulesList.tag,o),o}if(typeof t=="string"&&t.length>0){g.log("Migrating otherModulesList from string to array format",[t]);const o=S.parseOldModuleListFormat(t),n=S.mergeModuleListDefaults(o);return S.set(e.otherModulesList.tag,n),g.log("Migration complete",[n]),n}return g.log("No saved otherModulesList found, using defaults"),e.otherModulesList.default}),y(S,"parseOldModuleListFormat",e=>{const t=k(),o=[],n=e.split(",").map(a=>a.replace(/['''"]/g,"").trim()).filter(a=>a.length>0);return g.log("Parsed enabled modules from old format",[n]),Object.values(t.otherModulesList.options).forEach(a=>{const s=a.replace(/['''"]/g,"").trim();o.push({id:s,enabled:n.includes(s)})}),o}),y(S,"mergeModuleListDefaults",e=>{const t=k(),o=[],n=Object.values(t.otherModulesList.options).map(s=>s.replace(/['''"]/g,"").trim()),a=new Map(e.map(s=>[s.id,s.enabled]));return n.forEach(s=>{o.push({id:s,enabled:a.has(s)?a.get(s):!0})}),o}),y(S,"applyOtherModulesList",e=>{const t=k();let o=e||S.get(t.otherModulesList.tag);if(g.log("applyOtherModulesList - before merge",[o]),Array.isArray(o)){const n=t.otherModulesList.default,a=[];n.forEach(s=>{const r=o.find(i=>i.id===s.id);r?a.push(r):a.push({...s})}),a.length!==o.length&&(g.log("applyOtherModulesList - merged missing modules",[o.length,"to",a.length]),S.set(t.otherModulesList.tag,a),o=a)}g.log("applyOtherModulesList - after merge",[o]),Ot.addModuleClasses()}),y(S,"hideInterface",()=>{g.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),o=document.querySelector(".taskbar");m(S,It)?(e&&e.style.removeProperty("visibility"),t&&t.style.removeProperty("visibility"),o&&o.style.removeProperty("visibility"),I(S,It,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),o&&o.style.setProperty("visibility","hidden"),I(S,It,!0))});let L=S;const jt=class jt{static getUpdateNewsUrl(){var o;const e=(o=game.modules.get("crlngn-ui"))==null?void 0:o.version,t=e?`https://github.com/crlngn/crlngn-ui/releases/download/v${e}/module-updates.json`:"";return`https://proxy.carolingian.io/proxy?url=${encodeURIComponent(t)}&v=${e}`}static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static cleanSetting(){const e=k();L.set(e.lastUpdateId.tag,"")}static async checkForUpdates(){const e=k();try{const t=new AbortController,o=setTimeout(()=>t.abort(),1e4);try{const n=await L.get(e.lastUpdateId.tag),a=await jt.getIdFromRawJson();if(g.log("checkForUpdates...",[a,n]),n===a)return;const s=await fetch(jt.getUpdateNewsUrl(),{signal:t.signal,mode:"cors",credentials:"omit"});if(clearTimeout(o),!s.ok){g.warn("checkForUpdates | Failed to fetch update news",[s.status,s.statusText]);return}const r=await s.json();await this.displayUpdateNews(r),L.set(e.lastUpdateId.tag,r.id),g.log("checkForUpdates | SUCCESS",[r.id])}catch(n){clearTimeout(o),n.name==="AbortError"?g.warn("checkForUpdates | Request timed out",[n]):g.warn("checkForUpdates | Fetch error",[n.message])}}catch(t){g.warn("checkForUpdates | Unexpected error",[t])}}static async displayUpdateNews(e){try{const t=`
        <div class="crlngn-news">
          <h3>${e.title}</h3>
          ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
          ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
          <div class="crlngn-news-content">
          ${e.content}
          </div>
        </div>
      `;g.error("displayUpdateNews | Chat message created",[e]);const o=await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}});g.error("displayUpdateNews | Chat message created",[o,e])}catch(t){g.error("displayUpdateNews | Error creating chat message",[t])}}};y(jt,"getIdFromRawJson",async()=>{const t=await fetch("https://raw.githubusercontent.com/crlngn/crlngn-ui/refs/heads/v2/news/module-updates.json"),o=t.ok?await t.json():null;return o&&o.id||""});let Cn=jt;class ts{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return g.log("CustomHandlebarsHelpers normalizedIncludes (deprecated)",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)}),Handlebars.registerHelper("moduleEnabled",function(e,t){try{const o=typeof e=="string"?JSON.parse(e):e;if(!Array.isArray(o))return g.log("moduleEnabled: not an array",[e]),!1;const n=t.replace(/['''"]/g,"").trim(),a=o.find(r=>r.id===n),s=a?a.enabled:!1;return g.log("moduleEnabled",[n,s,o]),s}catch(o){return console.warn("Failed to parse moduleList in moduleEnabled helper",o),!1}})}}var Ko;const Xe=class Xe{static init(){Hooks.once(D.INIT,()=>{var s,r,i;if(document.querySelector("body").classList.add(H),(s=document.querySelector("#ui-middle"))==null||s.classList.add(H),game.data.version<"13.339"){Xe.isIncompatible=!0;return}g.log("Initiating module...",[game.system.title]),window.crlngnUI=window.crlngnUI||{},L.registerSettings();const o=k(),n=L.get(o.disableUI.tag);if(g.log(D.INIT,[n]),n){document.querySelector("body").classList.remove(H),(r=document.querySelector("#ui-middle"))==null||r.classList.remove(H);return}const a=document.body.classList.contains("stream");if(et.init(),(i=g.init)==null||i.call(g),de.init(),a){g.log("Stream mode detected - skipping UI component initialization");return}Tt.init(),Ie.init(),z.init(),Ct.init(),Se.init(),Pe.init(),Hooks.on(D.RENDER_CHAT_MESSAGE,m(Xe,Ko))}),Hooks.once(D.READY,()=>{var s;if(g.log("Core Ready",[game]),Xe.isIncompatible){ui.notifications.error(game.i18n.localize("CRLNGN_UI.notifications.incompatibleVersion"),{permanent:!0});return}const e=document.body.classList.contains("stream"),t=k();var o=L.get(t.debugMode.tag);if(o&&(CONFIG.debug.hooks=!0),L.get(t.enableChatStyles.tag)&&Xe.addCSSLocalization(),e){g.log("Stream mode - skipping READY hook UI initialization");return}ts.init(),z.checkSideBar(((s=ui.sidebar)==null?void 0:s.expanded)||!1),L.enforceGMSettings()&&z.refreshSettings(),Ie.applyPlayersListSettings(),L.migrateOtherModulesList(),Ot.init(),Cn.init(),lt.init(),Mo.init(),setTimeout(()=>{var r;(r=ui.combat.popout)==null||r.close()},200)})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";w.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),w.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),w.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),w.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),w.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),w.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),w.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),w.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),w.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),w.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Ko=new WeakMap,y(Xe,"isIncompatible",!1),R(Xe,Ko,(e,t,o)=>{g.log(D.RENDER_CHAT_MESSAGE,[e,t,o]),et.enrichCard(e,t)});let Tn=Xe;Tn.init();
//# sourceMappingURL=crlngn-ui.js.map
